"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["8432"],{8640:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,toc:()=>u,default:()=>l,metadata:()=>o,assets:()=>i,contentTitle:()=>c});var o=JSON.parse('{"id":"admin/backups/include_exclude_files","title":"Inclure/exclure des fichiers","description":"Inclure des fichiers","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/25.include_exclude_files.mdx","sourceDirName":"admin/40.backups","slug":"/admin/backups/include_exclude_files","permalink":"/doc/pr-2678/fr/admin/backups/include_exclude_files","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/25.include_exclude_files.mdx","tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"title":"Inclure/exclure des fichiers"},"sidebar":"admin","previous":{"title":"\xc9viter les pannes mat\xe9rielles","permalink":"/doc/pr-2678/fr/admin/backups/avoid_hardware_failure"},"next":{"title":"M\xe9thodes personnalis\xe9es de sauvegardes","permalink":"/doc/pr-2678/fr/admin/backups/custom_backup_methods"}}'),r=s(4848),a=s(4429);let t={title:"Inclure/exclure des fichiers"},c,i={},u=[{value:"Inclure des fichiers",id:"inclure-des-fichiers",level:2},{value:"Exclure des fichiers",id:"exclure-des-fichiers",level:2},{value:"\xc9viter de sauvegarder certains dossiers du <code>/home</code>",id:"\xe9viter-de-sauvegarder-certains-dossiers-du-home",level:3},{value:"Ne pas sauvegarder les grosses quantit\xe9s de donn\xe9es",id:"ne-pas-sauvegarder-les-grosses-quantit\xe9s-de-donn\xe9es",level:3}];function d(e){let n={br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"inclure-des-fichiers",children:"Inclure des fichiers"}),"\n",(0,r.jsx)(n.p,{children:"YunoHost sait en g\xe9n\xe9ral d\xe9j\xe0 ce qui doit \xeatre sauvegard\xe9. Toutefois, si vous avez proc\xe9d\xe9 \xe0 des modifications manuelles, par exemple en installant une app en dehors du syst\xe8me d'applications de YunoHost, vous pouvez avoir envie d'\xe9tendre le m\xe9canisme de YunoHost pour sp\xe9cifier d'autres fichiers \xe0 sauvegarder."}),"\n",(0,r.jsx)(n.p,{children:"Par d\xe9faut, si des configurations suivies par YunoHost sont modifi\xe9es, elles seront sauvegard\xe9es. En revanche, une base de donn\xe9es ou une app ajout\xe9e \xe0 la main, des modifs sur certaines configurations non suivies, ne le seront pas."}),"\n",(0,r.jsx)(n.p,{children:"Vous pouvez cr\xe9er un hook de sauvegarde et un hook de restauration pour ajouter des donn\xe9es \xe0 sauvegarder. Ci-dessous un exemple:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"/etc/yunohost/hooks.d/backup/99-conf_custom"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Source YNH helpers\nsource /usr/share/yunohost/helpers\n\nynh_backup_dest (){\n    YNH_CWD="${YNH_BACKUP_DIR%/}/$1"\n    mkdir -p $YNH_CWD\n    cd "$YNH_CWD"\n}\n\n# Exit hook on subcommand error or unset variable\nynh_abort_if_errors\n\n# Openvpn\nynh_backup_dest "conf/custom/openvpn"\nynh_backup "/etc/sysctl.d/openvpn.conf"\nynh_backup "/etc/openvpn"\nynh_backup "/etc/fail2ban/jail.d/openvpn.conf"\nynh_backup "/etc/fail2ban/filter.d/openvpn.conf"\n\n# Samba\nynh_backup_dest "conf/custom/samba"\nynh_backup "/etc/samba"\nynh_backup "/var/lib/samba"\nynh_backup "/etc/yunohost/hooks.d/post_user_create/99-samba"\nynh_backup "/etc/yunohost/hooks.d/post_user_delete/99-samba"\nynh_backup --src_path="/etc/yunohost/hooks.d/post_user_update/99-samba" --not_mandatory\nynh_backup "/etc/cron.daily/clean-trash"\n\n# MISC\nynh_backup_dest "conf/custom/misc"\nynh_backup "/etc/sysctl.d/noipv6.conf"\nynh_backup "/usr/local/bin/"\nynh_backup "/etc/yunohost/hooks.d/backup/99-conf_custom"\nynh_backup "/etc/yunohost/hooks.d/restore/99-conf_custom"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"/etc/yunohost/hooks.d/restore/99-conf_custom"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Source YNH helpers\nsource /usr/share/yunohost/helpers\n\nynh_restore_dest (){\n    YNH_CWD="${YNH_BACKUP_DIR%/}/$1"\n    cd "$YNH_CWD"\n}\n\n# Exit hook on subcommand error or unset variable\nynh_abort_if_errors\n\n# Openvpn\napp="custom_openvpn" # Cette variable est importante pour le helper suivant\nynh_install_app_dependencies "openvpn openvpn-auth-ldap samba"\n\nynh_restore_dest "conf/custom/openvpn"\nynh_restore_file "/etc/sysctl.d/openvpn.conf"\nynh_restore_file "/etc/openvpn"\nynh_restore_file "/etc/fail2ban/jail.d/openvpn.conf"\nynh_restore_file "/etc/fail2ban/filter.d/openvpn.conf"\n\n# Samba\napp="custom_samba" # Cette variable est importante pour le helper suivant\nynh_install_app_dependencies "samba"\n\nynh_restore_dest "conf/custom/samba"\nynh_restore_file "/etc/samba"\nynh_restore_file "/var/lib/samba"\nynh_restore_file "/etc/yunohost/hooks.d/post_user_create/99-samba"\nynh_restore_file "/etc/yunohost/hooks.d/post_user_delete/99-samba"\nynh_restore_file --src_path="/etc/yunohost/hooks.d/post_user_update/99-samba" --not_mandatory\nynh_restore_file "/etc/cron.daily/clean-trash"\nchown -R openvpn:openvpn /etc/openvpn\n\n# MISC\nynh_restore_dest "conf/custom/misc"\nynh_restore_file "/etc/sysctl.d/noipv6.conf"\nynh_restore_file "/usr/local/bin/"\nynh_restore_file "/etc/yunohost/hooks.d/backup/99-conf_custom"\nynh_restore_file "/etc/yunohost/hooks.d/restore/99-conf_custom"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"exclure-des-fichiers",children:"Exclure des fichiers"}),"\n",(0,r.jsx)(n.p,{children:"Il n'existe pas de m\xe9canisme pour exclure d'une sauvegarde au format YunoHost des fichiers sp\xe9cifiques, en dehors des 2 options pr\xe9sent\xe9es ci-dessous:"}),"\n",(0,r.jsxs)(n.h3,{id:"\xe9viter-de-sauvegarder-certains-dossiers-du-home",children:["\xc9viter de sauvegarder certains dossiers du ",(0,r.jsx)(n.code,{children:"/home"})]}),"\n",(0,r.jsxs)(n.p,{children:["Si besoin, vous pouvez sp\xe9cifier que certains dossiers ",(0,r.jsx)(n.code,{children:"home"})," d'utilisateurs ou utilisatrices ne soient pas sauvegard\xe9s par la commande ",(0,r.jsx)(n.code,{children:"yunohost backup"}),", en cr\xe9ant un fichier vide nomm\xe9 ",(0,r.jsx)(n.code,{children:".nobackup"})," \xe0 l'int\xe9rieur."]}),"\n",(0,r.jsxs)(n.p,{children:["Attention ce m\xe9canisme ne fonctionne que pour les ",(0,r.jsx)(n.strong,{children:"sous-dossiers de premier niveau"})," du ",(0,r.jsx)(n.code,{children:"/home"}),", comme par exemple ",(0,r.jsx)(n.code,{children:"/home/user1"})," ou ",(0,r.jsx)(n.code,{children:"/home/yunohost.multimedia"})," . Cela ne fonctionne pas pour les autres dossiers ou sous-dossiers, comme par exemple ",(0,r.jsx)(n.code,{children:"/home/user1/grosdossier"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"ne-pas-sauvegarder-les-grosses-quantit\xe9s-de-donn\xe9es",children:"Ne pas sauvegarder les grosses quantit\xe9s de donn\xe9es"}),"\n",(0,r.jsxs)(n.p,{children:["Certaines apps comme Nextcloud sont potentiellement rattach\xe9es \xe0 des quantit\xe9s importantes de donn\xe9es. Il est possible de ne pas les sauvegarder par d\xe9faut. Dans ce cas, on dit que l'app \"sauvegarde uniquement le core\" (de l'app).",(0,r.jsx)(n.br,{}),"\n","Lors d'une mise \xe0 jour, les apps contenant une grande quantit\xe9 de donn\xe9es effectuent g\xe9n\xe9ralement une sauvegarde sans ces donn\xe9es."]}),"\n",(0,r.jsxs)(n.p,{children:["Pour d\xe9sactiver temporairement la sauvegarde des donn\xe9es volumineuses, pour les applications qui impl\xe9mentent cette fonctionnalit\xe9, vous pouvez d\xe9finir la variable ",(0,r.jsx)(n.code,{children:"BACKUP_CORE_ONLY"}),". Pour ce faire, la variable doit \xeatre d\xe9finie avant la commande de backup :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"BACKUP_CORE_ONLY=1 yunohost backup create --apps nextcloud\n"})}),"\n",(0,r.jsx)(n.p,{children:"Faites montre de prudence : il vous faudra alors sauvegarder vous-m\xeame les donn\xe9es des utilisateurs et utilisatrices de Nextcloud."}),"\n",(0,r.jsx)(n.p,{children:"Si vous souhaitez que ce comportement soit permanent:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yunohost app setting nextcloud do_not_backup_data -v 1\n"})})]})}function l(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},4429:function(e,n,s){s.d(n,{R:()=>t,x:()=>c});var o=s(6540);let r={},a=o.createContext(r);function t(e){let n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);