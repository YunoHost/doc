"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["2526"],{652:function(e,a,n){n.r(a),n.d(a,{frontMatter:()=>c,toc:()=>u,default:()=>p,metadata:()=>t,assets:()=>d,contentTitle:()=>l});var t=JSON.parse('{"id":"admin/backups/index","title":"\u{1F691} Backups","description":"In the context of self-hosting, backups are an important element to compensate for unexpected events (fire, database corruption, loss of access to the server, compromised server...). The backup policy to implement depends on the importance of the services and data you manage. For example, backing up a test server will be of little interest, while you will want to be very careful if you are managing critical data for an association or a company - and in such cases, you will want to store the backups in a different location or locations.","source":"@site/docs/admin/40.backups/index.mdx","sourceDirName":"admin/40.backups","slug":"/admin/backups/","permalink":"/doc/pr-2675/de/admin/backups/","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/admin/40.backups/index.mdx","tags":[],"version":"current","frontMatter":{"title":"\u{1F691} Backups"},"sidebar":"admin","previous":{"title":"Migrate emails to YunoHost","permalink":"/doc/pr-2675/de/admin/email/migration"},"next":{"title":"Backup strategies","permalink":"/doc/pr-2675/de/admin/backups/evaluate"}}'),r=n(4848),s=n(4429),i=n(4109),o=n(3703);n(3345);let c={title:"\u{1F691} Backups"},l,d={},u=[{value:"Manual backup",id:"manual-backup",level:2},{value:"Creating backups",id:"creating-backups",level:4},{value:"Downloading backups",id:"downloading-backups",level:3},{value:"Testing",id:"testing",level:3},{value:"Restoring backups",id:"restoring-backups",level:3},{value:"Simple case: little data, archive already present",id:"simple-case-little-data-archive-already-present",level:4},{value:"Uploading an archive",id:"uploading-an-archive",level:4}];function h(e){let a={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.p,{children:["In the context of self-hosting, backups are an important element to compensate for unexpected events (fire, database corruption, loss of access to the server, compromised server...). The backup policy to implement depends on the importance of the services and data you manage. For example, backing up a test server will be of little interest, while you will want to be very careful if you are managing critical data for an association or a company - and in such cases, you will want to store the backups ",(0,r.jsx)(a.em,{children:"in a different location or locations"}),"."]}),"\n",(0,r.jsx)(a.h2,{id:"manual-backup",children:"Manual backup"}),"\n",(0,r.jsx)(a.p,{children:"YunoHost comes with a backup system, that allows you to backup (and restore) system configurations and data (e.g. emails) and apps if they support it."}),"\n",(0,r.jsxs)(a.p,{children:["You can manage backups either from the command line (",(0,r.jsx)(a.code,{children:"yunohost backup --help"}),") or from the web administration (in the Backups section), though some features are not yet available in the webadmin."]}),"\n",(0,r.jsxs)(a.p,{children:["The current default method consists in creating a ",(0,r.jsx)(a.code,{children:".tar"})," archive containing all relevant files."]}),"\n",(0,r.jsx)(a.h4,{id:"creating-backups",children:"Creating backups"}),"\n",(0,r.jsxs)(i.A,{groupId:"admin-commands",children:[(0,r.jsxs)(o.A,{value:"web",label:"From the web interface",children:[(0,r.jsxs)(a.p,{children:["You can easily create backup archives from the webadmin by going to ",(0,r.jsx)(a.code,{children:"Backups > Local storage"})," and clicking on ",(0,r.jsx)(a.code,{children:"New backup"}),". You will then be asked to select which configuration, data and apps you want to backup."]}),(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"picture of YunoHost&#39;s backup pannel",src:n(2226).A+"",width:"456",height:"505"})})]}),(0,r.jsxs)(o.A,{value:"cli",label:"From the command line",children:[(0,r.jsx)(a.p,{children:"You can create a new backup archive from the command line. Here are a few simple examples of commands and their corresponding behavior:"}),(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Backing up everything (all system parts and apps):"}),"\n"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"yunohost backup create\n"})}),(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Backing up only apps"}),"\n"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"yunohost backup create --apps\n"})}),(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Backing up only two apps (wordpress and shaarli)"}),"\n"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"yunohost backup create --apps wordpress shaarli\n"})}),(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Backing up only emails"}),"\n"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"yunohost backup create --system data_mail\n"})}),(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Backing up emails and wordpress"}),"\n"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"yunohost backup create --system data_mail --apps wordpress\n"})}),(0,r.jsxs)(a.p,{children:["For more information and options about backup creation, consult ",(0,r.jsx)(a.code,{children:"yunohost backup create --help"}),". You can also list the system parts that can be backed up with ",(0,r.jsx)(a.code,{children:"yunohost hook list backup"}),"."]})]})]}),"\n",(0,r.jsx)(a.h3,{id:"downloading-backups",children:"Downloading backups"}),"\n",(0,r.jsxs)(i.A,{groupId:"admin-commands",children:[(0,r.jsxs)(o.A,{value:"web",label:"From the web interface",children:[(0,r.jsx)(a.p,{children:"After creating backups, it is possible to list and inspect them using the corresponding views in the web administration interface. A button allows you to download the archive. If the archive is larger than 3GB, it may be better to proceed via SFTP."}),(0,r.jsx)(a.p,{children:(0,r.jsx)(a.code,{children:"Backup > Local Archives > <Archive name> > Download"})})]}),(0,r.jsxs)(o.A,{value:"sftp",label:"With a SFTP client",children:[(0,r.jsxs)(a.p,{children:["Currently, the most accessible way to download big archives is to use the program FileZilla as explained in ",(0,r.jsx)(a.a,{href:"/admin/tutorials/filezilla",children:"this page"}),"."]}),(0,r.jsxs)(a.p,{children:["By default, backups are stored in ",(0,r.jsx)(a.code,{children:"/home/yunohost.backup/archives/"}),"."]})]}),(0,r.jsxs)(o.A,{value:"cli",label:"From the command line",children:[(0,r.jsxs)(a.p,{children:["The ",(0,r.jsx)(a.code,{children:"yunohost backup list"})," and ",(0,r.jsx)(a.code,{children:"yunohost backup info <archive_name>"})," commands provide information about the names and sizes of backups."]}),(0,r.jsxs)(a.p,{children:["It is possible to use ",(0,r.jsx)(a.code,{children:"scp"})," (a program based on ",(0,r.jsx)(a.a,{href:"/admin/command_line",children:(0,r.jsx)(a.code,{children:"ssh"})}),") to copy files between two machines via the command line. So, from a GNU/Linux machine, you can use the following command to download an archive:"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"scp admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./\n"})}),(0,r.jsx)(a.p,{children:"If your SSH port is different from 22"}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"scp -P ssh_port admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./\n"})})]})]}),"\n",(0,r.jsx)(a.admonition,{type:"caution",children:(0,r.jsx)(a.p,{children:"Don't forget to store your backup in a different place to your server."})}),"\n",(0,r.jsx)(a.admonition,{type:"info",children:(0,r.jsxs)(a.p,{children:["If you want, you can connect an external disk to your server so that the archives arrive directly on it. See this guide to ",(0,r.jsx)(a.a,{href:"/admin/tutorials/external_storage",children:"Adding external storage to your server"})]})}),"\n",(0,r.jsx)(a.h3,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(a.p,{children:"You should regularly test your backups by at least listing the contents of the archives and checking the size of the associated data. It is best to practice restoring regularly."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:'# List the files\ntar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | less\n\n# List database exports\ntar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | grep "(db|dump)`.sql"\n\n# Check the weight\nls -lh /home/yunohost.backup/archives/ARCHIVE.tar\n'})}),"\n",(0,r.jsx)(a.h3,{id:"restoring-backups",children:"Restoring backups"}),"\n",(0,r.jsx)(a.admonition,{type:"info",children:(0,r.jsx)(a.p,{children:"SPOILER: The larger your data volume and the more applications you have, the more complex your recovery will be."})}),"\n",(0,r.jsx)(a.h4,{id:"simple-case-little-data-archive-already-present",children:"Simple case: little data, archive already present"}),"\n",(0,r.jsxs)(i.A,{groupId:"admin-commands",children:[(0,r.jsxs)(o.A,{value:"web",label:"From the web interface",children:[(0,r.jsxs)(a.p,{children:["Go in ",(0,r.jsx)(a.code,{children:"Backup > Local storage"})," and select your archive. You can then select which items you want to restore, then click on 'Restore'."]}),(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"picture of YunoHost&#39;s restore pannel",src:n(3532).A+"",width:"456",height:"342"})})]}),(0,r.jsxs)(o.A,{value:"cli",label:"From the command line",children:[(0,r.jsxs)(a.p,{children:["From the command line, you can run ",(0,r.jsx)(a.code,{children:"yunohost backup list"})," to get the available archive names. They are basically their file name without extension."]}),(0,r.jsxs)(a.p,{children:["You can then run ",(0,r.jsx)(a.code,{children:"yunohost backup restore <archivename>"})," (hence without its ",(0,r.jsx)(a.code,{children:".tar"})," extension) to restore an archive. As for ",(0,r.jsx)(a.code,{children:"yunohost backup create"}),", this will restore everything in the archive by default. If you want to restore only specific items, you can use something like ",(0,r.jsx)(a.code,{children:"yunohost backup restore <archivename> --apps wordpress"}),", which will restore only the wordpress app."]}),(0,r.jsx)(a.admonition,{type:"tip",children:(0,r.jsx)(a.p,{children:"In the case of a complete restoration, it is possible to restore instead of launching the initial configuration."})})]})]}),"\n",(0,r.jsx)(a.p,{children:"To restore an app, the domain on which it was installed should already be configured (or you need to restore the corresponding system configuration). You also cannot restore an app which is already installed... which means that to restore an old version of an app, you must first uninstall it."}),"\n",(0,r.jsx)(a.h4,{id:"uploading-an-archive",children:"Uploading an archive"}),"\n",(0,r.jsx)(a.p,{children:"In many cases, the archive is not on the server on which you want to restore it. So it has to be uploaded, which depending on its size can take more or less time."}),"\n",(0,r.jsxs)(i.A,{groupId:"admin-commands",children:[(0,r.jsxs)(o.A,{value:"sftp",label:"With a SFTP client",children:[(0,r.jsxs)(a.p,{children:["Currently, the most accessible solution for uploading backups is to use the FileZilla program as explained in ",(0,r.jsx)(a.a,{href:"/admin/tutorials/filezilla",children:"this page"}),"."]}),(0,r.jsxs)(a.p,{children:["By default, backups are to be placed in ",(0,r.jsx)(a.code,{children:"/home/yunohost.backup/archives/"}),"."]})]}),(0,r.jsxs)(o.A,{value:"cli",label:"From the command line",children:[(0,r.jsxs)(a.p,{children:["You can use the ",(0,r.jsx)(a.code,{children:"scp"})," (a command built on ",(0,r.jsx)(a.code,{children:"ssh"}),") to copy files between two machines from CLI. For example for a Linux terminal:"]}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"scp /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/\n"})}),(0,r.jsx)(a.p,{children:"If your SSH port is different from 22"}),(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"scp -P ssh_port /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/\n"})})]})]})]})}function p(e={}){let{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},2226:function(e,a,n){n.d(a,{A:()=>t});let t=n.p+"assets/images/backup-e0d7d8d8731b1e1a65ddb477d866dc72.png"},3532:function(e,a,n){n.d(a,{A:()=>t});let t=n.p+"assets/images/restore-6249e66027da3368ac270ff7c9ea3c05.png"},3703:function(e,a,n){n.d(a,{A:()=>s});var t=n(4848);n(6540);var r=n(9836);function s({children:e,hidden:a,className:n}){return(0,t.jsx)("div",{role:"tabpanel",className:(0,r.A)("tabItem_Ymn6",n),hidden:a,children:e})}},4109:function(e,a,n){n.d(a,{A:()=>v});var t=n(4848),r=n(6540),s=n(9836),i=n(6364),o=n(8251),c=n(6347),l=n(8004),d=n(5580),u=n(2213),h=n(5734);function p(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){let{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:a}){return a.some(a=>a.value===e)}var b=n(8864);function f({className:e,block:a,selectedValue:n,selectValue:r,tabValues:i}){let c=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),d=e=>{let a=e.currentTarget,t=i[c.indexOf(a)].value;t!==n&&(l(a),r(t))},u=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let n=c.indexOf(e.currentTarget)+1;a=c[n]??c[0];break}case"ArrowLeft":{let n=c.indexOf(e.currentTarget)-1;a=c[n]??c[c.length-1]}}a?.focus()};return(0,t.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":a},e),children:i.map(({value:e,label:a,attributes:r})=>(0,t.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...r,className:(0,s.A)("tabs__item","tabItem_LNqP",r?.className,{"tabs__item--active":n===e}),children:a??e},e))})}function x({lazy:e,children:a,selectedValue:n}){let i=(Array.isArray(a)?a:[a]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===n);return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,t.jsx)("div",{className:"margin-top--md",children:i.map((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==n}))})}function g(e){let a=function(e){let a,{defaultValue:n,queryString:t=!1,groupId:s}=e,i=function(e){let{values:a,children:n}=e;return(0,r.useMemo)(()=>{let e=a??p(n).map(({props:{value:e,label:a,attributes:n,default:t}})=>({value:e,label:a,attributes:n,default:t})),t=(0,u.XI)(e,(e,a)=>e.value===a.value);if(t.length>0)throw Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[a,n])}(e),[o,b]=(0,r.useState)(()=>(function({defaultValue:e,tabValues:a}){if(0===a.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:a}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${a.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let n=a.find(e=>e.default)??a[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:n,tabValues:i})),[f,x]=function({queryString:e=!1,groupId:a}){let n=(0,c.W6)(),t=function({queryString:e=!1,groupId:a}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!a)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:e,groupId:a});return[(0,d.aZ)(t),(0,r.useCallback)(e=>{if(!t)return;let a=new URLSearchParams(n.location.search);a.set(t,e),n.replace({...n.location,search:a.toString()})},[t,n])]}({queryString:t,groupId:s}),[g,v]=function({groupId:e}){let a=e?`docusaurus.tab.${e}`:null,[n,t]=(0,h.Dv)(a);return[n,(0,r.useCallback)(e=>{a&&t.set(e)},[a,t])]}({groupId:s}),j=m({value:a=f??g,tabValues:i})?a:null;return(0,l.A)(()=>{j&&b(j)},[j]),{selectedValue:o,selectValue:(0,r.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw Error(`Can't select invalid tab value=${e}`);b(e),x(e),v(e)},[x,v,i]),tabValues:i}}(e);return(0,t.jsxs)("div",{className:(0,s.A)(i.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,t.jsx)(f,{...a,...e}),(0,t.jsx)(x,{...a,...e})]})}function v(e){let a=(0,b.A)();return(0,t.jsx)(g,{...e,children:p(e.children)},String(a))}},3345:function(e,a,n){n.d(a,{Ay:()=>s,OU:()=>o,YD:()=>l,ZW:()=>c,cW:()=>i,nl:()=>h,rb:()=>d,yU:()=>u});var t=n(4848);n(6540);var r=n(6784);function s({children:e,color:a,no_break:n}){return(0,t.jsx)("span",{style:{backgroundColor:a,borderRadius:"4px",color:"#fff",padding:"0.2rem",whiteSpace:n?"pre":void 0},children:e})}function i(){return(0,t.jsxs)(s,{no_break:!0,color:"green",children:[(0,t.jsx)(r.g,{icon:"cogs"})," Webadmin"]})}function o(){return(0,t.jsxs)(s,{no_break:!0,color:"#1877F2",children:[(0,t.jsx)(r.g,{icon:"cubes"})," Applications"]})}function c(){return(0,t.jsx)(s,{no_break:!0,color:"green",children:"+ Install"})}function l(){return(0,t.jsxs)(s,{no_break:!0,color:"darkgreen",children:[(0,t.jsx)(r.g,{icon:"stethoscope"})," Diagnosis"]})}function d(){return(0,t.jsx)(s,{no_break:!0,color:"#3a87ad",children:"FFDN"})}function u(){return(0,t.jsx)(s,{no_break:!0,color:"#32b643",children:"Non Profit"})}function h(){return(0,t.jsx)(s,{no_break:!0,color:"#f0980c",children:"CHATONS"})}},4429:function(e,a,n){n.d(a,{R:()=>i,x:()=>o});var t=n(6540);let r={},s=t.createContext(r);function i(e){let a=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(s.Provider,{value:a},e.children)}}}]);