"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["7254"],{792:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>o,toc:()=>d,default:()=>h,metadata:()=>t,assets:()=>l,contentTitle:()=>r});var t=JSON.parse('{"id":"admin/troubleshooting/fail2ban","title":"IP address unban","description":"Fail2Ban is an intrusion prevention software that protects computer servers against brute-force attacks. It monitors certain logs and will ban IP addresses that show brute-force-like behavior.","source":"@site/docs/admin/50.troubleshooting/05.fail2ban.mdx","sourceDirName":"admin/50.troubleshooting","slug":"/admin/troubleshooting/fail2ban","permalink":"/doc/pr-2675/it/admin/troubleshooting/fail2ban","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/admin/50.troubleshooting/05.fail2ban.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"IP address unban"},"sidebar":"admin","previous":{"title":"Cleanup","permalink":"/doc/pr-2675/it/admin/troubleshooting/cleanup"},"next":{"title":"Changing root\'s password","permalink":"/doc/pr-2675/it/admin/troubleshooting/change_root_password"}}'),i=s(4848),a=s(4429);let o={title:"IP address unban"},r,l={},d=[{value:"Unban an IP address",id:"unban-an-ip-address",level:2},{value:"Whitelist an IP address",id:"whitelist-an-ip-address",level:2}];function c(e){let n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fail2Ban"})," is an intrusion prevention software that protects computer servers against brute-force attacks. It monitors certain logs and will ban IP addresses that show brute-force-like behavior."]}),"\n",(0,i.jsxs)(n.p,{children:["In particular, ",(0,i.jsx)(n.strong,{children:"Fail2Ban"})," monitors ",(0,i.jsx)(n.code,{children:"SSH"})," connection attempts. After 5 failed SSH connection attempts, Fail2Ban will ban the IP address from connecting via SSH for 10 minutes. If this address fails several times, it might get banned for a week."]}),"\n",(0,i.jsx)(n.h2,{id:"unban-an-ip-address",children:"Unban an IP address"}),"\n",(0,i.jsx)(n.p,{children:"To unblock an IP address, you must first access your server by some means (for example from another IP address or from another internet connection than the banned one)."}),"\n",(0,i.jsxs)(n.p,{children:["Then, look at the ",(0,i.jsx)(n.strong,{children:"Fail2Ban\u2019s log"})," to identify in which ",(0,i.jsx)(n.code,{children:"jail"})," the IP address has been banned:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo tail /var/log/fail2ban.log\n2019-01-07 16:24:47 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:49 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:51 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:54 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:57 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:57 fail2ban.actions [1837]: NOTICE  [sshd] Ban 11.22.33.44\n2019-01-07 16:24:57 fail2ban.filter  [1837]: NOTICE  [recidive] Ban 11.22.33.44\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Here, the ",(0,i.jsx)(n.code,{children:"11.22.33.44"})," IP address has been banned in the ",(0,i.jsx)(n.code,{children:"sshd"})," and ",(0,i.jsx)(n.code,{children:"recidive"})," jails."]}),"\n",(0,i.jsx)(n.p,{children:"Then deban the IP address with the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo fail2ban-client set sshd unbanip 11.22.33.44\nsudo fail2ban-client set recidive unbanip 11.22.33.44\n"})}),"\n",(0,i.jsx)(n.h2,{id:"whitelist-an-ip-address",children:"Whitelist an IP address"}),"\n",(0,i.jsxs)(n.p,{children:['If you don\u2019t want a "legitimate" IP address to be blocked by ',(0,i.jsx)(n.strong,{children:"YunoHost"})," anymore, then you have to fill it in the whitelist of the ",(0,i.jsx)(n.code,{children:"jail"})," configuration file."]}),"\n",(0,i.jsxs)(n.p,{children:["When updating the ",(0,i.jsx)(n.strong,{children:"Fail2Ban"})," software, the original ",(0,i.jsx)(n.code,{children:"/etc/fail2ban/jail.conf"})," file is overwritten. So it is on a new dedicated file that we will store the changes. They will thus be preserved over time."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Start by creating the new jail configuration file which will be called ",(0,i.jsx)(n.code,{children:"yunohost-whitelist.conf"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo touch /etc/fail2ban/jail.d/yunohost-whitelist.conf\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Edit this new file with your favorite editor:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/fail2ban/jail.d/yunohost-whitelist.conf\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["Paste the following content into the file and adapt the IP address ",(0,i.jsx)(n.code,{children:"XXX.XXX.XXX.XXX"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[DEFAULT]\n\nignoreip = 127.0.0.1/8 XXX.XXX.XXX.XXX #<= the IP address (you can put more than one, separated by a space) that you want to whitelist\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Save the file and reload the Fail2Ban configuration:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo fail2ban-client reload\n"})}),"\n",(0,i.jsx)(n.p,{children:"Congratulations, no more risks of banning yourself from your own YunoHost server!"})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},4429:function(e,n,s){s.d(n,{R:()=>o,x:()=>r});var t=s(6540);let i={},a=t.createContext(i);function o(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);