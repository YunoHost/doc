"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["6805"],{3478:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>r,toc:()=>d,default:()=>h,metadata:()=>o,assets:()=>l,contentTitle:()=>s});var o=JSON.parse('{"id":"admin/upgrade/11.0-bullseye","title":"Migrating from 4.x to 11.x","description":"This page is dedicated to help you migrating an instance from YunoHost 4.4.x (running on Debian Buster/10.x) to YunoHost 11.x (running on Debian Bullseye/11.x). Note: we decided to skip the version numbers from 5 to 10 to follow the Debian version numbers.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/55.upgrade/11.0-bullseye.mdx","sourceDirName":"admin/55.upgrade","slug":"/admin/upgrade/11.0-bullseye","permalink":"/doc/pr-2675/fr/admin/upgrade/11.0-bullseye","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/55.upgrade/11.0-bullseye.mdx","tags":[],"version":"current","frontMatter":{"title":"Migrating from 4.x to 11.x"},"sidebar":"admin","previous":{"title":"\u2728 Mises \xe0 jour","permalink":"/doc/pr-2675/fr/admin/upgrade/"},"next":{"title":"Migrer de 11.x vers 12.x","permalink":"/doc/pr-2675/fr/admin/upgrade/12.0-bookworm/"}}'),t=i(4848),a=i(4429);let r={title:"Migrating from 4.x to 11.x"},s,l={},d=[{value:"Notes importantes",id:"notes-importantes",level:2},{value:"Proc\xe9dure de migration",id:"proc\xe9dure-de-migration",level:2},{value:"Depuis la webadmin",id:"depuis-la-webadmin",level:3},{value:"Depuis la ligne de commande",id:"depuis-la-ligne-de-commande",level:3},{value:"Pendant la migration",id:"pendant-la-migration",level:2},{value:"If the migration crashed / failed at some point",id:"if-the-migration-crashed--failed-at-some-point",level:3},{value:"What to do after the upgrade",id:"what-to-do-after-the-upgrade",level:2},{value:"Check that you actually are on Debian Bullseye and YunoHost 11.x",id:"check-that-you-actually-are-on-debian-bullseye-and-yunohost-11x",level:3},{value:"Run the migration to repair your python app",id:"run-the-migration-to-repair-your-python-app",level:3},{value:"Check that no issue appeared in the diagnosis",id:"check-that-no-issue-appeared-in-the-diagnosis",level:3},{value:"V\xe9rifiez que les applications fonctionnent",id:"v\xe9rifiez-que-les-applications-fonctionnent",level:3},{value:"Soucis connus apr\xe8s la migration",id:"soucis-connus-apr\xe8s-la-migration",level:2},{value:"Can&#39;t run the migration due to <code>libc6-dev : Breaks: libgcc-8-dev issue</code>",id:"cant-run-the-migration-due-to-libc6-dev--breaks-libgcc-8-dev-issue",level:3},{value:"DNSmasq is not running anymore",id:"dnsmasq-is-not-running-anymore",level:3},{value:"No ethernet connexion after rebooting following a migration on a Raspberry Pi 4",id:"no-ethernet-connexion-after-rebooting-following-a-migration-on-a-raspberry-pi-4",level:3},{value:"Restore ynh4 backup onto a fresh ynh11",id:"restore-ynh4-backup-onto-a-fresh-ynh11",level:3}];function c(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This page is dedicated to help you migrating an instance from YunoHost 4.4.x (running on Debian Buster/10.x) to YunoHost 11.x (running on Debian Bullseye/11.x). Note: we decided to skip the version numbers from 5 to 10 to follow the Debian version numbers."}),"\n",(0,t.jsx)(n.h2,{id:"notes-importantes",children:"Notes importantes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"The YunoHost team did its best to make sure that the migration is as smooth as possible and was tested over the course of several months in several cases."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["With that said, please be aware that this is a delicate operation. System administration is a complicated topic and covering every particular case is quite hard. Therefore, if you host critical data and services, please ",(0,t.jsx)(n.a,{href:"/admin/backups",children:"make backups"}),". And in any case, be patient and attentive during the migration."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:['Ne vous pr\xe9cipitez pas \xe0 vouloir faire une r\xe9installation de votre syst\xe8me en pensant que cela serait "plus simple" (sigh). (Une attitude qui revient r\xe9guli\xe8rement est de vouloir r\xe9installer son syst\xe8me \xe0 la moindre complication...). \xc0 la place, si vous rencontrez des probl\xe8mes, nous vous encourageons \xe0 investiguer, chercher \xe0 comprendre et ',(0,t.jsx)(n.a,{href:"/community/help",children:"trouver de l'aide sur le chat ou le forum"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"You should watch the known issues at the bottom of this page, to be sure your migrations will work properly."})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"proc\xe9dure-de-migration",children:"Proc\xe9dure de migration"}),"\n",(0,t.jsx)(n.h3,{id:"depuis-la-webadmin",children:"Depuis la webadmin"}),"\n",(0,t.jsx)(n.p,{children:"After upgrading to 4.4.x, go to Tools > Migrations to access the migrations interface. You will have to read carefully and accept the disclaimer then launch the migration."}),"\n",(0,t.jsx)(n.h3,{id:"depuis-la-ligne-de-commande",children:"Depuis la ligne de commande"}),"\n",(0,t.jsx)(n.p,{children:"After upgrading to 4.4.x, run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo yunohost tools migrations run\n"})}),"\n",(0,t.jsx)(n.p,{children:"puis lisez attentivement l'avertissement et les instructions."}),"\n",(0,t.jsx)(n.h2,{id:"pendant-la-migration",children:"Pendant la migration"}),"\n",(0,t.jsx)(n.p,{children:"Depending on your hardware and packages installed, the migration might take up to a few hours."}),"\n",(0,t.jsx)(n.p,{children:"The logs will be shown in the message bar (you can hover it to see the whole history). They will also be available after the migration (like any other operations) in Tools > Logs."}),"\n",(0,t.jsx)(n.p,{children:"Notez que m\xeame si vous fermez la page d'admin, la migration continuera (par contre l'interface d'admin sera partiellement indisponible)."}),"\n",(0,t.jsx)(n.h3,{id:"if-the-migration-crashed--failed-at-some-point",children:"If the migration crashed / failed at some point"}),"\n",(0,t.jsxs)(n.p,{children:["If the migration failed at some point, it should be possible to relaunch it. If it still doesn't work, you can try to ",(0,t.jsx)(n.a,{href:"/community/help",children:"get help"})," (please provide the corresponding messages or whatever makes you say that it's not working)."]}),"\n",(0,t.jsx)(n.h2,{id:"what-to-do-after-the-upgrade",children:"What to do after the upgrade"}),"\n",(0,t.jsx)(n.h3,{id:"check-that-you-actually-are-on-debian-bullseye-and-yunohost-11x",children:"Check that you actually are on Debian Bullseye and YunoHost 11.x"}),"\n",(0,t.jsxs)(n.p,{children:["For this, go to Diagnosis (category Base system) or look at the footer of the webadmin. In the command line, you can use ",(0,t.jsx)(n.code,{children:"lsb_release -a"})," and ",(0,t.jsx)(n.code,{children:"yunohost --version"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"run-the-migration-to-repair-your-python-app",children:"Run the migration to repair your python app"}),"\n",(0,t.jsx)(n.p,{children:"After upgrading, your python apps should be unavailable because their virtual environment (venv) needs to be rebuilt."}),"\n",(0,t.jsxs)(n.p,{children:["To do that you can run the pending migrations in ",(0,t.jsx)(n.code,{children:"Webadmin > Update"}),". The apps below won't be automatically repaired, you need to force-upgrade them manually instead with ",(0,t.jsx)(n.code,{children:"yunohost app upgrade -F APP"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Apps which won't be automatically repaired and need a force upgrade:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"calibreweb"}),"\n",(0,t.jsx)(n.li,{children:"django-for-runners"}),"\n",(0,t.jsx)(n.li,{children:"ffsync (this app is in python2 and no longer maintained, no guarantee)"}),"\n",(0,t.jsx)(n.li,{children:"jupiterlab"}),"\n",(0,t.jsx)(n.li,{children:"librephotos"}),"\n",(0,t.jsx)(n.li,{children:"mautrix"}),"\n",(0,t.jsx)(n.li,{children:"mediadrop"}),"\n",(0,t.jsx)(n.li,{children:"mopidy"}),"\n",(0,t.jsx)(n.li,{children:"pgadmin"}),"\n",(0,t.jsx)(n.li,{children:"tracim"}),"\n",(0,t.jsx)(n.li,{children:"synapse"}),"\n",(0,t.jsx)(n.li,{children:"weblate"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If needed, you can disable the automatic rebuild for a specific python app, by removing the dedicated file ending with ",(0,t.jsx)(n.code,{children:".requirements_backup_for_bullseye_upgrade.txt"})," before applying the migration. You can find this file near the venv (Python virtual environment) of your app inside ",(0,t.jsx)(n.code,{children:"/opt"})," or ",(0,t.jsx)(n.code,{children:"/var/www"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"check-that-no-issue-appeared-in-the-diagnosis",children:"Check that no issue appeared in the diagnosis"}),"\n",(0,t.jsx)(n.p,{children:"Also in the webadmin Diagnosis section, make sure that no specific issue appeared after running the migration (for example a service that crashed for some reason)."}),"\n",(0,t.jsxs)(n.p,{children:["If the service ",(0,t.jsx)(n.code,{children:"php7.3-fpm"})," appears to be dead, you should upgrade your PHP apps like the custom web app. Next, you can run ",(0,t.jsx)(n.code,{children:"apt autoremove"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"v\xe9rifiez-que-les-applications-fonctionnent",children:"V\xe9rifiez que les applications fonctionnent"}),"\n",(0,t.jsx)(n.p,{children:"V\xe9rifiez que vos applications install\xe9es fonctionnent... Si elles ne fonctionnent pas, il est recommand\xe9 de tenter de les mettre \xe0 jour. (ou bien de mani\xe8re g\xe9n\xe9rale, il est recommand\xe9 de les mettre \xe0 jour m\xeame si elles fonctionnent\u202F!)."}),"\n",(0,t.jsxs)(n.p,{children:["Si votre app est cass\xe9e et que vous \xe9tiez d\xe9j\xe0 sur la derni\xe8re version d'une application, vous pouvez relancer la mise \xe0 jour gr\xe2ce \xe0 l'option ",(0,t.jsx)(n.code,{children:"--force"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yunohost app upgrade --force APP_NAME\n"})}),"\n",(0,t.jsx)(n.h2,{id:"soucis-connus-apr\xe8s-la-migration",children:"Soucis connus apr\xe8s la migration"}),"\n",(0,t.jsxs)(n.h3,{id:"cant-run-the-migration-due-to-libc6-dev--breaks-libgcc-8-dev-issue",children:["Can't run the migration due to ",(0,t.jsx)(n.code,{children:"libc6-dev : Breaks: libgcc-8-dev issue"})]}),"\n",(0,t.jsxs)(n.p,{children:["Note: This issue should be resolved in ",(0,t.jsx)(n.code,{children:"yunohost_version"}),": ",(0,t.jsx)(n.code,{children:"4.4.2.13"}),"\nYou have an app that depends on the ",(0,t.jsx)(n.code,{children:"build-essential"})," package."]}),"\n",(0,t.jsxs)(n.p,{children:["See this ",(0,t.jsx)(n.a,{href:"https://forum.yunohost.org/t/migration-to-11-wont-start-libc6-dev-breaks-libgcc-8-dev/20617/42",children:"solution"})," to fix it manually"]}),"\n",(0,t.jsx)(n.h3,{id:"dnsmasq-is-not-running-anymore",children:"DNSmasq is not running anymore"}),"\n",(0,t.jsx)(n.p,{children:"We haven't yet found  solution for this issue."}),"\n",(0,t.jsx)(n.h3,{id:"no-ethernet-connexion-after-rebooting-following-a-migration-on-a-raspberry-pi-4",children:"No ethernet connexion after rebooting following a migration on a Raspberry Pi 4"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"If you have not yet rebooted your server, don't do it (we are looking for a solution). This will avoid you the use of a keyboard and screen."})}),"\n",(0,t.jsx)(n.p,{children:"We found this in the Raspberry Pi documentation"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:'when the dhcpcd5 package is updated to the latest version (1:8.1.2-1+rpt1 -> 1:8.1.2-1+rpt2), the Raspberry Pi will fail to obtain a DHCP IP address following the next reboot or startup. This problem can be avoided by disabling and re-enabling the "System Options -> Network at Boot" option using the latest raspi-config after the dhcpcd5 package has been updated and prior to the system being shutdown or rebooted'}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If you are using a Raspberry Pi 4 (or maybe 3), see this ",(0,t.jsx)(n.a,{href:"https://forum.yunohost.org/t/aucun-acces-a-internet-suite-a-migration-4-4-to-11-depuis-raspberry-pi-4-pi-400/20652/17",children:"solution"})]}),"\n",(0,t.jsx)(n.h3,{id:"restore-ynh4-backup-onto-a-fresh-ynh11",children:"Restore ynh4 backup onto a fresh ynh11"}),"\n",(0,t.jsx)(n.p,{children:"If you can't restore your app but your system has been restored, you probably should use the regen conf to fix the nginx issues:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yunohost tools regenconf nginx --force\n"})}),"\n",(0,t.jsx)(n.p,{children:"After that you should be able to restore your apps. Don't forget to force upgrade them if you have 502 errors."})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},4429:function(e,n,i){i.d(n,{R:()=>r,x:()=>s});var o=i(6540);let t={},a=o.createContext(t);function r(e){let n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);