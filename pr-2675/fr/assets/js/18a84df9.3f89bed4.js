"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["8017"],{8457:function(e,s,r){r.r(s),r.d(s,{frontMatter:()=>u,toc:()=>c,default:()=>h,metadata:()=>a,assets:()=>d,contentTitle:()=>o});var a=JSON.parse('{"id":"admin/backups/index","title":"\u{1F691} Sauvegardes","description":"Dans le contexte de l\'auto-h\xe9bergement, les sauvegardes (backups) sont un \xe9l\xe9ment important pour pallier les \xe9v\xe9nements inattendus (incendies, corruption de base de donn\xe9es, perte d\'acc\xe8s au serveur, serveur compromis...). La politique de sauvegardes \xe0 mettre en place d\xe9pend de l\'importance des services et des donn\xe9es que vous g\xe9rez. Par exemple, sauvegarder un serveur de test aura peu d\'int\xe9r\xeat, tandis que vous voudrez \xeatre tr\xe8s prudent\u22C5e si vous g\xe9rez des donn\xe9es critiques pour une association ou une entreprise. Dans ce genre de cas, il est crucial d\'avoir de disposer de sauvegardes dans un, ou id\xe9alement plusieurs endroits diff\xe9rents.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/index.mdx","sourceDirName":"admin/40.backups","slug":"/admin/backups/","permalink":"/doc/pr-2675/fr/admin/backups/","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/index.mdx","tags":[],"version":"current","frontMatter":{"title":"\u{1F691} Sauvegardes"},"sidebar":"admin","previous":{"title":"Migrer ses emails d\'un ancien serveur mail vers YunoHost","permalink":"/doc/pr-2675/fr/admin/email/migration"},"next":{"title":"Strat\xe9gies de sauvegarde","permalink":"/doc/pr-2675/fr/admin/backups/evaluate"}}'),n=r(4848),i=r(4429),t=r(4109),l=r(3703);let u={title:"\u{1F691} Sauvegardes"},o,d={},c=[{value:"Sauvegarde manuelle",id:"sauvegarde-manuelle",level:2},{value:"Cr\xe9er une sauvegarde",id:"cr\xe9er-une-sauvegarde",level:4},{value:"T\xe9l\xe9charger la sauvegarde",id:"t\xe9l\xe9charger-la-sauvegarde",level:3},{value:"Tester",id:"tester",level:3},{value:"Restaurer",id:"restaurer",level:3},{value:"Cas simple : peu de donn\xe9es, archive d\xe9j\xe0 pr\xe9sente",id:"cas-simple--peu-de-donn\xe9es-archive-d\xe9j\xe0-pr\xe9sente",level:4},{value:"T\xe9l\xe9verser une archive",id:"t\xe9l\xe9verser-une-archive",level:4}];function p(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.p,{children:["Dans le contexte de l'auto-h\xe9bergement, les sauvegardes (backups) sont un \xe9l\xe9ment important pour pallier les \xe9v\xe9nements inattendus (incendies, corruption de base de donn\xe9es, perte d'acc\xe8s au serveur, serveur compromis...). La politique de sauvegardes \xe0 mettre en place d\xe9pend de l'importance des services et des donn\xe9es que vous g\xe9rez. Par exemple, sauvegarder un serveur de test aura peu d'int\xe9r\xeat, tandis que vous voudrez \xeatre tr\xe8s prudent\u22C5e si vous g\xe9rez des donn\xe9es critiques pour une association ou une entreprise. Dans ce genre de cas, il est crucial d'avoir de disposer de sauvegardes dans un, ou id\xe9alement ",(0,n.jsx)(s.strong,{children:"plusieurs"})," endroits diff\xe9rents."]}),"\n",(0,n.jsx)(s.h2,{id:"sauvegarde-manuelle",children:"Sauvegarde manuelle"}),"\n",(0,n.jsx)(s.p,{children:"YunoHost est fourni avec un syst\xe8me de sauvegarde, qui permet de sauvegarder (et restaurer) les configurations du syst\xe8me, les donn\xe9es \xab syst\xe8me \xbb (comme les mails) et les applications si elles le supportent."}),"\n",(0,n.jsxs)(s.p,{children:["Vous pouvez g\xe9rer vos sauvegardes via la ligne de commande (",(0,n.jsx)(s.code,{children:"yunohost backup --help"}),") ou la webadmin (dans la section Sauvegardes) bien que certaines fonctionnalit\xe9s ne soient pas disponibles via celle-ci."]}),"\n",(0,n.jsxs)(s.p,{children:["La m\xe9thode de sauvegarde actuelle consiste \xe0 cr\xe9er des archives ",(0,n.jsx)(s.code,{children:".tar"})," qui contiennent les fichiers pertinents."]}),"\n",(0,n.jsx)(s.h4,{id:"cr\xe9er-une-sauvegarde",children:"Cr\xe9er une sauvegarde"}),"\n",(0,n.jsxs)(t.A,{groupId:"admin-commands",children:[(0,n.jsxs)(l.A,{value:"web",label:"Depuis la webadmin",children:[(0,n.jsxs)(s.p,{children:["Vous pouvez facilement cr\xe9er des archives depuis la webadmin en allant dans ",(0,n.jsx)(s.code,{children:"Sauvegardes > Archives locales"})," et en cliquant sur ",(0,n.jsx)(s.code,{children:"Nouvelle sauvegarde"}),'. Vous pourrez ensuite s\xe9lectionner les \xe9l\xe9ments \xe0 sauvegarder (configuration, donn\xe9es "syst\xe8me", applications).']}),(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"Image de l&#39;\xe9cran de sauvegarde de YunoHost dans la webadmin",src:r(2226).A+"",width:"456",height:"505"})})]}),(0,n.jsxs)(l.A,{value:"cli",label:"Depuis la ligne de commande",children:[(0,n.jsx)(s.p,{children:"Vous pouvez cr\xe9er de nouvelles archives depuis la ligne de commande. Voici quelques exemples de commandes et leur comportement correspondant :"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Tout sauvegarder (syst\xe8me et apps) :"}),"\n"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"yunohost backup create\n"})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Sauvegarder seulement les apps :"}),"\n"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"yunohost backup create --apps\n"})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Sauvegarder seulement deux apps (WordPress et Shaarli) :"}),"\n"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"yunohost backup create --apps wordpress shaarli\n"})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Sauvegarder seulement les mails :"}),"\n"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"yunohost backup create --system data_mail\n"})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Sauvegarder les mails et WordPress :"}),"\n"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"yunohost backup create --system data_mail --apps wordpress\n"})}),(0,n.jsxs)(s.p,{children:["Pour plus d'informations et d'options sur la cr\xe9ation d'archives, consultez ",(0,n.jsx)(s.code,{children:"yunohost backup create --help"}),". Vous pouvez \xe9galement lister les parties du syst\xe8me qui sont sauvegardables avec ",(0,n.jsx)(s.code,{children:"yunohost hook list backup"}),"."]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"t\xe9l\xe9charger-la-sauvegarde",children:"T\xe9l\xe9charger la sauvegarde"}),"\n",(0,n.jsxs)(t.A,{groupId:"admin-commands",children:[(0,n.jsxs)(l.A,{value:"web",label:"Depuis la webadmin",children:[(0,n.jsx)(s.p,{children:"Apr\xe8s avoir cr\xe9\xe9 des sauvegardes, il est possible de les lister et de les inspecter gr\xe2ce aux vues correspondantes dans l'interface d'administration web. Un bouton propose de t\xe9l\xe9charger l'archive. Si l'archive fait plus de 3Go, il peut \xeatre pr\xe9f\xe9rable de proc\xe9der via SFTP."}),(0,n.jsx)(s.p,{children:(0,n.jsx)(s.code,{children:"Sauvegarde > Archives locales > <Nom de l'archive> > T\xe9l\xe9charger"})})]}),(0,n.jsxs)(l.A,{value:"sftp",label:"Avec un client SFTP",children:[(0,n.jsxs)(s.p,{children:["\xc0 l'heure actuelle, la solution la plus accessible pour r\xe9cup\xe9rer les sauvegardes de grosse taille est d'utiliser le programme FileZilla comme expliqu\xe9 dans ",(0,n.jsx)(s.a,{href:"/admin/tutorials/filezilla",children:"cette page"}),"."]}),(0,n.jsxs)(s.p,{children:["Par d\xe9faut, les sauvegardes sont stock\xe9es dans ",(0,n.jsx)(s.code,{children:"/home/yunohost.backup/archives/"}),"."]})]}),(0,n.jsxs)(l.A,{value:"cli",label:"Depuis la ligne de commande",children:[(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"yunohost backup list"})," and ",(0,n.jsx)(s.code,{children:"yunohost backup info <archive_name>"})," commands provide information about the names and sizes of backups."]}),(0,n.jsxs)(s.p,{children:["Il est possible d'utiliser ",(0,n.jsx)(s.code,{children:"scp"})," (un programme bas\xe9 sur ",(0,n.jsx)(s.code,{children:"ssh"}),") pour copier des fichiers entre deux machines gr\xe2ce \xe0 la ligne de commande. Ainsi, depuis une machine sous GNU/Linux, vous pouvez utiliser la commande suivante pour t\xe9l\xe9charger une archive :"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"scp admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./\n"})}),(0,n.jsx)(s.p,{children:"En cas de port SSH autre que 22 :"}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"scp -P ssh_port admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./\n"})})]})]}),"\n",(0,n.jsx)(s.admonition,{type:"caution",children:(0,n.jsx)(s.p,{children:"N'oubliez pas de stocker votre sauvegarde dans un lieu diff\xe9rents de celui ou se trouve votre serveur."})}),"\n",(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsxs)(s.p,{children:["Si vous le souhaitez, vous pouvez connecter un disque externe \xe0 votre serveur pour que les archives arrivent directement dessus. Voir ce guide pour ",(0,n.jsx)(s.a,{href:"/admin/tutorials/external_storage",children:"Ajouter un stockage externe \xe0 son serveur"})]})}),"\n",(0,n.jsx)(s.h3,{id:"tester",children:"Tester"}),"\n",(0,n.jsx)(s.p,{children:"Vous devriez tester r\xe9guli\xe8rement vos sauvegardes \xe0 minima en listant le contenu des archives et en v\xe9rifiant le poids des donn\xe9es associ\xe9es. Le mieux est de s'entrainer r\xe8guli\xe8rement \xe0 restaurer."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:'# List the files\ntar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | less\n\n# List database exports\ntar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | grep "(db|dump)`.sql"\n\n# Check the weight\nls -lh /home/yunohost.backup/archives/ARCHIVE.tar\n'})}),"\n",(0,n.jsx)(s.h3,{id:"restaurer",children:"Restaurer"}),"\n",(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsx)(s.p,{children:"SPOILER: Plus votre volume de donn\xe9es et le nombre d'applications sont important, plus votre restauration sera complexe."})}),"\n",(0,n.jsx)(s.h4,{id:"cas-simple--peu-de-donn\xe9es-archive-d\xe9j\xe0-pr\xe9sente",children:"Cas simple : peu de donn\xe9es, archive d\xe9j\xe0 pr\xe9sente"}),"\n",(0,n.jsxs)(t.A,{groupId:"admin-commands",children:[(0,n.jsxs)(l.A,{value:"web",label:"Depuis la webadmin",children:[(0,n.jsxs)(s.p,{children:["Allez dans ",(0,n.jsx)(s.code,{children:"Sauvegardes > Archives locales"}),' et s\xe9lectionnez l\'archive. Vous pouvez ensuite choisir les diff\xe9rents \xe9l\xe9ments que vous voulez restaurer puis cliquer sur "Restaurer".']}),(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"picture of YunoHost&#39;s restore pannel",src:r(3532).A+"",width:"456",height:"342"})})]}),(0,n.jsxs)(l.A,{value:"cli",label:"Depuis la ligne de commande",children:[(0,n.jsxs)(s.p,{children:["\xc0 partir de la ligne de commande, vous pouvez ex\xe9cuter ",(0,n.jsx)(s.code,{children:"yunohost backup list"})," pour obtenir les noms des archives disponibles. Il s'agit essentiellement de leur nom de fichier sans extension."]}),(0,n.jsxs)(s.p,{children:["You can then run ",(0,n.jsx)(s.code,{children:"yunohost backup restore <archivename>"})," (hence without its ",(0,n.jsx)(s.code,{children:".tar"})," extension) to restore an archive. As for ",(0,n.jsx)(s.code,{children:"yunohost backup create"}),", this will restore everything in the archive by default. If you want to restore only specific items, you can use something like ",(0,n.jsx)(s.code,{children:"yunohost backup restore <archivename> --apps wordpress"}),", which will restore only the wordpress app."]}),(0,n.jsx)(s.admonition,{type:"tip",children:(0,n.jsx)(s.p,{children:"Dans le cas d'une restauration compl\xe8te, il est possible de restaurer \xe0 la place de lancer la configuration initiale."})})]})]}),"\n",(0,n.jsx)(s.p,{children:"Pour restaurer une application, le domaine sur laquelle elle est install\xe9e doit d\xe9j\xe0 \xeatre configur\xe9 (ou il vous faut restaurer en m\xeame temps la configuration correspondante). Aussi, il n'est pas possible de restaurer une application d\xe9j\xe0 install\xe9e... ce qui veut dire que pour restaurer une sauvegarde d'une app, il vous faut d\xe9j\xe0 la d\xe9sinstaller."}),"\n",(0,n.jsx)(s.h4,{id:"t\xe9l\xe9verser-une-archive",children:"T\xe9l\xe9verser une archive"}),"\n",(0,n.jsx)(s.p,{children:"Dans de nombreux cas, l'archive n'est pas sur le serveur sur lequel on souhaite la restaurer. Il faut donc la t\xe9l\xe9verser, ce qui selon son poids peut prend plus ou moins de temps."}),"\n",(0,n.jsxs)(t.A,{groupId:"admin-commands",children:[(0,n.jsxs)(l.A,{value:"sftp",label:"Avec un client SFTP",children:[(0,n.jsxs)(s.p,{children:["\xc0 l'heure actuelle, la solution la plus accessible pour t\xe9l\xe9verser les sauvegardes est d'utiliser le programme FileZilla comme expliqu\xe9 dans ",(0,n.jsx)(s.a,{href:"/admin/tutorials/filezilla",children:"cette page"}),"."]}),(0,n.jsxs)(s.p,{children:["Par d\xe9faut, les sauvegardes sont \xe0 placer dans ",(0,n.jsx)(s.code,{children:"/home/yunohost.backup/archives/"}),"."]})]}),(0,n.jsxs)(l.A,{value:"cli",label:"Depuis la ligne de commande",children:[(0,n.jsxs)(s.p,{children:["You can use the ",(0,n.jsx)(s.code,{children:"scp"})," (a command built on ",(0,n.jsx)(s.code,{children:"ssh"}),") to copy files between two machines from CLI. For example for a Linux terminal:"]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"scp /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/\n"})}),(0,n.jsx)(s.p,{children:"En cas de port SSH autre que 22 :"}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"scp -P ssh_port /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/\n"})})]})]})]})}function h(e={}){let{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},2226:function(e,s,r){r.d(s,{A:()=>a});let a=r.p+"assets/images/backup-e0d7d8d8731b1e1a65ddb477d866dc72.png"},3532:function(e,s,r){r.d(s,{A:()=>a});let a=r.p+"assets/images/restore-6249e66027da3368ac270ff7c9ea3c05.png"},3703:function(e,s,r){r.d(s,{A:()=>i});var a=r(4848);r(6540);var n=r(9836);function i({children:e,hidden:s,className:r}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,n.A)("tabItem_Ymn6",r),hidden:s,children:e})}},4109:function(e,s,r){r.d(s,{A:()=>f});var a=r(4848),n=r(6540),i=r(9836),t=r(6364),l=r(8251),u=r(6347),o=r(8004),d=r(5580),c=r(2213),p=r(5734);function h(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){let{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:s}){return s.some(s=>s.value===e)}var v=r(8864);function g({className:e,block:s,selectedValue:r,selectValue:n,tabValues:t}){let u=[],{blockElementScrollPositionUntilNextRender:o}=(0,l.a_)(),d=e=>{let s=e.currentTarget,a=t[u.indexOf(s)].value;a!==r&&(o(s),n(a))},c=e=>{let s=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let r=u.indexOf(e.currentTarget)+1;s=u[r]??u[0];break}case"ArrowLeft":{let r=u.indexOf(e.currentTarget)-1;s=u[r]??u[u.length-1]}}s?.focus()};return(0,a.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":s},e),children:t.map(({value:e,label:s,attributes:n})=>(0,a.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{u.push(e)},onKeyDown:c,onClick:d,...n,className:(0,i.A)("tabs__item","tabItem_LNqP",n?.className,{"tabs__item--active":r===e}),children:s??e},e))})}function x({lazy:e,children:s,selectedValue:r}){let t=(Array.isArray(s)?s:[s]).filter(Boolean);if(e){let e=t.find(e=>e.props.value===r);return e?(0,n.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,a.jsx)("div",{className:"margin-top--md",children:t.map((e,s)=>(0,n.cloneElement)(e,{key:s,hidden:e.props.value!==r}))})}function b(e){let s=function(e){let s,{defaultValue:r,queryString:a=!1,groupId:i}=e,t=function(e){let{values:s,children:r}=e;return(0,n.useMemo)(()=>{let e=s??h(r).map(({props:{value:e,label:s,attributes:r,default:a}})=>({value:e,label:s,attributes:r,default:a})),a=(0,c.XI)(e,(e,s)=>e.value===s.value);if(a.length>0)throw Error(`Docusaurus error: Duplicate values "${a.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[s,r])}(e),[l,v]=(0,n.useState)(()=>(function({defaultValue:e,tabValues:s}){if(0===s.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:s}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${s.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let r=s.find(e=>e.default)??s[0];if(!r)throw Error("Unexpected error: 0 tabValues");return r.value})({defaultValue:r,tabValues:t})),[g,x]=function({queryString:e=!1,groupId:s}){let r=(0,u.W6)(),a=function({queryString:e=!1,groupId:s}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!s)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:e,groupId:s});return[(0,d.aZ)(a),(0,n.useCallback)(e=>{if(!a)return;let s=new URLSearchParams(r.location.search);s.set(a,e),r.replace({...r.location,search:s.toString()})},[a,r])]}({queryString:a,groupId:i}),[b,f]=function({groupId:e}){let s=e?`docusaurus.tab.${e}`:null,[r,a]=(0,p.Dv)(s);return[r,(0,n.useCallback)(e=>{s&&a.set(e)},[s,a])]}({groupId:i}),j=m({value:s=g??b,tabValues:t})?s:null;return(0,o.A)(()=>{j&&v(j)},[j]),{selectedValue:l,selectValue:(0,n.useCallback)(e=>{if(!m({value:e,tabValues:t}))throw Error(`Can't select invalid tab value=${e}`);v(e),x(e),f(e)},[x,f,t]),tabValues:t}}(e);return(0,a.jsxs)("div",{className:(0,i.A)(t.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,a.jsx)(g,{...s,...e}),(0,a.jsx)(x,{...s,...e})]})}function f(e){let s=(0,v.A)();return(0,a.jsx)(b,{...e,children:h(e.children)},String(s))}},4429:function(e,s,r){r.d(s,{R:()=>t,x:()=>l});var a=r(6540);let n={},i=a.createContext(n);function t(e){let s=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);