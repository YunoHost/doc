---
title: 'üöë Sauvegardes'
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

Dans le contexte de l'auto-h√©bergement, les sauvegardes (backups) sont un √©l√©ment important pour pallier les √©v√©nements inattendus (incendies, corruption de base de donn√©es, perte d'acc√®s au serveur, serveur compromis...). La politique de sauvegardes √† mettre en place d√©pend de l'importance des services et des donn√©es que vous g√©rez. Par exemple, sauvegarder un serveur de test aura peu d'int√©r√™t, tandis que vous voudrez √™tre tr√®s prudent‚ãÖe si vous g√©rez des donn√©es critiques pour une association ou une entreprise. Dans ce genre de cas, il est crucial d'avoir de disposer de sauvegardes dans un, ou id√©alement **plusieurs** endroits diff√©rents.

## Sauvegarde manuelle

YunoHost est fourni avec un syst√®me de sauvegarde, qui permet de sauvegarder (et restaurer) les configurations du syst√®me, les donn√©es ¬´ syst√®me ¬ª (comme les mails) et les applications si elles le supportent.

Vous pouvez g√©rer vos sauvegardes via la ligne de commande (`yunohost backup --help`) ou la webadmin (dans la section Sauvegardes) bien que certaines fonctionnalit√©s ne soient pas disponibles via celle-ci.

La m√©thode de sauvegarde actuelle consiste √† cr√©er des archives `.tar` qui contiennent les fichiers pertinents.

#### Cr√©er une sauvegarde

<Tabs groupId="admin-commands">
<TabItem value="web" label="Depuis la webadmin">

Vous pouvez facilement cr√©er des archives depuis la webadmin en allant dans `Sauvegardes > Archives locales` et en cliquant sur `Nouvelle sauvegarde`. Vous pourrez ensuite s√©lectionner les √©l√©ments √† sauvegarder (configuration, donn√©es "syst√®me", applications).

![Image de l'√©cran de sauvegarde de YunoHost dans la webadmin](/img/webadmin/backup.png)

</TabItem>
<TabItem value="cli" label="Depuis la ligne de commande">

Vous pouvez cr√©er de nouvelles archives depuis la ligne de commande. Voici quelques exemples de commandes et leur comportement correspondant :

- Tout sauvegarder (syst√®me et apps) :

```bash
yunohost backup create
```

- Sauvegarder seulement les apps :

```bash
yunohost backup create --apps
```

- Sauvegarder seulement deux apps (WordPress et Shaarli) :

```bash
yunohost backup create --apps wordpress shaarli
```

- Sauvegarder seulement les mails :

```bash
yunohost backup create --system data_mail
```

- Sauvegarder les mails et WordPress :

```bash
yunohost backup create --system data_mail --apps wordpress
```

Pour plus d'informations et d'options sur la cr√©ation d'archives, consultez `yunohost backup create --help`. Vous pouvez √©galement lister les parties du syst√®me qui sont sauvegardables avec `yunohost hook list backup`.

</TabItem>
</Tabs>

### T√©l√©charger la sauvegarde

<Tabs groupId="admin-commands">
<TabItem value="web" label="Depuis la webadmin">

Apr√®s avoir cr√©√© des sauvegardes, il est possible de les lister et de les inspecter gr√¢ce aux vues correspondantes dans l'interface d'administration web. Un bouton propose de t√©l√©charger l'archive. Si l'archive fait plus de 3Go, il peut √™tre pr√©f√©rable de proc√©der via SFTP.

`Sauvegarde > Archives locales > <Nom de l'archive> > T√©l√©charger`

</TabItem>
<TabItem value="sftp" label="Avec un client SFTP">

√Ä l'heure actuelle, la solution la plus accessible pour r√©cup√©rer les sauvegardes de grosse taille est d'utiliser le programme FileZilla comme expliqu√© dans [cette page](/admin/tutorials/filezilla).

Par d√©faut, les sauvegardes sont stock√©es dans `/home/yunohost.backup/archives/`.

</TabItem>
<TabItem value="cli" label="Depuis la ligne de commande">

The `yunohost backup list` and `yunohost backup info <archive_name>` commands provide information about the names and sizes of backups.

Il est possible d'utiliser `scp` (un programme bas√© sur `ssh`) pour copier des fichiers entre deux machines gr√¢ce √† la ligne de commande. Ainsi, depuis une machine sous GNU/Linux, vous pouvez utiliser la commande suivante pour t√©l√©charger une archive :

```bash
scp admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./
```

En cas de port SSH autre que 22 :

```bash
scp -P ssh_port admin@your.domain.tld:/home/yunohost.backup/archives/<archive_name>.tar ./
```

</TabItem>
</Tabs>


:::caution
N'oubliez pas de stocker votre sauvegarde dans un lieu diff√©rents de celui ou se trouve votre serveur.
:::

:::info
Si vous le souhaitez, vous pouvez connecter un disque externe √† votre serveur pour que les archives arrivent directement dessus. Voir ce guide pour [Ajouter un stockage externe √† son serveur](/admin/tutorials/external_storage)
:::

### Tester

Vous devriez tester r√©guli√®rement vos sauvegardes √† minima en listant le contenu des archives et en v√©rifiant le poids des donn√©es associ√©es. Le mieux est de s'entrainer r√®guli√®rement √† restaurer.

```bash
# List the files
tar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | less

# List database exports
tar -tvf /home/yunohost.backup/archives/ARCHIVE.tar | grep "(db|dump)`.sql"

# Check the weight
ls -lh /home/yunohost.backup/archives/ARCHIVE.tar
```

### Restaurer

:::info
SPOILER: Plus votre volume de donn√©es et le nombre d'applications sont important, plus votre restauration sera complexe.
:::

#### Cas simple : peu de donn√©es, archive d√©j√† pr√©sente

<Tabs groupId="admin-commands">
<TabItem value="web" label="Depuis la webadmin">

Allez dans `Sauvegardes > Archives locales` et s√©lectionnez l'archive. Vous pouvez ensuite choisir les diff√©rents √©l√©ments que vous voulez restaurer puis cliquer sur "Restaurer".

![picture of YunoHost's restore pannel](/img/webadmin/restore.png)

</TabItem>
<TabItem value="cli" label="Depuis la ligne de commande">

√Ä partir de la ligne de commande, vous pouvez ex√©cuter `yunohost backup list` pour obtenir les noms des archives disponibles. Il s'agit essentiellement de leur nom de fichier sans extension.

You can then run `yunohost backup restore <archivename>` (hence without its `.tar` extension) to restore an archive. As for `yunohost backup create`, this will restore everything in the archive by default. If you want to restore only specific items, you can use something like `yunohost backup restore <archivename> --apps wordpress`, which will restore only the wordpress app.

:::tip
Dans le cas d'une restauration compl√®te, il est possible de restaurer √† la place de lancer la configuration initiale.
:::

</TabItem>
</Tabs>

Pour restaurer une application, le domaine sur laquelle elle est install√©e doit d√©j√† √™tre configur√© (ou il vous faut restaurer en m√™me temps la configuration correspondante). Aussi, il n'est pas possible de restaurer une application d√©j√† install√©e... ce qui veut dire que pour restaurer une sauvegarde d'une app, il vous faut d√©j√† la d√©sinstaller.

#### T√©l√©verser une archive

Dans de nombreux cas, l'archive n'est pas sur le serveur sur lequel on souhaite la restaurer. Il faut donc la t√©l√©verser, ce qui selon son poids peut prend plus ou moins de temps.

<Tabs groupId="admin-commands">
<TabItem value="sftp" label="Avec un client SFTP">

√Ä l'heure actuelle, la solution la plus accessible pour t√©l√©verser les sauvegardes est d'utiliser le programme FileZilla comme expliqu√© dans [cette page](/admin/tutorials/filezilla).

Par d√©faut, les sauvegardes sont √† placer dans `/home/yunohost.backup/archives/`.

</TabItem>
<TabItem value="cli" label="Depuis la ligne de commande">

You can use the `scp` (a command built on `ssh`) to copy files between two machines from CLI. For example for a Linux terminal:

```bash
scp /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/
```

En cas de port SSH autre que 22 :

```bash
scp -P ssh_port /path/to/your/<archive_name>.tar admin@your.domain.tld:/home/yunohost.backup/archives/
```

</TabItem>
</Tabs>
