---
title: 'üõ†Ô∏è SSH et la ligne de commande'
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Qu‚Äôest-ce que SSH ?

**SSH** est un acronyme pour Secure Shell, et d√©signe un protocole qui permet de contr√¥ler et administrer √† distance une machine via la ligne de commande (CLI). C'est aussi une commande disponible de base dans les terminaux de GNU/Linux et macOS. Sous Windows, il vous faudra utiliser le logiciel [MobaXterm](https://mobaxterm.mobatek.net/download-home-edition.html) (apr√®s l'avoir lanc√©, cliquer sur Session puis SSH).

L'interface en ligne de commande (CLI) est, en informatique, la mani√®re originale (et plus technique) d'interagir avec un ordinateur, compar√©e aux interfaces graphiques. La ligne de commande est g√©n√©ralement consid√©r√©e comme plus compl√®te, puissante et efficace que les interfaces graphiques, bien que plus difficile √† apprendre.

## Comment se connecter ?

### Identifiants *avant* la postinstall

- If you are **installing at home**, the default credentials are login: `root` and password: `yunohost` (or `1234` if you flashed an armbian image)
- If you are **installing a remote server (VPS)**, your provider should have communicated you the login and password (or allowed you to configure an SSH key)

### Identifiants *apr√®s* la postinstall


Durant la post-installation, vous avez d√©fini un compte et un mot de passe d'administration. Le compte d√©fini lors de la post-installation vous permet de vous connecter en SSH. De plus, le mot de passe d√©fini dans la post-installation devient le nouveau mot de passe pour l'utilisateur `root`. Enfin, **la connexion en SSH avec l'utilisateur `root` est d√©sactiv√©e et il vous faut utiliser le compte d√©fini durant la post-installation !**. L'exception √† cette r√®gle est qu'il reste possible de se logger en root *depuis le r√©seau local - ou depuis une console en direct sur la machine* (ce qui peut √™tre utile dans l'√©ventualit√© o√π le serveur LDAP est inactif et l'utilisateur admin ne fonctionne plus).

:::tip
Si vous √™tes connect√© en tant avec le compte d'administration et souhaitez devenir `root` pour plus de confort (par exemple, ne pas avoir √† taper `sudo` √† chaque commande), vous pouvez devenir `root` en tapant `sudo su` ou `sudo -i`.
:::

### Adresse √† utiliser

Si vous h√©bergez votre serveur **√† la maison** (par ex. Raspberry Pi ou OLinuXino ou vieil ordinateur)

- you should be able to connect to your server using `yunohost.local` (or `yunohost-2.local`, depending on how many servers are on your network).
- if `yunohost.local` and the like do not work, your need to [find out the local IP of the server](/admin/get_started/post_install/find_ip).
- if you installed a server at home but are attempting to connect from outside your local network, make sure port 22 is correctly forwarded to your server.

S'il s'agit d'une machine distante (VPS), votre fournisseur devrait vous avoir communiqu√© l'IP de votre machine.

Dans tous les cas, si vous avez d√©j√† configur√© un nom de domaine qui pointe sur l'IP appropri√©e, il est plus pratique d'utiliser `votre.domaine.tld` plut√¥t que l'adresse IP.

### Se connecter

Ci-dessous quelques exemples de commande SSH typiques :

```bash
# before the postinstall:
ssh root@11.22.33.44

# or after the postinstall:
ssh username@11.22.33.44

# using the domain name instead of the IP (more convenient)
ssh username@your.domain.tld

# using the local domain name instead of the IP (for local access)
ssh username@yunohost.local

# if you changed the SSH port
ssh -p 2244 username@your.domain.tld
```
:::note
`fail2ban` bannira votre IP pendant 10 minutes si vous √©chouez plus de 10 fois √† vous identifier. Pour d√©bannir une IP, vous pouvez regarder la page sur [Fail2Ban](/admin/troubleshooting/fail2ban).
:::

## Autoriser un utilisateur YunoHost standard

Par d√©faut, seuls les comptes dans le groupe `admins` peuvent se connecter en SSH et SFTP sur une instance YunoHost. Les comptes hors de ce groupe ne peuvent se connecter pour des raisons de s√©curit√©. Avec le syst√®me de permissions il est possible d'autoriser la connexion en SFTP ou si c'est vraiment n√©cessaire en SSH.

:::caution
Faites attention √† qui vous donnez acc√®s √† SSH. Cela augmente encore plus la surface d'attaque disponible pour un utilisateur malveillant.
:::

<Tabs>
<TabItem value="web" label="Depuis la webadmin">

Se rendre dans `Utilisateurs > G√©rer les groupes et les autorisations`

√Ä partir de l√†, il est possible d'ajouter les permissions SFTP ou SSH √† un utilisateur ou un groupe au choix.

Si vous souhaitez ajouter une cl√© publique SSH √† l'utilisateur, vous devez le faire en ligne de commande, l'interface web ne proposant pas encore cette fonctionnalit√©.

</TabItem>
<TabItem value="cli" label="Depuis la ligne de commande">

Pour autoriser un utilisateur ou un groupe √† acc√©der en SFTP ou en SSH :

```bash
# SFTP
yunohost user permission add sftp <username>
# SSH
yunohost user permission add ssh <username>
```

Pour enlever la permission :

```bash
# SFTP
yunohost user permission remove sftp <username>
# SSH
yunohost user permission remove ssh <username>
```

Enfin, il est possible d'ajouter, de supprimer et de lister des cl√©s SSH, pour am√©liorer la s√©curit√© de l'acc√®s SSH, avec les commandes :

```bash
yunohost user ssh add-key <username> <key>
yunohost user ssh remove-key <username> <key>
yunohost user ssh list-keys <username>
```

</TabItem>
</Tabs>

## SSH et s√©curit√©

Une discussion plus compl√®te sur la s√©curit√© de SSH peut √™tre trouv√©e sur [la page d√©di√©e](/admin/tutorials/security).

## La ligne de commande

:::info
Fournir un tutoriel complet sur la ligne de commande est bien au-del√† du cadre de la documentation de YunoHost : pour cela, r√©f√©rez-vous √† des tutoriels comme [celui-ci](https://doc.ubuntu-fr.org/tutoriel/console_ligne_de_commande) ou [celui-ci (en)](http://linuxcommand.org/). Mais soyez rassur√©, il n'y a pas besoin d'√™tre un expert pour commencer √† l'utiliser !
:::

### La commande `yunohost`

La commande `yunohost` peut √™tre utilis√©e pour administrer votre serveur ou r√©aliser les m√™mes actions que celles disponibles sur la webadmin. Elle doit √™tre lanc√©e depuis l'utilisateur `root`, ou bien depuis un compte membre du groupe `admins` en pr√©c√©dant la commande de `sudo`. (ProTip‚Ñ¢ : il est possible de devenir `root` via la commande `sudo su` en tant que membre du group `admins`.)

Les commandes YunoHost ont ce type de structure :

```text
yunohost app install wordpress --label Webmail
          ^    ^        ^             ^
          |    |        |             |
    category  action  argument      options
```

N'h√©sitez pas √† naviguer et demander des informations √† propos d'une cat√©gorie ou action donn√©e via l'option `--help`. Par exemple, ces commandes :

```bash
yunohost --help
yunohost user --help
yunohost user create --help
```

vont successivement lister toutes les cat√©gories disponibles, puis les actions de la cat√©gorie `user`, puis expliquer comment utiliser l'action `user create`. Vous devriez remarquer que l'arbre des commandes YunoHost suit une structure similaire aux pages de la webadmin.

### La commande `yunopaste`

Cette commande est utile lorsque vous voulez communiquer √† une autre personne le retour d'une commande.

Exemple :

```bash
yunohost diagnosis show | yunopaste
```

### The `ynh-vpnclient-loadcubefile.sh` command

This command is only available if you have the `VPN Client` application installed. You can use it to load a new .cube in case you can't get to the VPN Client interface to do so.

```bash
ynh-vpnclient-loadcubefile.sh -u <username> -p <password> -c <path>.cube
```

### Quelques commandes utiles

Si votre interface web d'administration indique que l'API est injoignable, essayez de d√©marrer `yunohost-api` :

```bash
systemctl start yunohost-api
```

Si vous ne parvenez plus √† vous connecter avec l'utilisateur `admin` via SSH et via l'interface web, le service `slapd` est peut-√™tre √©teint, essayez de le red√©marrer :

```bash
systemctl restart slapd
```

Si vous avez des configurations modifi√©es manuellement et souhaitez conna√Ætre les modifications :

```bash
yunohost tools regen-conf --with-diff --dry-run
```
