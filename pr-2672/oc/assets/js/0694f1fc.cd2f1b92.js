"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["7309"],{9787:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>a,toc:()=>r,default:()=>h,metadata:()=>s,assets:()=>c,contentTitle:()=>l});var s=JSON.parse('{"id":"packaging/advanced/config_panels","title":"Config Panels","description":"From a practical point of view, one of the main purpose of config panel is to \\"expose\\" settings from the app\'s configuration files to YunoHost\'s admins which are therefore able to manipulate them from a nice web ui. This is especially relevant for apps which do not provide any sort of admin UI and expect admins to manually edit the configuration files.","source":"@site/docs/packaging/60.advanced/20.config_panels.mdx","sourceDirName":"packaging/60.advanced","slug":"/packaging/advanced/config_panels","permalink":"/doc/pr-2672/oc/packaging/advanced/config_panels","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/packaging/60.advanced/20.config_panels.mdx","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Config Panels"},"sidebar":"devpackaging","previous":{"title":"Advanced","permalink":"/doc/pr-2672/oc/packaging/advanced"},"next":{"title":"SSO/LDAP integration","permalink":"/doc/pr-2672/oc/packaging/advanced/sso_ldap_integration"}}'),t=i(4848),o=i(4429);let a={title:"Config Panels"},l,c={},r=[{value:"Community examples",id:"community-examples",level:2},{value:"Overview",id:"overview",level:2},{value:"Supported questions types and properties",id:"supported-questions-types-and-properties",level:2},{value:"The &quot;<code>bind</code>&quot; statement",id:"the-bind-statement",level:2},{value:"&quot;Binding&quot; to an entire file",id:"binding-to-an-entire-file",level:3},{value:"Custom getters/setters/validators (a.k.a <code>bind=null</code>)",id:"custom-getterssettersvalidators-aka-bindnull",level:3},{value:"Custom getters",id:"custom-getters",level:4},{value:"Custom setters",id:"custom-setters",level:4},{value:"User input validations",id:"user-input-validations",level:2},{value:"Custom validators",id:"custom-validators",level:3},{value:"<code>visible</code> &amp; <code>enabled</code> expression evaluation",id:"visible--enabled-expression-evaluation",level:2},{value:"Examples",id:"examples",level:3},{value:"match()",id:"match",level:3},{value:"Actions",id:"actions",level:2},{value:"Overwrite config panel mechanism",id:"overwrite-config-panel-mechanism",level:2},{value:"Important technical notes",id:"important-technical-notes",level:2},{value:"Options short keys have to be unique",id:"options-short-keys-have-to-be-unique",level:3},{value:"<code>bind</code> versus app settings",id:"bind-versus-app-settings",level:3}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"From a practical point of view, one of the main purpose of config panel is to \"expose\" settings from the app's configuration files to YunoHost's admins which are therefore able to manipulate them from a nice web ui. This is especially relevant for apps which do not provide any sort of admin UI and expect admins to manually edit the configuration files."}),"\n",(0,t.jsx)(n.p,{children:"Technically speaking, config panels are used both for apps packaging and also core features (domain configuration, global settings)"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:'Please: Keep in mind the YunoHost spirit, and try to build your panels in such a way as to expose only really useful, "high-level" parameters, and if there are many of them, to relegate those corresponding to rarer use cases to "Advanced" sub-sections. Keep it simple, focus on common needs, don\'t expect the admins to have 3 PhDs in computer science.'})}),"\n",(0,t.jsx)(n.h2,{id:"community-examples",children:"Community examples"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/example_ynh/blob/master/config_panel.toml.example",children:"Check the example_ynh app toml"})," and the ",(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost/example_ynh/blob/master/scripts/config",children:["basic ",(0,t.jsx)(n.code,{children:"scripts/config"})," example"]})]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://grep.app/search?q=version&filter%5Brepo.pattern%5D%5B0%5D=YunoHost-Apps&filter%5Blang%5D%5B0%5D=TOML",children:"Check config panels of other apps"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsxs)(n.a,{href:"https://grep.app/search?q=ynh_app_config_apply&filter%5Brepo.pattern%5D%5B0%5D=YunoHost-Apps&filter%5Blang%5D%5B0%5D=Shell",children:["Check ",(0,t.jsx)(n.code,{children:"scripts/config"})," of other apps"]})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["From an app packager perspective, config panels are defined in ",(0,t.jsx)(n.code,{children:"config_panel.toml"})," at the root of the app repository. It is coupled to the ",(0,t.jsx)(n.code,{children:"scripts/config"})," script, which may be used to define custom getters/setters/validations/actions. However, most use cases should be covered automagically by the core, thus it may not be necessary to define such a ",(0,t.jsx)(n.code,{children:"config"})," script at all!"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"config_panel.toml"})," describes one or several panels, containing sections, each containing questions generally binded to a params in the app's actual configuration files."]}),"\n",(0,t.jsxs)(n.p,{children:["Let's imagine that the upstream app is configured using this simple ",(0,t.jsx)(n.code,{children:"config.yml"})," file stored in the app's install directory (typically ",(0,t.jsx)(n.code,{children:"/var/www/$app/config.yml"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"title: 'My dummy app'\ntheme: 'white'\nmax_rate: 10\nmax_age: 365\n"})}),"\n",(0,t.jsx)(n.p,{children:"A simple configuration panel can be created with this syntax:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'version = "1.0"\n[main]\n\n    [main.main]\n        [main.main.title]\n        ask.en = "Title"\n        type = "string"\n        bind = ":__INSTALL_DIR__/config.yml"\n\n        [main.main.theme]\n        ask.en = "Theme"\n        type = "select"\n        choices = ["white", "dark"]\n        bind = ":__INSTALL_DIR__/config.yml"\n\n    [main.limits]\n        [main.limits.max_rate]\n        ask.en = "Maximum display rate"\n        type = "number"\n        bind = ":__INSTALL_DIR__/config.yml"\n\n        [main.limits.max_age]\n        ask.en = "Duration of a dummy"\n        type = "number"\n        bind = ":__INSTALL_DIR__/config.yml"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here, a ",(0,t.jsx)(n.code,{children:"main"})," panel is created, containing the ",(0,t.jsx)(n.code,{children:"main"})," and ",(0,t.jsx)(n.code,{children:"limits"})," sections, containing questions corresponding to app options in ",(0,t.jsx)(n.code,{children:"config.yml"})," file. Thanks to the ",(0,t.jsx)(n.code,{children:"bind"})," property, all those questions are read/written to their values in the actual ",(0,t.jsx)(n.code,{children:"config.yml"})," file."]}),"\n",(0,t.jsx)(n.h2,{id:"supported-questions-types-and-properties",children:"Supported questions types and properties"}),"\n",(0,t.jsxs)(n.p,{children:["You can learn more about the full list of option types and their properties in ",(0,t.jsx)(n.a,{href:"/dev/core/ynh_core/forms",children:"their dedicated page"}),"."]}),"\n",(0,t.jsxs)(n.h2,{id:"the-bind-statement",children:['The "',(0,t.jsx)(n.code,{children:"bind"}),'" statement']}),"\n",(0,t.jsxs)(n.p,{children:["Without any ",(0,t.jsx)(n.code,{children:"bind"})," statement attached to a config panel property, values are only read/written from/to the app's settings file (",(0,t.jsx)(n.code,{children:"/etc/yunohost/$app/settings.yml"}),"). This is usually not very useful in practice."]}),"\n",(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:'bind = ":/some/config/file"'}),", one declares that the actual truth used by the app lives in ",(0,t.jsx)(n.code,{children:"/some/config/file"}),". The config panel will read/write the value from/to this file. YunoHost will automagically adapt to classic formats such as YAML, TOML, JSON, INI, PHP, ",(0,t.jsx)(n.code,{children:".env"}),"-like and ",(0,t.jsx)(n.code,{children:".py"}),". (At least, assuming we're dealing with simple key<->value mappings)"]}),"\n",(0,t.jsx)(n.p,{children:"A simple real-life example looks like:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.main.theme]\ntype = "string"\nbind = ":__INSTALL_DIR__/config.yml"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In which case, YunoHost will look for something like a key/value, with the key being ",(0,t.jsx)(n.code,{children:"theme"})," inside the app's ",(0,t.jsx)(n.code,{children:"config.yml"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If the question id in the config panel (here, ",(0,t.jsx)(n.code,{children:"theme"}),") differs from the key in the actual conf file (let's say it's not ",(0,t.jsx)(n.code,{children:"theme"})," but ",(0,t.jsx)(n.code,{children:"css_theme"}),"), then the syntax becomes:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.main.theme]\ntype = "string"\nbind = "css_theme:__FINALPATH__/config.yml"\n'})}),"\n",(0,t.jsx)(n.p,{children:"You may also encounter situations such as:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "foo": {\n        "max": 123\n    },\n    "bar": {\n        "max": 456\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In which case if we want to interface with foo's ",(0,t.jsx)(n.code,{children:"max"})," value, let's write:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'bind = "foo>max:__INSTALL_DIR__/conf.json"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"binding-to-an-entire-file",children:'"Binding" to an entire file'}),"\n",(0,t.jsxs)(n.p,{children:["Useful when using a question ",(0,t.jsx)(n.code,{children:"file"})," or ",(0,t.jsx)(n.code,{children:"text"})," for which you want to save the raw content directly as a file on the system."]}),"\n",(0,t.jsx)(n.p,{children:"For example to be able to manipulate an image:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[panel.section.logo]\ntype = "file"\nbind = "__INSTALL_DIR__/assets/logo.png"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Or an entire text file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[panel.section.config_content]\ntype = "text"\nbind = "__INSTALL_DIR__/config.ini"\ndefault = "This is the default content"\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"custom-getterssettersvalidators-aka-bindnull",children:["Custom getters/setters/validators (a.k.a ",(0,t.jsx)(n.code,{children:"bind=null"}),")"]}),"\n",(0,t.jsx)(n.p,{children:"More complex use-case may appear, such as:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'you want to expose some "dynamic" information in the config panel, such as computed health status, computed disk usage, dynamic list of options, ...'}),"\n",(0,t.jsx)(n.li,{children:"password handling, where the data may be written but can't be read"}),"\n",(0,t.jsx)(n.li,{children:"the config file format is not supported (e.g. xml, csv, ...)"}),"\n",(0,t.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You can create specific getter/setters functions inside the ",(0,t.jsx)(n.code,{children:"config"})," script of the app to customize how the information is read/written. The basic structure of the script is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\nsource /usr/share/yunohost/helpers\n\nynh_abort_if_errors\n\n# Put your getter, setter, validator or action here\n\n# Keep this last line\nynh_app_config_run $1\n"})}),"\n",(0,t.jsx)(n.h4,{id:"custom-getters",children:"Custom getters"}),"\n",(0,t.jsxs)(n.p,{children:["A question's getter is the function used to read the current value/state. Custom getters are defined using bash functions called ",(0,t.jsx)(n.code,{children:"getter__QUESTION_SHORT_KEY()"})," which returns data through stdout."]}),"\n",(0,t.jsx)(n.p,{children:"Stdout can be generated into one of those formats:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"either just the raw value,"}),"\n",(0,t.jsxs)(n.li,{children:["or a YAML message, containing the value and other metadata and properties (for example the ",(0,t.jsx)(n.code,{children:"style"})," of an ",(0,t.jsx)(n.code,{children:"alert"}),", the list of available ",(0,t.jsx)(n.code,{children:"choices"})," of a ",(0,t.jsx)(n.code,{children:"select"}),", etc.)\nNote that in the first case, if the raw value contains any yaml-sensitive character (e.g. ",(0,t.jsx)(n.code,{children:"#"})," which is interpreted as a comment in yaml), make sure it is returned between escaped quotes (cf. dedicated example below) as it will be ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/2501",children:"converted to yaml"})," by YunoHost core in the end."]}),"\n"]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)("i",{children:"Basic example with raw stdout: get the timezone on the system"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"config_panel.toml"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.main.timezone]\nask = "Timezone"\ntype = "string"\n'})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"scripts/config"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'get__timezone() {\n    echo "$(cat /etc/timezone)"\n}\n'})})]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)("i",{children:"Basic example with raw stdout containing a yaml-sensitive character: return a HTML color code matched in a file"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"config_panel.toml"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.default_colors.background]\nask = "Default background color"\ntype = "color"\ndefault = "#cccccc"\n'})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"scripts/config"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'get__background() {\n    current_color=$(grep \'id="backgroundColorPicker\' "$install_dir/index.html" | grep -oP \'value="\\K[^"]*\') # e.g. #2B748B\n    # explicitely add escaped quotes to protect YAML-sensitive comment char (\'#\')\n    echo "\\"$current_color\\""\n}\n'})})]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)("i",{children:"Basic example with yaml-formated stdout : Display a list of available plugins"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"config_panel.toml"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.plugins.plugins]\nask = "Plugin to activate"\ntype = "tags"\nchoices = []\n'})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"scripts/config"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"get__plugins() {\n    echo \"choices: [$(ls $install_dir/plugins/ | tr '\\n' ',')]\"\n}\n"})})]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)("i",{children:"Advanced example with yaml-formated stdout : Display the status of a VPN"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"config_panel.toml"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.cube.status]\nask = "Custom getter alert"\ntype = "alert"\nstyle = "info"\nbind = "null" # no behaviour on\n'})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"scripts/config"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'get__status() {\n    if [ -f "/sys/class/net/tun0/operstate" ] && [ "$(cat /sys/class/net/tun0/operstate)" == "up" ]\n    then\n        cat << EOF\nstyle: success\nask:\n  en: Your VPN is running :)\nEOF\n    else\n        cat << EOF\nstyle: danger\nask:\n  en: Your VPN is down\nEOF\n    fi\n}\n'})})]}),"\n",(0,t.jsx)(n.h4,{id:"custom-setters",children:"Custom setters"}),"\n",(0,t.jsxs)(n.p,{children:["A question's setter is the function used to set new value/state. Custom setters are defined using bash functions called ",(0,t.jsx)(n.code,{children:"setter__QUESTION_SHORT_KEY()"}),". In the context of the setter function, variables named with the various quetion's short keys are avaible ... for example the user-specified date for question ",(0,t.jsx)(n.code,{children:"[main.main.theme]"})," is available as ",(0,t.jsx)(n.code,{children:"$theme"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["When doing non-trivial operations to set a value, you may want to use ",(0,t.jsx)(n.code,{children:"ynh_print_info"})," to inform the admin about what's going on."]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)("i",{children:"Basic example : Set the system timezone"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"config_panel.toml"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[main.main.timezone]\nask = "Timezone"\ntype = "string"\n'})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"scripts/config"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'set__timezone() {\n    echo "$timezone" > /etc/timezone\n    ynh_print_info "The timezone has been changed to $timezone"\n}\n'})})]}),"\n",(0,t.jsx)(n.h2,{id:"user-input-validations",children:"User input validations"}),"\n",(0,t.jsx)(n.p,{children:"You will sometimes need to validate data provided by the user before saving it."}),"\n",(0,t.jsx)(n.p,{children:"Simple validation can be achieved using a regex pattern:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:"pattern.regexp = '^.+@.+$'\npattern.error = 'An email is required for this field'\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can also restrict the accepted values using a choices list."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'choices.foo = "Foo (some explanation)"\nchoices.bar = "Bar (moar explanation)"\nchoices.loremipsum = "Lorem Ipsum Dolor Sit Amet"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Some other type specific argument exist like"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"type"}),(0,t.jsx)(n.th,{children:"validation arguments"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"number"}),", ",(0,t.jsx)(n.code,{children:"range"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"min"}),", ",(0,t.jsx)(n.code,{children:"max"}),", ",(0,t.jsx)(n.code,{children:"step"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"file"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"accept"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"boolean"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"yes"})," ",(0,t.jsx)(n.code,{children:"no"})]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"See also : custom validators"}),"\n",(0,t.jsx)(n.h3,{id:"custom-validators",children:"Custom validators"}),"\n",(0,t.jsx)(n.p,{children:"In addition to the \"simple\" validation mechanism (see the 'option' doc), custom validators can be defined in a similar fashion as custom getters/setters:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"validate__login_user() {\n    if [[ \"${#login_user}\" -lt 4 ]]\n    then\n        echo 'User login is too short, should be at least 4 chars'\n    fi\n}\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"visible--enabled-expression-evaluation",children:[(0,t.jsx)(n.code,{children:"visible"})," & ",(0,t.jsx)(n.code,{children:"enabled"})," expression evaluation"]}),"\n",(0,t.jsxs)(n.p,{children:["Sometimes we may want to conditionaly display a message or prompt for a value, for this we have the ",(0,t.jsx)(n.code,{children:"visible"})," prop.\nAnd we may want to allow a user to trigger an action only if some condition are met, for this we have the ",(0,t.jsx)(n.code,{children:"enabled"})," prop."]}),"\n",(0,t.jsx)(n.p,{children:"Expressions are evaluated against a context containing previous values of the current section's options. This quite limited current design exists because on the web-admin or on the CLI we cannot guarantee that a value will be present in the form if the user queried only a single panel/section/option.\nIn the case of an action, the user will be shown or asked for each of the options of the section in which the button is present."}),"\n",(0,t.jsx)(n.p,{children:"The expression has to be written in javascript (this has been designed for the web-admin first and is converted to python on the fly on the cli)."}),"\n",(0,t.jsxs)(n.p,{children:["Available operators are: ",(0,t.jsx)(n.code,{children:"=="}),", ",(0,t.jsx)(n.code,{children:"!="}),", ",(0,t.jsx)(n.code,{children:">"}),", ",(0,t.jsx)(n.code,{children:">="}),", ",(0,t.jsx)(n.code,{children:"<"}),", ",(0,t.jsx)(n.code,{children:"<="}),", ",(0,t.jsx)(n.code,{children:"!"}),", ",(0,t.jsx)(n.code,{children:"&&"}),", ",(0,t.jsx)(n.code,{children:"||"}),", ",(0,t.jsx)(n.code,{children:"+"}),", ",(0,t.jsx)(n.code,{children:"-"}),", ",(0,t.jsx)(n.code,{children:"*"}),", ",(0,t.jsx)(n.code,{children:"/"}),", ",(0,t.jsx)(n.code,{children:"%"})," and ",(0,t.jsx)(n.code,{children:"match()"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'# simple "my_option_id" is thruthy/falsy\nvisible = "my_option_id"\nvisible = "!my_option_id"\n# misc\nvisible = "my_value >= 10"\nvisible = "-(my_value + 1) < 0"\nvisible = "!!my_value || my_other_value"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For a more complete set of examples, ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/blob/dev/src/tests/test_questions.py",children:"check the tests at the end of the file"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"match",children:"match()"}),"\n",(0,t.jsx)(n.p,{children:"For more complex evaluation we can use regex matching."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[my_string]\ndefault = "Lorem ipsum dolor et si qua met!"\n\n[my_boolean]\ntype = "boolean"\nvisible = "my_string && match(my_string, \'^Lorem [ia]psumE?\')"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Match the content of a file."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[my_file]\ntype = "file"\naccept = ".txt"\nbind = "/etc/random/lorem.txt"\n\n[my_boolean]\ntype = "boolean"\nvisible = "my_file && match(my_file, \'^Lorem [ia]psumE?\')"\n'})}),"\n",(0,t.jsx)(n.p,{children:"with a file with content like:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"Lorem ipsum dolor et si qua met!\n"})}),"\n",(0,t.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,t.jsx)(n.p,{children:'"Actions" correspond to config panel buttons triggering specific pieces of code. For example, one could implement an action to trigger a scan of Nextcloud files, or install a plugin inside an app that does not already provide an interface to do so. In core config panels, buttons are for example used to trigger certificate renewal.'}),"\n",(0,t.jsxs)(n.p,{children:["The most basic example looks like this, using ",(0,t.jsx)(n.code,{children:"type = 'button'"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[panel.section.my_action]\ntype = "button"\nask = "Run action"\n# (NB: no need to set `bind` to "null")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["And then defining the controller, prefixed by ",(0,t.jsx)(n.code,{children:"run__"})," inside the app's ",(0,t.jsx)(n.code,{children:"config"})," script:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"run__my_action() {\n    ynh_print_info \"Running 'my_action'...\"\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"You may build more complex actions, where the actions uses other form inputs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[panel.my_action_section]\nname = "Action section"\n    [panel.my_action_section.my_repo]\n    type = "url"\n    bind = "null" # this value won\'t be saved as a setting, it\'s ephemeral and only relevant for the action\n    ask = "gimme a repo link"\n\n    [panel.my_action_section.my_repo_name]\n    type = "string"\n    bind = "null" # this value won\'t be saved as a setting, it\'s ephemeral and only relevant for the action\n    ask = "gimme a custom folder name"\n\n    [panel.my_action_section.my_action]\n    type = "button"\n    ask = "Clone the repo"\n    # the button is clickable only once the previous values are provided\n    enabled = "my_repo && my_repo_name"\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'run__my_action() {\n    ynh_print_info "Cloning \'$my_repo\'..."\n    cd /tmp\n    git clone "$my_repo" "$my_repo_name"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"overwrite-config-panel-mechanism",children:"Overwrite config panel mechanism"}),"\n",(0,t.jsx)(n.p,{children:"All main configuration helpers are overwritable, example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ynh_app_config_apply() {\n\n    # Stop vpn client\n    touch /tmp/.ynh-vpnclient-stopped\n    systemctl stop ynh-vpnclient\n\n    _ynh_app_config_apply\n\n    # Start vpn client\n    systemctl start ynh-vpnclient\n    rm -f /tmp/.ynh-vpnclient-stopped\n\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"List of main configuration helpers:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"ynh_app_config_get"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"ynh_app_config_show"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"ynh_app_config_validate"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"ynh_app_config_apply"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"ynh_app_config_run"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["More info on this can be found by reading ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost-Apps/vpnclient_ynh/blob/master/scripts/config",children:"vpnclient_ynh config script"})]}),"\n",(0,t.jsx)(n.h2,{id:"important-technical-notes",children:"Important technical notes"}),"\n",(0,t.jsx)(n.h3,{id:"options-short-keys-have-to-be-unique",children:"Options short keys have to be unique"}),"\n",(0,t.jsxs)(n.p,{children:["For performance reasons, questions short keys have to be unique in all the ",(0,t.jsx)(n.code,{children:"config_panel.toml"})," file, not just inside its panel or its section. Hence it's not possible to have:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:"[manual.vpn.server_ip]\n[advanced.dns.server_ip]\n"})}),"\n",(0,t.jsxs)(n.p,{children:['In which two questions have "real variable name" ',(0,t.jsx)(n.code,{children:"is server_ip"})," and therefore conflict with each other."]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Some short keys are forbidden cause it can interfer with config scripts (",(0,t.jsx)(n.code,{children:"old"}),", ",(0,t.jsx)(n.code,{children:"file_hash"}),", ",(0,t.jsx)(n.code,{children:"types"}),", ",(0,t.jsx)(n.code,{children:"binds"}),", ",(0,t.jsx)(n.code,{children:"formats"}),", ",(0,t.jsx)(n.code,{children:"changed"}),") and you probably should avoid to use common settings name to avoid to bind your question to this settings (e.g. ",(0,t.jsx)(n.code,{children:"id"}),", ",(0,t.jsx)(n.code,{children:"install_time"}),", ",(0,t.jsx)(n.code,{children:"mysql_pwd"}),", ",(0,t.jsx)(n.code,{children:"path"}),", ",(0,t.jsx)(n.code,{children:"domain"}),", ",(0,t.jsx)(n.code,{children:"port"}),", ",(0,t.jsx)(n.code,{children:"db_name"}),", ",(0,t.jsx)(n.code,{children:"current_revision"}),", ",(0,t.jsx)(n.code,{children:"admin"}),")"]})}),"\n",(0,t.jsxs)(n.h3,{id:"bind-versus-app-settings",children:[(0,t.jsx)(n.code,{children:"bind"})," versus app settings"]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["IMPORTANT: with the exception of ",(0,t.jsx)(n.code,{children:'bind = "null"'})," options, options ids should almost ",(0,t.jsx)(n.strong,{children:"always"})," correspond to an app setting initialized/reused during install/upgrade."]})}),"\n",(0,t.jsxs)(n.p,{children:["Not doing so may result in inconsistencies between the config panel mechanism and the use of ynh_add_config. See also ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/1973",children:"the relevant issue"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},4429:function(e,n,i){i.d(n,{R:()=>a,x:()=>l});var s=i(6540);let t={},o=s.createContext(t);function a(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);