"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["9564"],{2436:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>o,toc:()=>d,default:()=>c,metadata:()=>a,assets:()=>t,contentTitle:()=>l});var a=JSON.parse('{"id":"packaging/advanced/hooks","title":"Hooks","description":"YunoHost includes a hook mechanism triggered on a lot of operation changing the system. You can use this mechanism in order to extend the behaviour of a YunoHost command.","source":"@site/docs/packaging/60.advanced/50.hooks.mdx","sourceDirName":"packaging/60.advanced","slug":"/packaging/advanced/hooks","permalink":"/doc/pr-2672/de/packaging/advanced/hooks","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/packaging/60.advanced/50.hooks.mdx","tags":[],"version":"current","sidebarPosition":50,"frontMatter":{"title":"Hooks"},"sidebar":"devpackaging","previous":{"title":"SSO/LDAP integration","permalink":"/doc/pr-2672/de/packaging/advanced/sso_ldap_integration"},"next":{"title":"Advanced packagers","permalink":"/doc/pr-2672/de/packaging/advanced/advanced_packagers"}}'),s=i(4848),r=i(4429);let o={title:"Hooks"},l,t={},d=[{value:"How to add a custom hook on a specific instance",id:"how-to-add-a-custom-hook-on-a-specific-instance",level:2},{value:"How to add a hook in an app package",id:"how-to-add-a-hook-in-an-app-package",level:2},{value:"Hooks referencies",id:"hooks-referencies",level:2},{value:"User and permissions",id:"user-and-permissions",level:3},{value:"post_user_create",id:"post_user_create",level:4},{value:"Environment variables",id:"environment-variables",level:5},{value:"Positionnal arguments (deprecated)",id:"positionnal-arguments-deprecated",level:5},{value:"No waited return",id:"no-waited-return",level:5},{value:"Examples",id:"examples",level:5},{value:"Send automatically a mail to new user",id:"send-automatically-a-mail-to-new-user",level:6},{value:"post_user_delete",id:"post_user_delete",level:4},{value:"No environment variables",id:"no-environment-variables",level:5},{value:"Positionnal arguments",id:"positionnal-arguments",level:5},{value:"No waited return",id:"no-waited-return-1",level:5},{value:"Examples",id:"examples-1",level:5},{value:"post_user_update",id:"post_user_update",level:3},{value:"Environment variables",id:"environment-variables-1",level:4},{value:"No positionnal arguments",id:"no-positionnal-arguments",level:4},{value:"No waited return",id:"no-waited-return-2",level:4},{value:"Examples",id:"examples-2",level:4},{value:"Send a mail on password changing",id:"send-a-mail-on-password-changing",level:5},{value:"post_app_addaccess",id:"post_app_addaccess",level:3},{value:"No environment variables",id:"no-environment-variables-1",level:4},{value:"Positionnal arguments (deprecated)",id:"positionnal-arguments-deprecated-1",level:4},{value:"No waited return",id:"no-waited-return-3",level:4},{value:"Examples",id:"examples-3",level:4},{value:"post_app_removeaccess",id:"post_app_removeaccess",level:3},{value:"No environment variables",id:"no-environment-variables-2",level:4},{value:"Positionnal arguments (deprecated)",id:"positionnal-arguments-deprecated-2",level:4},{value:"No waited return",id:"no-waited-return-4",level:4},{value:"Examples",id:"examples-4",level:4},{value:"Domain, certificates and DNS",id:"domain-certificates-and-dns",level:2},{value:"post_domain_add",id:"post_domain_add",level:3},{value:"No environment variable",id:"no-environment-variable",level:4},{value:"Positionnal arguments (deprecated)",id:"positionnal-arguments-deprecated-3",level:4},{value:"No waited return",id:"no-waited-return-5",level:4},{value:"Examples",id:"examples-5",level:4},{value:"post_domain_remove",id:"post_domain_remove",level:3},{value:"No environment variable",id:"no-environment-variable-1",level:4},{value:"Positionnal arguments (deprecated)",id:"positionnal-arguments-deprecated-4",level:4},{value:"No waited return",id:"no-waited-return-6",level:4},{value:"Examples",id:"examples-6",level:4},{value:"post_cert_update",id:"post_cert_update",level:3},{value:"No environment variable",id:"no-environment-variable-2",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-1",level:4},{value:"No waited return",id:"no-waited-return-7",level:4},{value:"Examples",id:"examples-7",level:4},{value:"Restart a service after cert renewal",id:"restart-a-service-after-cert-renewal",level:5},{value:"custom_dns_rules",id:"custom_dns_rules",level:3},{value:"Environment variables",id:"environment-variables-2",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-2",level:4},{value:"Waited return",id:"waited-return",level:4},{value:"Examples",id:"examples-8",level:4},{value:"Validate Let&#39;s Encrypt DNS challenge with a YunoHost DynDNS domain",id:"validate-lets-encrypt-dns-challenge-with-a-yunohost-dyndns-domain",level:5},{value:"Apps",id:"apps",level:2},{value:"post_app_change_url",id:"post_app_change_url",level:3},{value:"Environment variables",id:"environment-variables-3",level:4},{value:"No positionnal arguments",id:"no-positionnal-arguments-1",level:4},{value:"No waited return",id:"no-waited-return-8",level:4},{value:"Examples",id:"examples-9",level:4},{value:"post_app_upgrade",id:"post_app_upgrade",level:3},{value:"Environment variables",id:"environment-variables-4",level:4},{value:"No positionnal arguments",id:"no-positionnal-arguments-2",level:4},{value:"No waited return",id:"no-waited-return-9",level:4},{value:"Examples",id:"examples-10",level:4},{value:"Change a settings in an app config file (unmanaged by config panel)",id:"change-a-settings-in-an-app-config-file-unmanaged-by-config-panel",level:5},{value:"post_app_install",id:"post_app_install",level:3},{value:"Environment variables",id:"environment-variables-5",level:4},{value:"No positionnal arguments",id:"no-positionnal-arguments-3",level:4},{value:"No waited return",id:"no-waited-return-10",level:4},{value:"Examples",id:"examples-11",level:4},{value:"post_app_remove",id:"post_app_remove",level:3},{value:"Environment variables",id:"environment-variables-6",level:4},{value:"No positionnal arguments",id:"no-positionnal-arguments-4",level:4},{value:"No waited return",id:"no-waited-return-11",level:4},{value:"Examples",id:"examples-12",level:4},{value:"Backup / Restore",id:"backup--restore",level:2},{value:"backup",id:"backup",level:3},{value:"Environment variables",id:"environment-variables-7",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-3",level:4},{value:"No waited return",id:"no-waited-return-12",level:4},{value:"Examples",id:"examples-13",level:4},{value:"Backup some files in more (for example your custom hooks)",id:"backup-some-files-in-more-for-example-your-custom-hooks",level:5},{value:"restore",id:"restore",level:3},{value:"Environment variables",id:"environment-variables-8",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-4",level:4},{value:"No waited return",id:"no-waited-return-13",level:4},{value:"Examples",id:"examples-14",level:4},{value:"restore custom files",id:"restore-custom-files",level:5},{value:"backup_method",id:"backup_method",level:3},{value:"No environment variables",id:"no-environment-variables-3",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-5",level:4},{value:"No waited return",id:"no-waited-return-14",level:4},{value:"Examples",id:"examples-15",level:4},{value:"A very simple backup on rotationnal disks",id:"a-very-simple-backup-on-rotationnal-disks",level:5},{value:"Configuration and firewall",id:"configuration-and-firewall",level:2},{value:"post_iptable_rules",id:"post_iptable_rules",level:3},{value:"No environment variables",id:"no-environment-variables-4",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-6",level:4},{value:"No waited return",id:"no-waited-return-15",level:4},{value:"Examples",id:"examples-16",level:4},{value:"Forbid completely the outgoing 25 port except for postfix user",id:"forbid-completely-the-outgoing-25-port-except-for-postfix-user",level:5},{value:"conf_regen",id:"conf_regen",level:3},{value:"Environment variables",id:"environment-variables-9",level:4},{value:"Positionnal arguments",id:"positionnal-arguments-7",level:4},{value:"No waited return",id:"no-waited-return-16",level:4},{value:"Examples",id:"examples-17",level:4},{value:"Fix the warning about postfix compatibility mode in postfix logs",id:"fix-the-warning-about-postfix-compatibility-mode-in-postfix-logs",level:5}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"YunoHost includes a hook mechanism triggered on a lot of operation changing the system. You can use this mechanism in order to extend the behaviour of a YunoHost command."}),"\n",(0,s.jsxs)(n.p,{children:["The most obvious case is adding a user. If you had a ",(0,s.jsx)(n.code,{children:"post_user_create"})," hook, this hook will be triggered as soon as a user is added."]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-add-a-custom-hook-on-a-specific-instance",children:"How to add a custom hook on a specific instance"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"Below we imagine we want to run a command after each user creation to add the user to samba user."})}),"\n",(0,s.jsxs)(n.p,{children:["You should create a directory with the name of the hooks into ",(0,s.jsx)(n.code,{children:"/etc/yunohost/hooks.d/"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p /etc/yunohost/hooks.d/post_user_create\n"})}),"\n",(0,s.jsx)(n.p,{children:"Next create a bash script inside this directory prefixed by 2 numbers and a dash:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano /etc/yunohost/hooks.d/post_user_create/05-add-user-to-samba\n"})}),"\n",(0,s.jsxs)(n.p,{children:["By default, the directory must be readable and traversable by root, but if you notice your hook is not run at all by YunoHost, you can check permissions with ",(0,s.jsx)(n.code,{children:"ls -l /etc/yunohost/hooks.d/"})," and apply these commands if needed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chown root:root /etc/yunohost/hooks.d/post_user_create\nchmod u+rx /etc/yunohost/hooks.d/post_user_create\n"})}),"\n",(0,s.jsx)(n.h2,{id:"how-to-add-a-hook-in-an-app-package",children:"How to add a hook in an app package"}),"\n",(0,s.jsxs)(n.p,{children:["If you are packaging an app, you should not set by yourself the hook into ",(0,s.jsx)(n.code,{children:"/etc/yunohost/hooks.d"})," instead you should create a hooks dir at the root of your package."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:".\n\u251C\u2500\u2500 conf\n\u251C\u2500\u2500 hooks\n\u251C\u2500\u2500 scripts\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In the hooks dir, create a bash script called with the type of hook you want to create for example ",(0,s.jsx)(n.code,{children:"post_create_user"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"hooks-referencies",children:"Hooks referencies"}),"\n",(0,s.jsx)(n.h3,{id:"user-and-permissions",children:"User and permissions"}),"\n",(0,s.jsx)(n.h4,{id:"post_user_create",children:"post_user_create"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after user creation"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost user create"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h5,{id:"environment-variables",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_USER_USERNAME: The username of the created user"}),"\n",(0,s.jsx)(n.li,{children:"YNH_USER_MAIL: The mail of the created user"}),"\n",(0,s.jsxs)(n.li,{children:["YNH_USER_PASSWORD: The ",(0,s.jsx)(n.strong,{children:"clear"})," password of the created user"]}),"\n",(0,s.jsxs)(n.li,{children:["YNH_USER_FIRSTNAME: The firstname of the created user (",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/296",children:"should be removed in future"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["YNH_USER_LASTNAME: The lastname of the created user (",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/296",children:"should be removed in future"}),")"]}),"\n"]}),(0,s.jsx)(n.h5,{id:"positionnal-arguments-deprecated",children:"Positionnal arguments (deprecated)"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The username of the created user"}),"\n",(0,s.jsx)(n.li,{children:"$2: The mail of the created user"}),"\n"]}),(0,s.jsx)(n.h5,{id:"no-waited-return",children:"No waited return"}),(0,s.jsx)(n.h5,{id:"examples",children:"Examples"}),(0,s.jsx)(n.h6,{id:"send-automatically-a-mail-to-new-user",children:"Send automatically a mail to new user"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\ndomain=$(cat /etc/hostname)\n\nmessage="Hello $YNH_USER_FIRSTNAME,\nWelcome on $domain ! \nFeel free to <a href=\'https://$domain/yunohost/sso/edit.html\'>change your password</a>.\nLet me know if you have a problem,\nThe admin of $domain\n"\n\necho $message | mail -s "Welcome on $domain !" $YNH_USER_MAIL\n'})})]}),"\n",(0,s.jsx)(n.h4,{id:"post_user_delete",children:"post_user_delete"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered at the end of user deletion"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost user delete"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h5,{id:"no-environment-variables",children:"No environment variables"}),(0,s.jsx)(n.h5,{id:"positionnal-arguments",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The username of the user deleted"}),"\n",(0,s.jsx)(n.li,{children:"$2: True if --purge option is used"}),"\n"]}),(0,s.jsx)(n.h5,{id:"no-waited-return-1",children:"No waited return"}),(0,s.jsx)(n.h5,{id:"examples-1",children:"Examples"}),(0,s.jsx)(n.h6,{id:""}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"post_user_update",children:"post_user_update"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered at the end of the user update"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost user update"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-1",children:"Environment variables"}),(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"Only arguments given to the cli/api are given as environment variable."})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_USER_USERNAME: The username of the updated user"}),"\n",(0,s.jsxs)(n.li,{children:["YNH_USER_FIRSTNAME: The firstname of the updated user (",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/296",children:"should be removed in future"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["YNH_USER_LASTNAME: The lastname of the updated user (",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/296",children:"should be removed in future"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"YNH_USER_PASSWORD: The new password of the updated user"}),"\n",(0,s.jsx)(n.li,{children:"YNH_USER_MAILS: The mail and mail aliases of the updated user seperated by comma"}),"\n",(0,s.jsx)(n.li,{children:"YNH_USER_MAILFORWARDS: The list of forward mails of the updated user separated by comma"}),"\n",(0,s.jsx)(n.li,{children:"YNH_USER_MAILQUOTA: The quota of the updated user (could be 0 or a number following by one of this unit: b, k, M, G or T)"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-positionnal-arguments",children:"No positionnal arguments"}),(0,s.jsx)(n.h4,{id:"no-waited-return-2",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-2",children:"Examples"}),(0,s.jsx)(n.h5,{id:"send-a-mail-on-password-changing",children:"Send a mail on password changing"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n"\ndomain=$(cat /etc/hostname)\n\nmessage="Hello,\nYour password has been successfully changed on $domain.\nIf you have not asked for changing your password, you probably should contact the admin of $domain.\n"\n\necho $message | mail -s "Your password has been changed on $domain !" $YNH_USER_USERNAME\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"post_app_addaccess",children:"post_app_addaccess"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after adding a permission to users or groups "})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost user permission add"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"no-environment-variables-1",children:"No environment variables"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-deprecated-1",children:"Positionnal arguments (deprecated)"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The app name"}),"\n",(0,s.jsx)(n.li,{children:"$2: The list of users added separated by comma"}),"\n",(0,s.jsxs)(n.li,{children:["$3: The name of the sub permission (",(0,s.jsx)(n.code,{children:"main"}),", ",(0,s.jsx)(n.code,{children:"admin"}),", etc.)"]}),"\n",(0,s.jsx)(n.li,{children:"$4: The list of groups added separated by comma"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-3",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-3",children:"Examples"})]}),"\n",(0,s.jsx)(n.h3,{id:"post_app_removeaccess",children:"post_app_removeaccess"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after removing a pemission to users or groups"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost user permission remove"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"no-environment-variables-2",children:"No environment variables"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-deprecated-2",children:"Positionnal arguments (deprecated)"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The app name"}),"\n",(0,s.jsx)(n.li,{children:"$2: The list of users removed from the permission separated by comma"}),"\n",(0,s.jsxs)(n.li,{children:["$3: The name of the sub permission (",(0,s.jsx)(n.code,{children:"main"}),", ",(0,s.jsx)(n.code,{children:"admin"}),", etc.)"]}),"\n",(0,s.jsx)(n.li,{children:"$4: The list of groups removed from the permission separated by comma"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-4",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-4",children:"Examples"})]}),"\n",(0,s.jsx)(n.h2,{id:"domain-certificates-and-dns",children:"Domain, certificates and DNS"}),"\n",(0,s.jsx)(n.h3,{id:"post_domain_add",children:"post_domain_add"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered at the end of the domain add operation"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost domain add"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"no-environment-variable",children:"No environment variable"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-deprecated-3",children:"Positionnal arguments (deprecated)"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The domain added"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-5",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-5",children:"Examples"}),(0,s.jsx)(n.h5,{id:"-1"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash"})})]}),"\n",(0,s.jsx)(n.h3,{id:"post_domain_remove",children:"post_domain_remove"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after removing the domain"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost domain remove"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"no-environment-variable-1",children:"No environment variable"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-deprecated-4",children:"Positionnal arguments (deprecated)"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The domain removed"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-6",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-6",children:"Examples"})]}),"\n",(0,s.jsx)(n.h3,{id:"post_cert_update",children:"post_cert_update"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after Let's encrypt certificate update"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost domain cert update"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"no-environment-variable-2",children:"No environment variable"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-1",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The domain for which we have updated the certificate"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-7",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-7",children:"Examples"}),(0,s.jsx)(n.h5,{id:"restart-a-service-after-cert-renewal",children:"Restart a service after cert renewal"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\nsystemctl restart gemserv\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"custom_dns_rules",children:"custom_dns_rules"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Customized your DNS rules for your domains"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost domain dns suggest"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.p,{children:"Thanks to This hook you can customize"}),(0,s.jsx)(n.h4,{id:"environment-variables-2",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"base_domain"}),": the top-level part of the domain"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"suffix"}),": the subdomain part of the domain"]}),"\n"]}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-2",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The base domain for which we want to build a DNS suggestion"}),"\n"]}),(0,s.jsx)(n.h4,{id:"waited-return",children:"Waited return"}),(0,s.jsx)(n.p,{children:"The script should return a JSON array with dictionnary in this format:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"[\n    {\n        'type': 'SRV',\n        'name': 'stuff.foo.bar',\n        'value': 'yoloswag',\n        'ttl': 3600\n    }\n]\n"})}),(0,s.jsx)(n.h4,{id:"examples-8",children:"Examples"}),(0,s.jsx)(n.h5,{id:"validate-lets-encrypt-dns-challenge-with-a-yunohost-dyndns-domain",children:"Validate Let's Encrypt DNS challenge with a YunoHost DynDNS domain"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\nif [[ \"$1\" == \"XXXX.nohost.me\" ]] ; then\n    echo \"[\n        {\n            'type': 'TXT',\n            'name': '_acme-challenge',\n            'value': 'LETSENCRYPT_VALUE',\n            'ttl': 3600\n        }\n    ]\"\nfi\n\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"apps",children:"Apps"}),"\n",(0,s.jsx)(n.h3,{id:"post_app_change_url",children:"post_app_change_url"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after an app has changed of URL"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost app change-url"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-3",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_APP_OLD_DOMAIN: The old domain of the app"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_OLD_PATH: The old path of the app"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_NEW_DOMAIN: The new domain of the app"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_NEW_PATH: The new path of the app"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-positionnal-arguments-1",children:"No positionnal arguments"}),(0,s.jsx)(n.h4,{id:"no-waited-return-8",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-9",children:"Examples"})]}),"\n",(0,s.jsx)(n.h3,{id:"post_app_upgrade",children:"post_app_upgrade"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered on app upgrade"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost app upgrade"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-4",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_APP_ID: The app id (for example nextcloud)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_INSTANCE_NAME: The app instance name (for example nextcloud__2)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_INSTANCE_NUMBER: The app instance number (for example 2)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_MANIFEST_VERSION: The app manifest version (for example 1 or ?)"}),"\n",(0,s.jsxs)(n.li,{children:["YNH_ARCH: The arch as returned by ",(0,s.jsx)(n.code,{children:"dpkg --print-architecture"})]}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_UPGRADE_TYPE: The type of upgrade (UPGRADE_PACKAGE, UPGRADE_APP, UPGRADE_FULL)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_MANIFEST_VERSION: The version number"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_CURRENT_VERSION: The version number of the app (in the YunoHost format)"}),"\n",(0,s.jsx)(n.li,{children:"NO_BACKUP_UPGRADE: 1 if we don't want to backup else 0"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-positionnal-arguments-2",children:"No positionnal arguments"}),(0,s.jsx)(n.h4,{id:"no-waited-return-9",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-10",children:"Examples"}),(0,s.jsx)(n.h5,{id:"change-a-settings-in-an-app-config-file-unmanaged-by-config-panel",children:"Change a settings in an app config file (unmanaged by config panel)"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nsource /usr/share/yunohost/helpers\napp=$YNH_APP_INSTANCE_NAME\n\nif [[ "$app" == "etherpad_mypads" ]]; then\n  ynh_write_var_in_file --file=/var/www/etherpad_mypads/settings.json --key=max --value=100 --after=importExportRateLimiting\n  systemctl restart etherpad_mypads\nfi\n\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"post_app_install",children:"post_app_install"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered at the end of an app installation"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost app install"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-5",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_APP_ID: The app id (for example nextcloud)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_INSTANCE_NAME: The app instance name (for example nextcloud__2)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_INSTANCE_NUMBER: The app instance number (for example 2)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_MANIFEST_VERSION: The app manifest version (for example 1 or ?)"}),"\n",(0,s.jsxs)(n.li,{children:["YNH_ARCH: The arch as returned by ",(0,s.jsx)(n.code,{children:"dpkg --print-architecture"})]}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_ARG_XXXXXXX: The argument of the manifest"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-positionnal-arguments-3",children:"No positionnal arguments"}),(0,s.jsx)(n.h4,{id:"no-waited-return-10",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-11",children:"Examples"})]}),"\n",(0,s.jsx)(n.h3,{id:"post_app_remove",children:"post_app_remove"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after removing an app"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost app remove"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-6",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_APP_ID: The app id (for example nextcloud)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_INSTANCE_NAME: The app instance name (for example nextcloud__2)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_INSTANCE_NUMBER: The app instance number (for example 2)"}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_MANIFEST_VERSION: The app manifest version (for example 1 or ?)"}),"\n",(0,s.jsxs)(n.li,{children:["YNH_ARCH: The arch as returned by ",(0,s.jsx)(n.code,{children:"dpkg --print-architecture"})]}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_PURGE: 1 if the --purge option has been activated"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-positionnal-arguments-4",children:"No positionnal arguments"}),(0,s.jsx)(n.h4,{id:"no-waited-return-11",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-12",children:"Examples"})]}),"\n",(0,s.jsx)(n.h2,{id:"backup--restore",children:"Backup / Restore"}),"\n",(0,s.jsx)(n.h3,{id:"backup",children:"backup"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Add some files to backup"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost backup create"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-7",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_BACKUP_DIR: The work dir in which we can store temporary data to backup like database dump"}),"\n",(0,s.jsx)(n.li,{children:"YNH_BACKUP_CSV: The CSV in which we add the things to backup. Don't use this directly and use ynh_backup helper instead."}),"\n",(0,s.jsx)(n.li,{children:"YNH_APP_BACKUP_DIR: To document"}),"\n"]}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-3",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The work dir in which we can store temporary data to backup like database dump"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-12",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-13",children:"Examples"}),(0,s.jsx)(n.h5,{id:"backup-some-files-in-more-for-example-your-custom-hooks",children:"Backup some files in more (for example your custom hooks)"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Source YNH helpers\nsource /usr/share/yunohost/helpers\n\nynh_backup_dest (){\n    YNH_CWD="${YNH_BACKUP_DIR%/}/$1"\n    mkdir -p $YNH_CWD\n    cd "$YNH_CWD"\n}\n\n# Exit hook on subcommand error or unset variable\nynh_abort_if_errors\n\n# MISC\nynh_backup_dest "conf/custom/misc"\nynh_backup "/etc/sysctl.d/noipv6.conf"\nynh_backup "/usr/local/bin/"\n\nynh_backup "/etc/yunohost/hooks.d/backup/99-conf_custom"\nynh_backup "/etc/yunohost/hooks.d/restore/99-conf_custom"\n\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"restore",children:"restore"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Restore some files"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost backup restore"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"environment-variables-8",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_BACKUP_DIR: The work dir in which we can store temporary data to backup like database dump"}),"\n",(0,s.jsx)(n.li,{children:"YNH_BACKUP_CSV: The CSV in which we add the things to backup. Don't use this directly and use ynh_backup helper instead."}),"\n"]}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-4",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The work dir in which we can store temporary data to backup like database dump"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-13",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-14",children:"Examples"}),(0,s.jsx)(n.h5,{id:"restore-custom-files",children:"restore custom files"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Source YNH helpers\nsource /usr/share/yunohost/helpers\n\nynh_restore_dest (){\n    YNH_CWD="${YNH_BACKUP_DIR%/}/$1"\n    cd "$YNH_CWD"\n}\n\n# Exit hook on subcommand error or unset variable\nynh_abort_if_errors\n\n# MISC\nynh_restore_dest "conf/custom/misc"\nynh_restore_file "/etc/sysctl.d/noipv6.conf"\nynh_restore_file "/usr/local/bin/"\n\nynh_restore_file "/etc/yunohost/hooks.d/backup/99-conf_custom"\nynh_restore_file "/etc/yunohost/hooks.d/restore/99-conf_custom"\n\n\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"backup_method",children:"backup_method"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Define a new way to backup and restore files"})}),(0,s.jsxs)(n.p,{children:["This hook is run during the command ",(0,s.jsx)(n.code,{children:"yunohost backup create"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.p,{children:"This hook is called several times with different action keywords."}),(0,s.jsx)(n.h4,{id:"no-environment-variables-3",children:"No environment variables"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-5",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'$1: The action ("need_mount", "backup", "mount")'}),"\n",(0,s.jsx)(n.li,{children:"$2: The work dir"}),"\n",(0,s.jsx)(n.li,{children:"$3: The name of the backup"}),"\n",(0,s.jsx)(n.li,{children:"$4: The repository in which the backup should be done"}),"\n",(0,s.jsx)(n.li,{children:"$5: An estimation size of the files to backup"}),"\n",(0,s.jsx)(n.li,{children:"$6: A description of the archive"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-14",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-15",children:"Examples"}),(0,s.jsx)(n.h5,{id:"a-very-simple-backup-on-rotationnal-disks",children:"A very simple backup on rotationnal disks"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nset -euo pipefail\n\nwork_dir="$2"\nname="$3"\nrepo="$4"\nsize="$5"\ndescription="$6"\n\ncase "$1" in\n  need_mount)\n    # Set false if your method can itself put files in good place in your archive\n    true\n    ;;\n  backup)\n    mount /dev/sda1 /mnt/hdd\n    if [[ "$(df /mnt/hdd | tail -n1 | cut -d" " -f1)" != "/dev/sda1" ]]\n    then\n        exit 1\n    fi\n    pushd "$work_dir"\n    current_date=$(date +"%Y-%m-%d_%H:%M")\n    cp -a "${work_dir}" "/mnt/hdd/${current_date}_$name"\n    popd\n    umount /mnt/hdd\n    ;;\n  *)\n    echo "hook called with unknown argument \\`$1\'" >&2\n    exit 1\n    ;;\nesac\n\nexit 0\n\n'})})]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-and-firewall",children:"Configuration and firewall"}),"\n",(0,s.jsx)(n.h3,{id:"post_iptable_rules",children:"post_iptable_rules"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Triggered after reloaded the firewall rules"})}),(0,s.jsxs)(n.p,{children:["This hook is run at the end of the command ",(0,s.jsx)(n.code,{children:"yunohost firewall reload"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.h4,{id:"no-environment-variables-4",children:"No environment variables"}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-6",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: True if upnp has succeeded"}),"\n",(0,s.jsx)(n.li,{children:"$2: True if ipv6 is available"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-15",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-16",children:"Examples"}),(0,s.jsx)(n.h5,{id:"forbid-completely-the-outgoing-25-port-except-for-postfix-user",children:"Forbid completely the outgoing 25 port except for postfix user"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\niptables -A OUTPUT -p tcp --dport 25 -m owner --uid-owner postfix -j ACCEPT\niptables -A OUTPUT -p tcp --dport 25 -m tcp -j REJECT --reject-with icmp-port-unreachable\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"conf_regen",children:"conf_regen"}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("i",{children:"Change configuration suggested as default config in regen-conf mechanism"})}),(0,s.jsxs)(n.p,{children:["This hook is run during the command ",(0,s.jsx)(n.code,{children:"yunohost tools regen-conf"})," or equivalent action in webadmin."]}),(0,s.jsx)(n.p,{children:"This hook is called several times with different actions keywords (pre and post operations)."}),(0,s.jsx)(n.p,{children:"In order to be taken into account, the conf_regen hooks must:"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["be present in the folder ",(0,s.jsx)(n.code,{children:"/etc/yunohost/hooks.d/conf_regen"})]}),"\n",(0,s.jsxs)(n.li,{children:["follow the naming convention ",(0,s.jsx)(n.code,{children:"dd-sss_xxx"}),".\n",(0,s.jsx)(n.code,{children:"dd"})," are 2 digits and should be higher than the ones from the default hook (present in ",(0,s.jsx)(n.code,{children:"/usr/share/yunohost/hooks/conf_regen"}),").\n",(0,s.jsx)(n.code,{children:"sss"})," is a string that defines the kind of hook (eg. ",(0,s.jsx)(n.code,{children:"ssh"})," or ",(0,s.jsx)(n.code,{children:"postfix"}),").\n",(0,s.jsx)(n.code,{children:"xxx"})," is a free field to help remind what is inside that hook."]}),"\n"]}),(0,s.jsx)(n.h4,{id:"environment-variables-9",children:"Environment variables"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"YNH_DOMAINS: The list of domains managed by YunoHost separated by comma"}),"\n",(0,s.jsx)(n.li,{children:"YNH_MAIN_DOMAINS: The list of main domains separated by comma"}),"\n"]}),(0,s.jsx)(n.h4,{id:"positionnal-arguments-7",children:"Positionnal arguments"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"$1: The pre or post action"}),"\n",(0,s.jsx)(n.li,{children:"$2: Empty string due to legacy"}),"\n",(0,s.jsx)(n.li,{children:"$3: Empty string due to legacy"}),"\n",(0,s.jsx)(n.li,{children:"$4: In post mode the list of file which should be modified. In pre mode the dir in which we store pending configuration"}),"\n"]}),(0,s.jsx)(n.h4,{id:"no-waited-return-16",children:"No waited return"}),(0,s.jsx)(n.h4,{id:"examples-17",children:"Examples"}),(0,s.jsx)(n.h5,{id:"fix-the-warning-about-postfix-compatibility-mode-in-postfix-logs",children:"Fix the warning about postfix compatibility mode in postfix logs"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\naction=$1\npending_dir=$4\npostfix_conf=$pending_dir/../postfix/etc/postfix/main.cf\n\n[[ "$action" == "pre" ]] || exit 0\n[[ -e $postfix_conf ]] || exit 0\necho \'\ncompatibility_level = 2\' >> $postfix_conf\n'})})]})]})}function c(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},4429:function(e,n,i){i.d(n,{R:()=>o,x:()=>l});var a=i(6540);let s={},r=a.createContext(s);function o(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);