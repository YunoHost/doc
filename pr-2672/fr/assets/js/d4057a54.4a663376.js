"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["3310"],{9681:function(e,s,r){r.r(s),r.d(s,{frontMatter:()=>o,toc:()=>d,default:()=>h,metadata:()=>n,assets:()=>u,contentTitle:()=>c});var n=JSON.parse('{"id":"admin/backups/clone_filesystem","title":"Cr\xe9er une image compl\xe8te du syst\xe8me de fichier","description":"L\'outil de sauvegarde de YunoHost ne sauvegarde que les fichiers utiles et se base sur des scripts de restauration pour r\xe9installer les d\xe9pendances de vos applications. Autrement dit, le m\xe9canisme de YunoHost revient \xe0 r\xe9installer, puis r\xe9incorporer les donn\xe9es.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/15.clone_filesystem.mdx","sourceDirName":"admin/40.backups","slug":"/admin/backups/clone_filesystem","permalink":"/doc/pr-2672/fr/admin/backups/clone_filesystem","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/15.clone_filesystem.mdx","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"title":"Cr\xe9er une image compl\xe8te du syst\xe8me de fichier"},"sidebar":"admin","previous":{"title":"Backup methods","permalink":"/doc/pr-2672/fr/admin/backups/backup_methods"},"next":{"title":"\xc9viter les pannes mat\xe9rielles","permalink":"/doc/pr-2672/fr/admin/backups/avoid_hardware_failure"}}'),t=r(4848),a=r(4429),l=r(4109),i=r(3703);let o={title:"Cr\xe9er une image compl\xe8te du syst\xe8me de fichier"},c,u={},d=[{value:"D\xe9clencher un snapshot",id:"d\xe9clencher-un-snapshot",level:2},{value:"Cr\xe9er une image du syst\xe8me de fichier \xe0 froid",id:"cr\xe9er-une-image-du-syst\xe8me-de-fichier-\xe0-froid",level:2}];function p(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"L'outil de sauvegarde de YunoHost ne sauvegarde que les fichiers utiles et se base sur des scripts de restauration pour r\xe9installer les d\xe9pendances de vos applications. Autrement dit, le m\xe9canisme de YunoHost revient \xe0 r\xe9installer, puis r\xe9incorporer les donn\xe9es."}),"\n",(0,t.jsx)(s.p,{children:"R\xe9aliser des images compl\xe8tes du syst\xe8me peut \xeatre un moyen compl\xe9mentaire ou alternatif de sauvegarder votre machine. L'int\xe9r\xeat est que votre syst\xe8me pourra \xeatre restaur\xe9 dans l'\xe9tat exact du moment de la sauvegarde."}),"\n",(0,t.jsx)(s.p,{children:"Selon votre type d'installation, vous pouvez soit cr\xe9er un snapshot, soit cloner le support de stockage en le retirant de votre serveur (\xe9teint)."}),"\n",(0,t.jsx)(s.h2,{id:"d\xe9clencher-un-snapshot",children:"D\xe9clencher un snapshot"}),"\n",(0,t.jsx)(s.p,{children:"Un snapshot permet de figer une image du syst\xe8me de fichiers. Les snapshots sont tr\xe8s pratiques lorsque l'on fait une mise \xe0 jour ou des essais, car ils vous permettent de revenir facilement en arri\xe8re en cas de p\xe9pin. En revanche, en dehors de quelques clusters de tr\xe8s haute disponibilit\xe9, les snapshots ne vous prot\xe8gent pas vraiment face \xe0 des pannes mat\xe9rielles ou des catastrophes (cf. incendie d'OVH \xe0 Strasbourg en 2021)."}),"\n",(0,t.jsx)(s.p,{children:"En g\xe9n\xe9ral, les snapshots sont assez \xe9conomes en espace disque, le principe est que votre syst\xe8me de fichier va stocker les diff\xe9rences survenues depuis votre snapshot. Ainsi, seules les modifications consomment de l'espace."}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Pensez \xe0 supprimer les anciens snapshots pour \xe9viter de g\xe2cher votre espace de stockage en stockant toutes les diff\xe9rences depuis cette date !"})}),"\n",(0,t.jsx)(s.p,{children:"Vous pouvez utiliser cette m\xe9thode avec la plupart des VPS (souvent payant), des gestionnaires de machines virtuelles ou si vous avez install\xe9 YunoHost avec un filesystem avanc\xe9 comme btrfs, ceph ou ZFS, vous pouvez aussi cr\xe9er des snapshots via la ligne de commande"}),"\n",(0,t.jsxs)(l.A,{children:[(0,t.jsxs)(i.A,{value:"vps",label:"VPS",children:[(0,t.jsx)(s.p,{children:"Ci-dessous, quelques documentations pour les fournisseurs les plus connus:"}),(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.digitalocean.com/products/images/snapshots/",children:"DigitalOcean (EN)"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.gandi.net/fr/simple_hosting/operations_courantes/snapshots.html",children:"Gandi"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.ovh.com/fr/vps/snapshot-vps/",children:"OVH"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://www.scaleway.com/en/docs/backup-your-data-with-snapshots/",children:"Scaleway (EN)"})}),"\n"]})]}),(0,t.jsxs)(i.A,{value:"virtualbox",label:"VirtualBox",children:[(0,t.jsxs)(s.p,{children:["S\xe9lectionner la machine virtuelle et cliquer sur ",(0,t.jsx)(s.code,{children:"Snapshots"}),", puis sp\xe9cifier le nom du snapshot et cliquer sur ",(0,t.jsx)(s.code,{children:"OK"}),".\n",(0,t.jsx)(s.img,{alt:"Le bouton snapshot se trouve en haut \xe0 droite",src:r(9361).A+"",width:"720",height:"381"})]}),(0,t.jsxs)(s.p,{children:["Pour restaurer, s\xe9lectionner la machine virtuelle, cliquer sur ",(0,t.jsx)(s.code,{children:"Snapshots"})," puis ",(0,t.jsx)(s.code,{children:"Restore Snapshot option"}),".\n",(0,t.jsx)(s.img,{src:r(486).A+"",width:"719",height:"366"})]}),(0,t.jsxs)(s.p,{children:["Ensuite cliquer sur ",(0,t.jsx)(s.code,{children:"Restore Snapshot"}),".\n",(0,t.jsx)(s.img,{src:r(7883).A+"",width:"720",height:"381"})]})]}),(0,t.jsx)(i.A,{value:"proxmox",label:"Proxmox",children:(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"S\xe9lectionner la machine virtuelle"}),"\n",(0,t.jsxs)(s.li,{children:["Aller dans l'onglet ",(0,t.jsx)(s.code,{children:"Backup"})]}),"\n",(0,t.jsxs)(s.li,{children:["Cliquer sur ",(0,t.jsx)(s.code,{children:"Backup now"})]}),"\n",(0,t.jsxs)(s.li,{children:["Choisir le mode ",(0,t.jsx)(s.code,{children:"Snapshot"})]}),"\n",(0,t.jsx)(s.li,{children:"Valider"}),"\n"]})}),(0,t.jsxs)(i.A,{value:"btrfs",label:"BTRFS",children:[(0,t.jsxs)(s.p,{children:["Ci-dessous on consid\xe8re que ",(0,t.jsx)(s.code,{children:"/pool/volume"})," est le volume \xe0 snapshoter."]}),(0,t.jsx)(s.p,{children:"Cr\xe9er un snapshot en lecture seule"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'btrfs subvolume snapshot /pool/volume /pool/volume/$(date +"%Y-%m-%d_%H:%M")\n'})}),(0,t.jsx)(s.p,{children:"Lister les snapshots"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"btrfs subvolume show /pool/volume\n"})}),(0,t.jsx)(s.p,{children:"Restaurer un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"btrfs sub del /pool/volume\nbtrfs sub snap /pool/volume/2021-07-22_16:12 /pool/volume\nbtrfs sub del /pool/volume/2021-07-22_16:12\n"})}),(0,t.jsx)(s.p,{children:"Supprimer un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"btrfs subvolume delete /pool/volume/2021-07-22_16:12\n"})}),(0,t.jsx)(s.admonition,{type:"caution",children:(0,t.jsx)(s.p,{children:"Attention de ne pas supprimer le volume original"})}),(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Voir ",(0,t.jsx)(s.a,{href:"https://www.linux.com/training-tutorials/how-create-and-manage-btrfs-snapshots-and-rollbacks-linux-part-2/",children:"ce tutoriel"})," pour plus d'info"]})})]}),(0,t.jsxs)(i.A,{value:"ceph",label:"CEPH",children:[(0,t.jsxs)(s.p,{children:["Ci-dessous on consid\xe8re que ",(0,t.jsx)(s.code,{children:"pool/volume"})," est le volume \xe0 snapshoter."]}),(0,t.jsx)(s.p,{children:"Cr\xe9er un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'rbd snap create pool/volume@$(date +"%Y-%m-%d_%H:%M")\n'})}),(0,t.jsx)(s.p,{children:"Lister les snapshots"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"rbd snap ls pool/volume\n"})}),(0,t.jsx)(s.p,{children:"Restaurer un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"rbd snap rollback pool/volume@2021-07-22_16:22\n"})}),(0,t.jsx)(s.p,{children:"Supprimer un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"rbd snap rm pool/volume@2021-07-22_16:12\n"})})]}),(0,t.jsxs)(i.A,{value:"zfs",label:"ZFS",children:[(0,t.jsxs)(s.p,{children:["Ci-dessous on consid\xe8re que ",(0,t.jsx)(s.code,{children:"pool/volume"})," est le volume \xe0 snapshoter."]}),(0,t.jsx)(s.p,{children:"Cr\xe9er un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'zfs snapshot pool/volume@$(date +"%Y-%m-%d_%H:%M")\n'})}),(0,t.jsx)(s.p,{children:"Lister les snapshots"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"zfs list -t snapshot -o name,creation\n"})}),(0,t.jsx)(s.p,{children:"Restaurer un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"zfs rollback pool/volume@2021-07-22_16:22\n"})}),(0,t.jsx)(s.p,{children:"Supprimer un snapshot"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"zfs destroy pool/volume@2021-07-22_16:12\n"})})]})]}),"\n",(0,t.jsx)(s.h2,{id:"cr\xe9er-une-image-du-syst\xe8me-de-fichier-\xe0-froid",children:"Cr\xe9er une image du syst\xe8me de fichier \xe0 froid"}),"\n",(0,t.jsx)(s.p,{children:"Vous pouvez cloner votre support (carte SD, disque ssd, volume de VPS...) pour cr\xe9er une image disque. Cette image avant compression sera de la taille exacte de votre support, c'est pourquoi cette m\xe9thode s'applique plut\xf4t aux machines de moins de 64Go."}),"\n",(0,t.jsx)(s.p,{children:"\xc0 moins de pouvoir lire un snapshot, cette m\xe9thode n\xe9cessite d'arr\xeater le serveur le temps de cr\xe9er l'image. Avec un VPS, il faut red\xe9marrer en mode rescue depuis l'interface de votre fournisseur."}),"\n",(0,t.jsxs)(l.A,{children:[(0,t.jsxs)(i.A,{value:"usbimage",label:"With USBimager",children:[(0,t.jsxs)(s.p,{children:["Ceci peut \xeatre effectu\xe9 avec ",(0,t.jsx)(s.a,{href:"https://bztsrc.gitlab.io/usbimager/",children:"USBimager"})," (N.B. : assurez-vous de t\xe9l\xe9charger la version 'Read-write' ! Pas la version 'Write-only' !). Le processus consiste ensuite \xe0 \"l'inverse\" du processus de flashage de la carte SD:"]}),(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"\xc9teignez votre serveur"}),"\n",(0,t.jsx)(s.li,{children:"R\xe9cup\xe9rez la carte SD et branchez-la dans votre ordinateur"}),"\n",(0,t.jsx)(s.li,{children:'Dans USBimager, cliquez sur "Read" pour cr\xe9er une image ("photographie") de la carte SD. Vous pouvez utiliser le fichier obtenu pour plus tard restaurer le syst\xe8me en entier.'}),"\n"]}),(0,t.jsxs)(s.p,{children:["Plus de d\xe9tails dans ",(0,t.jsx)(s.a,{href:"https://gitlab.com/bztsrc/usbimager/#creating-backup-image-file-from-device",children:"la doc d'USBimager"})]})]}),(0,t.jsxs)(i.A,{value:"dd",label:"In command line with dd",children:[(0,t.jsxs)(s.p,{children:["Il est possible d'obtenir la m\xeame chose avec ",(0,t.jsx)(s.code,{children:"dd"})," si vous \xeates \xe0 l'aise avec la ligne de commande:"]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"dd if=/dev/mmcblk0 | gzip > ./my_snapshot.gz\n"})}),(0,t.jsxs)(s.p,{children:["(remplacez ",(0,t.jsx)(s.code,{children:"/dev/mmcblk0"})," par le vrai nom de votre carte SD ou disque dur)"]})]})]})]})}function h(e={}){let{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},9361:function(e,s,r){r.d(s,{A:()=>n});let n=r.p+"assets/images/virtualbox-snapshot2-8b23f84615e0a99e43d2636c70d33a5d.webp"},486:function(e,s,r){r.d(s,{A:()=>n});let n=r.p+"assets/images/virtualbox-snapshot3-08a179ce073e3326be3cbd1880a89b44.webp"},7883:function(e,s,r){r.d(s,{A:()=>n});let n=r.p+"assets/images/virtualbox-snapshot4-5153c257e34ee578c19f1e044bd0ab85.webp"},3703:function(e,s,r){r.d(s,{A:()=>a});var n=r(4848);r(6540);var t=r(9836);function a({children:e,hidden:s,className:r}){return(0,n.jsx)("div",{role:"tabpanel",className:(0,t.A)("tabItem_Ymn6",r),hidden:s,children:e})}},4109:function(e,s,r){r.d(s,{A:()=>j});var n=r(4848),t=r(6540),a=r(9836),l=r(6364),i=r(8251),o=r(6347),c=r(8004),u=r(5580),d=r(2213),p=r(5734);function h(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){let{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:s}){return s.some(s=>s.value===e)}var v=r(8864);function f({className:e,block:s,selectedValue:r,selectValue:t,tabValues:l}){let o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),u=e=>{let s=e.currentTarget,n=l[o.indexOf(s)].value;n!==r&&(c(s),t(n))},d=e=>{let s=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{let r=o.indexOf(e.currentTarget)+1;s=o[r]??o[0];break}case"ArrowLeft":{let r=o.indexOf(e.currentTarget)-1;s=o[r]??o[o.length-1]}}s?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":s},e),children:l.map(({value:e,label:s,attributes:t})=>(0,n.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:u,...t,className:(0,a.A)("tabs__item","tabItem_LNqP",t?.className,{"tabs__item--active":r===e}),children:s??e},e))})}function x({lazy:e,children:s,selectedValue:r}){let l=(Array.isArray(s)?s:[s]).filter(Boolean);if(e){let e=l.find(e=>e.props.value===r);return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:l.map((e,s)=>(0,t.cloneElement)(e,{key:s,hidden:e.props.value!==r}))})}function b(e){let s=function(e){let s,{defaultValue:r,queryString:n=!1,groupId:a}=e,l=function(e){let{values:s,children:r}=e;return(0,t.useMemo)(()=>{let e=s??h(r).map(({props:{value:e,label:s,attributes:r,default:n}})=>({value:e,label:s,attributes:r,default:n})),n=(0,d.XI)(e,(e,s)=>e.value===s.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[s,r])}(e),[i,v]=(0,t.useState)(()=>(function({defaultValue:e,tabValues:s}){if(0===s.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:s}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${s.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let r=s.find(e=>e.default)??s[0];if(!r)throw Error("Unexpected error: 0 tabValues");return r.value})({defaultValue:r,tabValues:l})),[f,x]=function({queryString:e=!1,groupId:s}){let r=(0,o.W6)(),n=function({queryString:e=!1,groupId:s}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!s)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:e,groupId:s});return[(0,u.aZ)(n),(0,t.useCallback)(e=>{if(!n)return;let s=new URLSearchParams(r.location.search);s.set(n,e),r.replace({...r.location,search:s.toString()})},[n,r])]}({queryString:n,groupId:a}),[b,j]=function({groupId:e}){let s=e?`docusaurus.tab.${e}`:null,[r,n]=(0,p.Dv)(s);return[r,(0,t.useCallback)(e=>{s&&n.set(e)},[s,n])]}({groupId:a}),g=m({value:s=f??b,tabValues:l})?s:null;return(0,c.A)(()=>{g&&v(g)},[g]),{selectedValue:i,selectValue:(0,t.useCallback)(e=>{if(!m({value:e,tabValues:l}))throw Error(`Can't select invalid tab value=${e}`);v(e),x(e),j(e)},[x,j,l]),tabValues:l}}(e);return(0,n.jsxs)("div",{className:(0,a.A)(l.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,n.jsx)(f,{...s,...e}),(0,n.jsx)(x,{...s,...e})]})}function j(e){let s=(0,v.A)();return(0,n.jsx)(b,{...e,children:h(e.children)},String(s))}},4429:function(e,s,r){r.d(s,{R:()=>l,x:()=>i});var n=r(6540);let t={},a=n.createContext(t);function l(e){let s=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);