"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["6805"],{3478:function(e,n,i){i.r(n),i.d(n,{frontMatter:()=>t,toc:()=>u,default:()=>c,metadata:()=>s,assets:()=>l,contentTitle:()=>o});var s=JSON.parse('{"id":"admin/upgrade/11.0-bullseye","title":"Migrer de 4.x vers 11.x","description":"L\'objectif cette page est de d\xe9crire le processus de migration d\'une instance en YunoHost 4.4.x (tournant sous Debian Buster/10.x) vers YunoHost 11.x (tournant sous Debian Bullseye/11.x). Notez que nous avons d\xe9cid\xe9 de sauter les num\xe9ros de versions de 5 \xe0 10 pour suivre les num\xe9ros de versions de Debian.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/55.upgrade/11.0-bullseye.mdx","sourceDirName":"admin/55.upgrade","slug":"/admin/upgrade/11.0-bullseye","permalink":"/doc/pr-2672/fr/admin/upgrade/11.0-bullseye","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/55.upgrade/11.0-bullseye.mdx","tags":[],"version":"current","frontMatter":{"title":"Migrer de 4.x vers 11.x"},"sidebar":"admin","previous":{"title":"\u2728 Mises \xe0 jour","permalink":"/doc/pr-2672/fr/admin/upgrade/"},"next":{"title":"Migrer de 11.x vers 12.x","permalink":"/doc/pr-2672/fr/admin/upgrade/12.0-bookworm/"}}'),r=i(4848),a=i(4429);let t={title:"Migrer de 4.x vers 11.x"},o,l={},u=[{value:"Notes importantes",id:"notes-importantes",level:2},{value:"Proc\xe9dure de migration",id:"proc\xe9dure-de-migration",level:2},{value:"Depuis la webadmin",id:"depuis-la-webadmin",level:3},{value:"Depuis la ligne de commande",id:"depuis-la-ligne-de-commande",level:3},{value:"Pendant la migration",id:"pendant-la-migration",level:2},{value:"Si la migration a crash\xe9 / \xe9chou\xe9 \xe0 un moment",id:"si-la-migration-a-crash\xe9--\xe9chou\xe9-\xe0-un-moment",level:3},{value:"Choses \xe0 v\xe9rifier apr\xe8s la migration",id:"choses-\xe0-v\xe9rifier-apr\xe8s-la-migration",level:2},{value:"Ex\xe9cuter la migration pour r\xe9parer votre application python",id:"ex\xe9cuter-la-migration-pour-r\xe9parer-votre-application-python",level:3},{value:"V\xe9rifiez que vous \xeates v\xe9ritablement sous Debian Bullseye et YunoHost 11.x",id:"v\xe9rifiez-que-vous-\xeates-v\xe9ritablement-sous-debian-bullseye-et-yunohost-11x",level:3},{value:"V\xe9rifiez que le diagnostic ne rapporte pas de probl\xe8me particulier",id:"v\xe9rifiez-que-le-diagnostic-ne-rapporte-pas-de-probl\xe8me-particulier",level:3},{value:"V\xe9rifiez que les applications fonctionnent",id:"v\xe9rifiez-que-les-applications-fonctionnent",level:3},{value:"Soucis (mineurs) connus apr\xe8s la migration",id:"soucis-mineurs-connus-apr\xe8s-la-migration",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"L'objectif cette page est de d\xe9crire le processus de migration d'une instance en YunoHost 4.4.x (tournant sous Debian Buster/10.x) vers YunoHost 11.x (tournant sous Debian Bullseye/11.x). Notez que nous avons d\xe9cid\xe9 de sauter les num\xe9ros de versions de 5 \xe0 10 pour suivre les num\xe9ros de versions de Debian."}),"\n",(0,r.jsx)(n.h2,{id:"notes-importantes",children:"Notes importantes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"L'\xe9quipe de YunoHost a fait de son mieux pour que cette migration se passe autant en douceur que possible. Elle a \xe9t\xe9 test\xe9e durant plusieurs mois et sur plusieurs types d'installations."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["N\xe9anmoins, vous devez \xeatre conscient qu'il s'agit d'une op\xe9ration d\xe9licate. L'administration syst\xe8me est un sujet compliqu\xe9 et couvrir tous les cas particuliers n'est pas chose ais\xe9e. En cons\xe9quence, si vous h\xe9bergez des donn\xe9es et des syst\xe8mes critiques, ",(0,r.jsx)(n.a,{href:"/admin/backups",children:"faites des sauvegardes"}),". Et dans tous les cas, soyez patients et attentifs durant la migration."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:['Ne vous pr\xe9cipitez pas \xe0 vouloir faire une r\xe9installation de votre syst\xe8me en pensant que cela serait "plus simple" (sigh). (Une attitude qui revient r\xe9guli\xe8rement est de vouloir r\xe9installer son syst\xe8me \xe0 la moindre complication...). \xc0 la place, si vous rencontrez des probl\xe8mes, nous vous encourageons \xe0 investiguer, chercher \xe0 comprendre et ',(0,r.jsx)(n.a,{href:"/community/help",children:"trouver de l'aide sur le chat ou le forum"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"proc\xe9dure-de-migration",children:"Proc\xe9dure de migration"}),"\n",(0,r.jsx)(n.h3,{id:"depuis-la-webadmin",children:"Depuis la webadmin"}),"\n",(0,r.jsx)(n.p,{children:"Apr\xe8s avoir mis \xe0 jour vers la version en 4.4.x, allez dans Outils > Migrations pour acc\xe9der \xe0 l'interface de migration. Il vous faudra ensuite lire l'avertissement attentivement et l'accepter pour lancer la migration."}),"\n",(0,r.jsx)(n.h3,{id:"depuis-la-ligne-de-commande",children:"Depuis la ligne de commande"}),"\n",(0,r.jsx)(n.p,{children:"Apr\xe8s avoir mis \xe0 jour vers la version 4.4.x, lancez :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo yunohost tools migrations migrate\n"})}),"\n",(0,r.jsx)(n.p,{children:"puis lisez attentivement l'avertissement et les instructions."}),"\n",(0,r.jsx)(n.h2,{id:"pendant-la-migration",children:"Pendant la migration"}),"\n",(0,r.jsx)(n.p,{children:"En fonction de votre mat\xe9riel et des paquets install\xe9s, la migration peut prendre jusqu'\xe0 une ou deux heures."}),"\n",(0,r.jsx)(n.p,{children:"Les logs seront affich\xe9s dans la barre de message au centre de la page (vous pouvez approcher la souris dessus pour voir l'historique en entier). Ils seront \xe9galement consultable apr\xe8s coup (comme les autres op\xe9rations) dans Outils > Journaux."}),"\n",(0,r.jsx)(n.p,{children:"Notez que m\xeame si vous fermez la page d'admin, la migration continuera (par contre l'interface d'admin sera partiellement indisponible)."}),"\n",(0,r.jsx)(n.h3,{id:"si-la-migration-a-crash\xe9--\xe9chou\xe9-\xe0-un-moment",children:"Si la migration a crash\xe9 / \xe9chou\xe9 \xe0 un moment"}),"\n",(0,r.jsxs)(n.p,{children:["Si la migration a \xe9chou\xe9 a un moment donn\xe9, la premi\xe8re chose \xe0 faire est de tenter de la relancer. Si cela ne fonctionne toujours pas, il vous faut ",(0,r.jsx)(n.a,{href:"/community/help",children:"trouver de l'aide"})," (pri\xe8re de fournir le/les messages correspondants ou tout \xe9l\xe9ment qui vous fait penser que \xe7a n'a pas march\xe9)."]}),"\n",(0,r.jsx)(n.h2,{id:"choses-\xe0-v\xe9rifier-apr\xe8s-la-migration",children:"Choses \xe0 v\xe9rifier apr\xe8s la migration"}),"\n",(0,r.jsx)(n.h3,{id:"ex\xe9cuter-la-migration-pour-r\xe9parer-votre-application-python",children:"Ex\xe9cuter la migration pour r\xe9parer votre application python"}),"\n",(0,r.jsx)(n.p,{children:"Apr\xe8s la mise \xe0 jour, vos applications python devraient \xeatre indisponibles car leur environnement virtuel doit \xeatre reconstruit."}),"\n",(0,r.jsxs)(n.p,{children:["Pour ce faire, vous pouvez ex\xe9cuter les migrations en cours dans ",(0,r.jsx)(n.code,{children:"Webadmin > Mises \xe0 jour"}),". Les applications ci-dessous ne seront pas r\xe9par\xe9es automatiquement, vous devez les mettre \xe0 jour manuellement avec ",(0,r.jsx)(n.code,{children:"yunohost app upgrade -F APP"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Les applications qui ne seront pas r\xe9par\xe9es automatiquement et n\xe9cessitent une mise \xe0 jour forc\xe9e :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"calibreweb"}),"\n",(0,r.jsx)(n.li,{children:"django-for-runners"}),"\n",(0,r.jsx)(n.li,{children:"ffsync (cette application est en python2 et n'est plus maintenue, aucune garantie)"}),"\n",(0,r.jsx)(n.li,{children:"jupiterlab"}),"\n",(0,r.jsx)(n.li,{children:"librephotos"}),"\n",(0,r.jsx)(n.li,{children:"mautrix"}),"\n",(0,r.jsx)(n.li,{children:"mediadrop"}),"\n",(0,r.jsx)(n.li,{children:"mopidy"}),"\n",(0,r.jsx)(n.li,{children:"pgadmin"}),"\n",(0,r.jsx)(n.li,{children:"tracim"}),"\n",(0,r.jsx)(n.li,{children:"synapse"}),"\n",(0,r.jsx)(n.li,{children:"weblate"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["! !! Si n\xe9cessaire, vous pouvez d\xe9sactiver la reconstruction automatique pour une application python sp\xe9cifique, en supprimant le fichier d\xe9di\xe9 termin\xe9 par ",(0,r.jsx)(n.code,{children:".requirements_backup_for_bullseye_upgrade.txt"})," avant d'appliquer la migration. Vous pouvez trouver ce fichier pr\xe8s du venv de votre application dans ",(0,r.jsx)(n.code,{children:"/opt"})," ou ",(0,r.jsx)(n.code,{children:"/var/www"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"v\xe9rifiez-que-vous-\xeates-v\xe9ritablement-sous-debian-bullseye-et-yunohost-11x",children:"V\xe9rifiez que vous \xeates v\xe9ritablement sous Debian Bullseye et YunoHost 11.x"}),"\n",(0,r.jsxs)(n.p,{children:["Pour cela, vous pouvez aller dans la partie Diagnostic (section Syst\xe8me de base). (Vous pouvez aussi regarder ce qui est affich\xe9 \xe0 droite dans le pied de page de la webadmin). En ligne de commande, vous pouvez aussi utiliser ",(0,r.jsx)(n.code,{children:"lsb_release -a"})," et ",(0,r.jsx)(n.code,{children:"yunohost --version"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"v\xe9rifiez-que-le-diagnostic-ne-rapporte-pas-de-probl\xe8me-particulier",children:"V\xe9rifiez que le diagnostic ne rapporte pas de probl\xe8me particulier"}),"\n",(0,r.jsx)(n.p,{children:"\xc9galement dans la section Diagnostic de la webadmin, v\xe9rifiez qu'il n'y a pas de probl\xe8me apparu suite \xe0 la migration (par exemple un service qui ne tournerais plus...)"}),"\n",(0,r.jsx)(n.h3,{id:"v\xe9rifiez-que-les-applications-fonctionnent",children:"V\xe9rifiez que les applications fonctionnent"}),"\n",(0,r.jsx)(n.p,{children:"V\xe9rifiez que vos applications install\xe9es fonctionnent... Si elles ne fonctionnent pas, il est recommand\xe9 de tenter de les mettre \xe0 jour. (ou bien de mani\xe8re g\xe9n\xe9rale, il est recommand\xe9 de les mettre \xe0 jour m\xeame si elles fonctionnent !)."}),"\n",(0,r.jsxs)(n.p,{children:["Si votre app est cass\xe9e et que vous \xe9tiez d\xe9j\xe0 sur la derni\xe8re version d'une application, vous pouvez relancer la mise \xe0 jour gr\xe2ce \xe0 l'option ",(0,r.jsx)(n.code,{children:"--force"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yunohost app upgrade --force NOM_APP\n"})}),"\n",(0,r.jsx)(n.h2,{id:"soucis-mineurs-connus-apr\xe8s-la-migration",children:"Soucis (mineurs) connus apr\xe8s la migration"}),"\n",(0,r.jsxs)(n.p,{children:["Voir la ",(0,r.jsx)(n.a,{href:"https://yunohost.org/en/buster_bullseye_migration#current-known-minor-issues-after-the-migration",children:"page anglaise"})]})]})}function c(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},4429:function(e,n,i){i.d(n,{R:()=>t,x:()=>o});var s=i(6540);let r={},a=s.createContext(r);function t(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);