"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["3207"],{2318:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>d,toc:()=>u,default:()=>l,metadata:()=>s,assets:()=>i,contentTitle:()=>a});var s=JSON.parse('{"id":"admin/backups/custom_backup_methods","title":"M\xe9thodes personnalis\xe9es de sauvegardes","description":"Il est possible de cr\xe9er votre propre m\xe9thode de sauvegarde et de la lier au syst\xe8me de collecte de fichiers \xe0 sauvegarder de YunoHost. Ceci peut \xeatre utile si vous souhaitez utiliser votre propre logiciel de sauvegarde ou mener des op\xe9rations de montages d\xe9montages de disques par exemple.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/30.custom_backup_methods.mdx","sourceDirName":"admin/40.backups","slug":"/admin/backups/custom_backup_methods","permalink":"/doc/pr-2672/fr/admin/backups/custom_backup_methods","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/40.backups/30.custom_backup_methods.mdx","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"title":"M\xe9thodes personnalis\xe9es de sauvegardes"},"sidebar":"admin","previous":{"title":"Inclure/exclure des fichiers","permalink":"/doc/pr-2672/fr/admin/backups/include_exclude_files"},"next":{"title":"Migrer ou fusionner des serveurs","permalink":"/doc/pr-2672/fr/admin/backups/migrate_or_merge_servers"}}'),r=t(4848),o=t(4429);let d={title:"M\xe9thodes personnalis\xe9es de sauvegardes"},a,i={},u=[];function c(e){let n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Il est possible de cr\xe9er votre propre m\xe9thode de sauvegarde et de la lier au syst\xe8me de collecte de fichiers \xe0 sauvegarder de YunoHost. Ceci peut \xeatre utile si vous souhaitez utiliser votre propre logiciel de sauvegarde ou mener des op\xe9rations de montages d\xe9montages de disques par exemple."}),"\n",(0,r.jsx)(n.p,{children:"Cette op\xe9ration se fait \xe0 l'aide d'un hook et vous permettra de lancer une sauvegarde de cette fa\xe7on:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yunohost backup create --method custom\n"})}),"\n",(0,r.jsx)(n.p,{children:"Ci-dessous, un exemple simpliste qui peut permettre de mettre en place un backup rotationnel avec diff\xe9rents disques que l'on change toutes les semaines:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"/etc/yunohost/hooks.d/backup_method/05-custom"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nset -euo pipefail\n\nwork_dir="$2"\nname="$3"\nrepo="$4"\nsize="$5"\ndescription="$6"\n\ncase "$1" in\n  need_mount)\n    # Set false if your method can itself put files in good place in your archive\n    true\n    ;;\n  backup)\n    mount /dev/sda1 /mnt/hdd\n    if [[ "$(df /mnt/hdd | tail -n1 | cut -d" " -f1)" != "/dev/sda1" ]]\n    then\n        exit 1\n    fi\n    pushd "$work_dir"\n    current_date=$(date +"%Y-%m-%d_%H:%M")\n    cp -a "${work_dir}" "/mnt/hdd/${current_date}_$name"\n    popd\n    umount /mnt/hdd\n    ;;\n  *)\n    echo "hook called with unknown argument \\`$1\'" >&2\n    exit 1\n    ;;\nesac\n\nexit 0\n'})})]})}function l(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},4429:function(e,n,t){t.d(n,{R:()=>d,x:()=>a});var s=t(6540);let r={},o=s.createContext(r);function d(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);