"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["8540"],{9162:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>o,toc:()=>l,default:()=>h,metadata:()=>i,assets:()=>c,contentTitle:()=>r});var i=JSON.parse('{"id":"packaging/advanced/sso_ldap_integration","title":"Int\xe9gration SSO/LDAP","description":"Un aspect puissant de YunoHost est que les applications sont destin\xe9es \xe0 \xeatre int\xe9gr\xe9es \xe0 la pile SSO/LDAP, de sorte que les utilisateurs connect\xe9s sur le portail utilisateur de YunoHost puissent \xeatre directement connect\xe9s \xe0 chaque application sans avoir \xe0 cr\xe9er un compte dans chacune d\'elles ni \xe0 avoir \xe0 recr\xe9er un compte. -connectez-vous \xe0 chaque application \xe0 chaque fois.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/packaging/60.advanced/30.sso_ldap_integration.mdx","sourceDirName":"packaging/60.advanced","slug":"/packaging/advanced/sso_ldap_integration","permalink":"/pr-2672/fr/packaging/advanced/sso_ldap_integration","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/packaging/60.advanced/30.sso_ldap_integration.mdx","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"title":"Int\xe9gration SSO/LDAP"},"sidebar":"devpackaging","previous":{"title":"Config Panels","permalink":"/pr-2672/fr/packaging/advanced/config_panels"},"next":{"title":"Hooks","permalink":"/pr-2672/fr/packaging/advanced/hooks"}}'),s=t(4848),a=t(4429);let o={title:"Int\xe9gration SSO/LDAP"},r,c={},l=[{value:"LDAP integration",id:"ldap-integration",level:2},{value:"SSO integration",id:"sso-integration",level:2},{value:"Usage",id:"usage",level:3},{value:"Specific case",id:"specific-case",level:3},{value:"App wich reuse the auth basic header to authenticate to an internal service",id:"app-wich-reuse-the-auth-basic-header-to-authenticate-to-an-internal-service",level:4},{value:"Application wich provide an API",id:"application-wich-provide-an-api",level:4},{value:"Configuring SSOwat permissions for the app",id:"configuring-ssowat-permissions-for-the-app",level:2},{value:"D\xe9connexion de l&#39;application ou d\xe9connexion de YunoHost",id:"d\xe9connexion-de-lapplication-ou-d\xe9connexion-de-yunohost",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Un aspect puissant de YunoHost est que les applications sont destin\xe9es \xe0 \xeatre int\xe9gr\xe9es \xe0 la pile SSO/LDAP, de sorte que les utilisateurs connect\xe9s sur le portail utilisateur de YunoHost puissent \xeatre directement connect\xe9s \xe0 chaque application sans avoir \xe0 cr\xe9er un compte dans chacune d'elles ni \xe0 avoir \xe0 recr\xe9er un compte. -connectez-vous \xe0 chaque application \xe0 chaque fois."}),"\n",(0,s.jsx)(n.p,{children:"Il convient de souligner qu\u2019il y a ici deux aspects diff\xe9rents :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"l'int\xe9gration LDAP, ce qui signifie que les comptes d'utilisateurs de l'application sont directement mapp\xe9s aux comptes d'utilisateurs YunoHost"}),"\n",(0,s.jsx)(n.li,{children:"l'int\xe9gration SSO, ce qui signifie qu'un utilisateur connect\xe9 sur le portail utilisateur YunoHost est \xe9galement automatiquement connect\xe9 sur l'application."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Parfois, l'int\xe9gration LDAP est possible, mais pas l'int\xe9gration SSO (m\xeame si l'inverse serait vraiment \xe9trange car l'int\xe9gration LDAP est quelque peu requise pour que le SSO fonctionne)"}),"\n",(0,s.jsxs)(n.p,{children:["Le syst\xe8me SSO est g\xe9r\xe9 par ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/ssowat",children:"SSOwat"})," et g\xe8re \xe9galement le syst\xe8me de \xab permissions \xbb qui d\xe9finit si un utilisateur (ou un visiteur anonyme) peut ou non acc\xe9der \xe0 l'application."]}),"\n",(0,s.jsx)(n.h2,{id:"ldap-integration",children:"LDAP integration"}),"\n",(0,s.jsx)(n.p,{children:"LDAP est un standard de facto lorsqu'il s'agit de partager une base de donn\xe9es de comptes d'utilisateurs commune entre plusieurs applications, d'o\xf9 son utilisation dans le contexte de YunoHost."}),"\n",(0,s.jsx)(n.p,{children:"Cependant, chaque application impl\xe9mente la prise en charge LDAP \xe0 sa mani\xe8re (ou non) et doit \xeatre dot\xe9e de param\xe8tres pour communiquer r\xe9ellement avec la base de donn\xe9es LDAP de YunoHost, g\xe9n\xe9ralement via son fichier de configuration. Il est conseill\xe9 de rechercher des exemples concrets d'applications les mettant en \u0153uvre (telles que Nextcloud, Wekan...), mais vous devrez g\xe9n\xe9ralement fournir :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["LDAP host: ",(0,s.jsx)(n.code,{children:"localhost"})," / ",(0,s.jsx)(n.code,{children:"127.0.0.1"})]}),"\n",(0,s.jsxs)(n.li,{children:["LDAP port: ",(0,s.jsx)(n.code,{children:"389"})]}),"\n",(0,s.jsxs)(n.li,{children:["Base DN : ",(0,s.jsx)(n.code,{children:"dc=yunohost,dc=org"})]}),"\n",(0,s.jsxs)(n.li,{children:["User DN : ",(0,s.jsx)(n.code,{children:"ou=users,dc=yunohost,dc=org"})]}),"\n",(0,s.jsxs)(n.li,{children:["Search filter: ",(0,s.jsx)(n.code,{children:"(&(|(objectclass=posixAccount))(uid=%uid)(permission=cn=__APP__.main,ou=permission,dc=yunohost,dc=org))"})," (this makes sure that only people with the appropriate YunoHost/SSowat permission can access the app)"]}),"\n",(0,s.jsxs)(n.li,{children:["Username attribute: ",(0,s.jsx)(n.code,{children:"uid"})]}),"\n",(0,s.jsxs)(n.li,{children:["Display name attribute: ",(0,s.jsx)(n.code,{children:"displayname"})]}),"\n",(0,s.jsxs)(n.li,{children:["Email attribute: ",(0,s.jsx)(n.code,{children:"mail"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"TO-DO/FIX-ME: plus d'explications ? Que manque-t-il?"}),"\n",(0,s.jsx)(n.h2,{id:"sso-integration",children:"SSO integration"}),"\n",(0,s.jsx)(n.p,{children:"This documentation apply to YunoHost>=12. On YunoHost <12 the header was a bit different but the idea was the same."}),"\n",(0,s.jsx)(n.p,{children:"Internally, SSOwat will on-the-fly inject theses different headers:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Protected over header injection from clients (a client try with a request to override the header and be logged in with a different user)"}),(0,s.jsx)(n.th,{children:"Header name for app which provide HTTP server and nginx transfert the request"}),(0,s.jsx)(n.th,{children:"How to get with php App"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The username"}),(0,s.jsx)(n.td,{children:"the username of the authenticated user"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"YNH_USER"})}),(0,s.jsxs)(n.td,{children:["with ",(0,s.jsx)(n.code,{children:'getallheaders()["Ynh-User"]'})," or ",(0,s.jsx)(n.code,{children:'$_SERVER["HTTP_YNH_USER"]'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User email"}),(0,s.jsx)(n.td,{children:"the email of the authenticated user. Could be usefull for some app wich require an email for the username. Can be also used by some apps which populate all user infomration from the HTTP header instead of LDAP."}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"YNH_USER_EMAIL"})}),(0,s.jsxs)(n.td,{children:["with ",(0,s.jsx)(n.code,{children:'getallheaders()["Ynh-User-Email"]'})," or ",(0,s.jsx)(n.code,{children:'$_SERVER["HTTP_YNH_USER_EMAIL"]'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User full name"}),(0,s.jsx)(n.td,{children:"The full name of the user. The full name of the user. Which is mostly used by some apps which populate all user infomration from the HTTP header instead of LDAP."}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"YNH_USER_FULLNAME"})}),(0,s.jsxs)(n.td,{children:["with ",(0,s.jsx)(n.code,{children:'getallheaders()["Ynh-User-Fullname"]'})," or ",(0,s.jsx)(n.code,{children:'$_SERVER["HTTP_YNH_USER_FULLNAME"]'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["The ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Basic_access_authentication",children:"HTTP Basic Auth Headers"})]}),(0,s.jsxs)(n.td,{children:["Like ",(0,s.jsx)(n.code,{children:"Authorization: Basic <base64credentials>"}),". If used we should be sure that the app check the credential (user and password) before to validate the authentication. It's mainly used by apps which need the credential to authenticate to a internal service. By example most of webmail need the credential to pass the correct credential to the mail server."]}),(0,s.jsx)(n.td,{children:"No. A client can send a header and will be passed to the application. It's why the application must check the credential to be sure that the passed passord are correct."}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Authorization"})}),(0,s.jsxs)(n.td,{children:["with ",(0,s.jsx)(n.code,{children:'getallheaders()["Authorization"]'})," or ",(0,s.jsx)(n.code,{children:'$_SERVER["HTTP_AUTHORIZATION"]'})]})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsxs)(n.p,{children:["For many application, like django, you will need configure the ",(0,s.jsx)(n.code,{children:"YNH_USER"})," header, as the header to trust, to authenticate the user. For php apps it will be most of case the header ",(0,s.jsx)(n.code,{children:"Ynh-User"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["And for some app which need the auth basic header, you generally don't need to set the header name as the ",(0,s.jsx)(n.code,{children:"Authorization"})," header name is normalized."]}),"\n",(0,s.jsx)(n.h3,{id:"specific-case",children:"Specific case"}),"\n",(0,s.jsx)(n.h4,{id:"app-wich-reuse-the-auth-basic-header-to-authenticate-to-an-internal-service",children:"App wich reuse the auth basic header to authenticate to an internal service"}),"\n",(0,s.jsx)(n.p,{children:"Currently you don't need any specific setup on YunoHost side. Since YunoHost provide the header needed, the application should be able to use it correclty. Depending of the application, some configuration could be needed."}),"\n",(0,s.jsx)(n.h4,{id:"application-wich-provide-an-api",children:"Application wich provide an API"}),"\n",(0,s.jsx)(n.p,{children:"Some app, like Nextcloud or SOGo provide an service like Caldav, Cardav or Webdav, the client will need to send the basic authentication and the nginx must transmit this authentication header to the serivice which will validate the authentication. Currently to make it working correctly you need to set a following app settings this way:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ynh_app_setting_set --key=protect_against_basic_auth_spoofing --value=false\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will say to YunoHost that for this app we can safely transmit auth basic header from the client to the application."}),"\n",(0,s.jsx)(n.p,{children:"If you need to change this behavior after the application installation, you can set the option with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo yunohost app setting <my_app> protect_against_basic_auth_spoofing -v false\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then you must regenerate the SSOwat configuration with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo yunohost app ssowatconf\n"})}),"\n",(0,s.jsx)(n.p,{children:"And, finally, you need to reload NGINX configuration with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl reload nginx.service\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuring-ssowat-permissions-for-the-app",children:"Configuring SSOwat permissions for the app"}),"\n",(0,s.jsx)(n.p,{children:"Les autorisations SSOwat sont configur\xe9es \xe0 l'aide de la ressource \xab autorisation \xbb dans le fichier manifest.toml de votre application."}),"\n",(0,s.jsx)(n.p,{children:"Le cas \xe9ch\xe9ant, vous pouvez cr\xe9er des autorisations \xab secondaires \xbb pour votre application, par exemple pour autoriser uniquement un groupe sp\xe9cifique de personnes \xe0 acc\xe9der \xe0 l'interface utilisateur d'administration de l'application. Par exemple :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[resources.permissions]\n\n# This configures the main permission, i.e. general access to `https://domain.tld/$app/`\n# Initial access is defined using the `init_main_permission` install question.\nmain.url = "/"\n\n# This configures an additional "admin" permission regarding access to `https://domain.tld/$app/admin`\nadmin.url = "/admin"\nadmin.show_tile = false    # This means that this permission won\'t correspond to a tile in YunoHost\'s user portal\nadmin.allowed = "admins"   # Initialize the access for the "admins" group ... You can also use an install question called `init_admin_permission` to let the server admin choose this.\n'})}),"\n",(0,s.jsx)(n.p,{children:"Consultez la page sur les ressources de l'application pour la description compl\xe8te du comportement et des propri\xe9t\xe9s."}),"\n",(0,s.jsx)(n.h2,{id:"d\xe9connexion-de-lapplication-ou-d\xe9connexion-de-yunohost",children:"D\xe9connexion de l'application ou d\xe9connexion de YunoHost"}),"\n",(0,s.jsxs)(n.p,{children:["Un ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues/501",children:"probl\xe8me connu"})," est que parfois, la d\xe9connexion des applications YunoHost ne d\xe9connectera pas les utilisateurs de chaque application. C'est par exemple le cas de ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost-Apps/nextcloud_ynh/issues/19",children:"Nextcloud"}),", car il utilise ses propres cookies d'authentification qui ne sont pas effac\xe9s lorsque les gens se d\xe9connectent de YunoHost. Ce n\u2019est pas anodin \xe0 corriger."]}),"\n",(0,s.jsxs)(n.p,{children:["De m\xeame, la d\xe9connexion de l'application ne d\xe9connecte pas n\xe9cessairement enti\xe8rement les personnes de YunoHost (ce qui est plus acceptable que de cliquer sur Se d\xe9connecter et... de ne pas \xeatre d\xe9connect\xe9 du tout car vous \xeates toujours connect\xe9 sur le SSO, donc connect\xe9 sur l'application). Certaines applications YunoHost int\xe8grent des correctifs personnalis\xe9s de sorte que le processus de d\xe9connexion de l'application redirige automatiquement vers ",(0,s.jsx)(n.code,{children:"https://domain.tld/yunohost/sso/?action=logout"})," qui les d\xe9connecte."]})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},4429:function(e,n,t){t.d(n,{R:()=>o,x:()=>r});var i=t(6540);let s={},a=i.createContext(s);function o(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);