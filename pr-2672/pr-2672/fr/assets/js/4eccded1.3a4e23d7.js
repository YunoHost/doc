"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["493"],{8479:function(e,t,s){s.r(t),s.d(t,{frontMatter:()=>c,toc:()=>d,default:()=>u,metadata:()=>n,assets:()=>o,contentTitle:()=>a});var n=JSON.parse('{"id":"admin/tutorials/certificate_custom","title":"Certificats personnalis\xe9s","description":"Depuis la version 2.5, YunoHost int\xe8gre la gestion automatis\xe9e de certificats Let\'s Encrypt. Vous pouvez donc facilement et gratuitement installer un certificat Let\'s Encrypt. Le document suivant d\xe9crit la m\xe9thodologie pour installer un certificat, payant, d\'une autre autorit\xe9 de certification (Gandi, RapidSSL, StartSSL, Cacert).","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/45.tutorials/45.certificate_custom.mdx","sourceDirName":"admin/45.tutorials","slug":"/admin/tutorials/certificate_custom","permalink":"/pr-2672/fr/admin/tutorials/certificate_custom","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/45.tutorials/45.certificate_custom.mdx","tags":[],"version":"current","sidebarPosition":45,"frontMatter":{"title":"Certificats personnalis\xe9s"},"sidebar":"admin","previous":{"title":"Configure Tor Hidden Service","permalink":"/pr-2672/fr/admin/tutorials/torhiddenservice"},"next":{"title":"Move apps storage","permalink":"/pr-2672/fr/admin/tutorials/moving_app_folder"}}'),r=s(4848),i=s(4429);let c={title:"Certificats personnalis\xe9s"},a,o={},d=[{value:"Ajout d\u2019un certificat sign\xe9 par une autorit\xe9 (autre que Let&#39;s Encrypt)",id:"ajout-dun-certificat-sign\xe9-par-une-autorit\xe9-autre-que-lets-encrypt",level:3},{value:"StartSSL",id:"startssl",level:4},{value:"Gandi",id:"gandi",level:4},{value:"RapidSSL",id:"rapidssl",level:4},{value:"Cacert",id:"cacert",level:4}];function l(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["Depuis la version 2.5, YunoHost int\xe8gre la gestion automatis\xe9e de certificats Let's Encrypt. Vous pouvez donc facilement et gratuitement ",(0,r.jsx)(t.a,{href:"/admin/domains/certificate",children:"installer un certificat Let's Encrypt"}),". Le document suivant d\xe9crit la m\xe9thodologie pour installer un certificat, payant, d'une autre autorit\xe9 de certification (",(0,r.jsx)(t.strong,{children:"Gandi"}),", ",(0,r.jsx)(t.strong,{children:"RapidSSL"}),", ",(0,r.jsx)(t.strong,{children:"StartSSL"}),", ",(0,r.jsx)(t.strong,{children:"Cacert"}),")."]})}),"\n",(0,r.jsx)(t.p,{children:"Quelques changements ont eu lieu qui impactent les proc\xe9dures indiqu\xe9es ci-dessous :"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Le groupe metronome n'est plus utilis\xe9 directement mais ssl-cert."}),"\n",(0,r.jsxs)(t.li,{children:["Un repertoire ",(0,r.jsx)(t.code,{children:"/etc/yunohost/certs/DOMAIN.LTD-history/stamp"})," est utilis\xe9 pour conserver chaque configuration cr\xe9\xe9e et un lien symbolique est cr\xe9\xe9 dessus."]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"ajout-dun-certificat-sign\xe9-par-une-autorit\xe9-autre-que-lets-encrypt",children:"Ajout d\u2019un certificat sign\xe9 par une autorit\xe9 (autre que Let's Encrypt)"}),"\n",(0,r.jsxs)(t.p,{children:["Apr\xe8s cr\xe9ation du certificat aupr\xe8s de votre autorit\xe9 d\u2019enregistrement, vous devez \xeatre en possession d\u2019une cl\xe9 priv\xe9e, le fichier ",(0,r.jsx)(t.em,{children:"key"})," et d\u2019un certificat public, le fichier ",(0,r.jsx)(t.em,{children:"crt"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["Attention, le fichier ",(0,r.jsx)(t.em,{children:"key"})," est tr\xe8s sensible, il est strictement personnel et doit \xeatre tr\xe8s bien s\xe9curis\xe9."]})}),"\n",(0,r.jsx)(t.p,{children:"Ces deux fichiers doivent \xeatre copi\xe9s sur le serveur, s\u2019ils ne s\u2019y trouvent pas d\xe9j\xe0."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"scp CERTIFICAT.crt admin@DOMAIN.TLD:ssl.crt\nscp CLE.key admin@DOMAIN.TLD:ssl.key\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Depuis Windows, scp est exploitable avec Putty, en t\xe9l\xe9chargeant l\u2019outil ",(0,r.jsx)(t.a,{href:"http://the.earth.li/~sgtatham/putty/latest/x86/pscp.exe",children:"pscp"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"pscp -P 22 CERTIFICAT.crt admin@DOMAIN.TLD:ssl.crt\npscp -P 22 CLE.key admin@DOMAIN.TLD:ssl.key\n"})}),"\n",(0,r.jsxs)(t.p,{children:["D\xe8s lors que les fichiers sont sur le serveur, le reste du travail se fera sur celui-ci. En ",(0,r.jsx)(t.a,{href:"/admin/command_line",children:"ssh"})," ou en local."]}),"\n",(0,r.jsx)(t.p,{children:"Tout d\u2019abord, cr\xe9ez un dossier pour stocker les certificats obtenus."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo mkdir /etc/yunohost/certs/DOMAIN.TLD/ae_certs\nsudo mv ssl.key ssl.crt /etc/yunohost/certs/DOMAIN.TLD/ae_certs/\n"})}),"\n",(0,r.jsx)(t.p,{children:"Puis allez dans le dossier parent pour poursuivre."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cd /etc/yunohost/certs/DOMAIN.TLD/\n"})}),"\n",(0,r.jsx)(t.p,{children:"Faites une sauvegarde des certificats d\u2019origine de YunoHost, par pr\xe9caution."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo mkdir yunohost_self_signed\nsudo mv *.pem *.cnf yunohost_self_signed/\n"})}),"\n",(0,r.jsx)(t.p,{children:"En fonction de l\u2019autorit\xe9 d\u2019enregistrement, des certificats interm\xe9diaires et racines doivent \xeatre obtenus."}),"\n",(0,r.jsx)(t.h4,{id:"startssl",children:"StartSSL"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo wget http://www.startssl.com/certs/ca.pem -O ae_certs/ca.pem\nsudo wget http://www.startssl.com/certs/sub.class1.server.ca.pem -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,r.jsx)(t.h4,{id:"gandi",children:"Gandi"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo wget https://www.gandi.net/static/CAs/GandiStandardSSLCA2.pem -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,r.jsx)(t.h4,{id:"rapidssl",children:"RapidSSL"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo wget https://knowledge.rapidssl.com/library/VERISIGN/INTERNATIONAL_AFFILIATES/RapidSSL/AR1548/RapidSSLCABundle.txt -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,r.jsx)(t.h4,{id:"cacert",children:"Cacert"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo wget http://www.cacert.org/certs/root.crt -O ae_certs/ca.pem\nsudo wget http://www.cacert.org/certs/class3.crt -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,r.jsx)(t.p,{children:"Les certificats interm\xe9diaires et root doivent \xeatre r\xe9unis avec le certificat obtenu pour cr\xe9er une cha\xeene de certificats unifi\xe9s."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cat ae_certs/ssl.crt ae_certs/intermediate_ca.pem ae_certs/ca.pem | sudo tee crt.pem\n"})}),"\n",(0,r.jsxs)(t.p,{children:["La cl\xe9 priv\xe9e doit \xeatre, elle, convertie au format ",(0,r.jsx)(t.code,{children:".pem"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo openssl rsa -in ae_certs/ssl.key -out key.pem -outform PEM\n"})}),"\n",(0,r.jsx)(t.p,{children:"Afin de s\u2019assurer de la syntaxe des certificats, v\xe9rifiez le contenu des fichiers."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cat crt.pem key.pem\n"})}),"\n",(0,r.jsx)(t.p,{children:"Les certificats et la cl\xe9 priv\xe9e doivent ressembler \xe0 cela :"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"-----BEGIN CERTIFICATE-----\nMIICVDCCAb0CAQEwDQYJKoZIhvcNAQEEBQAwdDELMAkGA1UEBhMCRlIxFTATBgNV\nBAgTDENvcnNlIGR1IFN1ZDEQMA4GA1UEBxMHQWphY2NpbzEMMAoGA1UEChMDTExC\nMREwDwYDVQQLEwhCVFMgSU5GTzEbMBkGA1UEAxMSc2VydmV1ci5idHNpbmZvLmZy\nMB4XDTA0MDIwODE2MjQyNloXDTA0MDMwOTE2MjQyNlowcTELMAkGA1UEBhMCRlIx\nFTATBgNVBAgTDENvcnNlIGR1IFN1ZDEQMA4GA1UEBxMHQWphY2NpbzEMMAoGA1UE\nChMDTExCMREwDwYDVQQLEwhCVFMgSU5GTzEYMBYGA1UEAxMPcHJvZi5idHNpbmZv\nLmZyMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSUagxPSv3LtgDV5sygt12\nkSbN/NWP0QUiPlksOkF2NkPfwW/mf55dD1hSndlOM/5kLbSBo5ieE3TgikF0Iktj\nBWm5xSqewM5QDYzXFt031DrPX63Fvo+tCKTQoVItdEuJPMahVsXnDyYHeUURRWLW\nwc0BzEgFZGGw7wiMF6wt5QIDAQABMA0GCSqGSIb3DQEBBAUAA4GBALD640iwKPMf\npqdYtfvmLnA7CiEuao60i/pzVJE2LIXXXbwYjNAM+7Lov+dFT+b5FcOUGqLymSG3\nkSK6OOauBHItgiGI7C87u4EJaHDvGIUxHxQQGsUM0SCIIVGK7Lwm+8e9I2X0G2GP\n9t/rrbdGzXXOCl3up99naL5XAzCIp6r5\n-----END CERTIFICATE-----\n"})}),"\n",(0,r.jsx)(t.p,{children:"Enfin, s\xe9curisez les fichiers de votre certificat."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo chown root:metronome crt.pem key.pem\nsudo chmod 640 crt.pem key.pem\nsudo chown root:root -R ae_certs\nsudo chmod 600 -R ae_certs\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Maintenant les certificats (les deux fichiers avec l'extension ",(0,r.jsx)(t.code,{children:".pem"}),") doivent \xeatre recopi\xe9s dans ",(0,r.jsx)(t.code,{children:"/etc/yunohost/certs/DOMAIN.TLD"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cp ae_certs/*.pem ./\n"})}),"\n",(0,r.jsx)(t.p,{children:"Rechargez la configuration de NGINX pour prendre en compte le nouveau certificat."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo service nginx reload\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Votre certificat est pr\xeat \xe0 servir. Vous pouvez toutefois vous assurer de sa mise en place en testant le certificat \xe0 l\u2019aide du service de ",(0,r.jsx)(t.a,{href:"https://www.geocerts.com/ssl_checker",children:"geocerts"}),"."]})]})}function u(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},4429:function(e,t,s){s.d(t,{R:()=>c,x:()=>a});var n=s(6540);let r={},i=n.createContext(r);function c(e){let t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);