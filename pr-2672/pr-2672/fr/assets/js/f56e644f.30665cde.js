"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["6048"],{6900:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>d,default:()=>u,metadata:()=>i,assets:()=>o,contentTitle:()=>t});var i=JSON.parse('{"id":"admin/troubleshooting/fail2ban","title":"D\xe9bannir une adresse IP","description":"Fail2Ban est un logiciel de pr\xe9vention des intrusions qui prot\xe8ge les serveurs informatiques contre les attaques de brute-force. Il surveille certains journaux et bannira les adresses IP qui montrent un comportement de brute-forcing.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/50.troubleshooting/05.fail2ban.mdx","sourceDirName":"admin/50.troubleshooting","slug":"/admin/troubleshooting/fail2ban","permalink":"/pr-2672/fr/admin/troubleshooting/fail2ban","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/50.troubleshooting/05.fail2ban.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"D\xe9bannir une adresse IP"},"sidebar":"admin","previous":{"title":"Cleanup","permalink":"/pr-2672/fr/admin/troubleshooting/cleanup"},"next":{"title":"Changer le mot de passe d\'administration","permalink":"/pr-2672/fr/admin/troubleshooting/change_admin_password"}}'),r=s(4848),a=s(4429);let l={title:"D\xe9bannir une adresse IP"},t,o={},d=[{value:"D\xe9bannir une adresse IP",id:"d\xe9bannir-une-adresse-ip",level:2},{value:"Passer une adresse IP en liste blanche / whitelist",id:"passer-une-adresse-ip-en-liste-blanche--whitelist",level:2}];function c(e){let n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fail2Ban"})," est un logiciel de pr\xe9vention des intrusions qui prot\xe8ge les serveurs informatiques contre les attaques de brute-force. Il surveille certains journaux et bannira les adresses IP qui montrent un comportement de brute-forcing."]}),"\n",(0,r.jsxs)(n.p,{children:["En particulier, ",(0,r.jsx)(n.strong,{children:"Fail2Ban"})," surveille les tentatives de connexion ",(0,r.jsx)(n.code,{children:"SSH"}),". Apr\xe8s 5 tentatives de connexion \xe9chou\xe9es sur SSH, Fail2Ban banniera l\u2019adresse IP pendant 10 minutes. Si cette adresse r\xe9cidive plusieurs fois, elle peut \xeatre bannie pendant une semaine."]}),"\n",(0,r.jsx)(n.h2,{id:"d\xe9bannir-une-adresse-ip",children:"D\xe9bannir une adresse IP"}),"\n",(0,r.jsx)(n.p,{children:"Pour d\xe9bloquer une adresse IP, vous devez d\u2019abord acc\xe9der \xe0 votre serveur par un moyen quelconque (par exemple \xe0 partir d\u2019une autre adresse IP ou d\u2019une autre connexion internet que celle bannie)."}),"\n",(0,r.jsxs)(n.p,{children:["Ensuite, regardez le ",(0,r.jsx)(n.strong,{children:"journal de Fail2Ban"})," pour identifier dans quelle ",(0,r.jsx)(n.code,{children:"prison"})," ou ",(0,r.jsx)(n.code,{children:"jail"})," l\u2019adresse IP a \xe9t\xe9 bannie :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo tail /var/log/fail2ban.log\n2019-01-07 16:24:47 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:49 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:51 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:54 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:57 fail2ban.filter  [1837]: INFO    [sshd] Found 11.22.33.44\n2019-01-07 16:24:57 fail2ban.actions [1837]: NOTICE  [sshd] Ban 11.22.33.44\n2019-01-07 16:24:57 fail2ban.filter  [1837]: NOTICE  [recidive] Ban 11.22.33.44\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ici, l\u2019adresse IP ",(0,r.jsx)(n.code,{children:"11.22.33.44"})," a \xe9t\xe9 bannie dans les jails ",(0,r.jsx)(n.code,{children:"sshd"})," et ",(0,r.jsx)(n.code,{children:"recidive"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Puis d\xe9banissez l\u2019adresse IP avec les commandes suivantes :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo fail2ban-client set sshd unbanip 11.22.33.44\nsudo fail2ban-client set recidive unbanip 11.22.33.44\n"})}),"\n",(0,r.jsx)(n.h2,{id:"passer-une-adresse-ip-en-liste-blanche--whitelist",children:"Passer une adresse IP en liste blanche / whitelist"}),"\n",(0,r.jsxs)(n.p,{children:["Si vous ne voulez plus qu\u2019une adresse IP \xab l\xe9gitime \xbb soit bloqu\xe9e par ",(0,r.jsx)(n.strong,{children:"YunoHost"}),", alors il faut la renseigner dans la liste blanche ou whitelist du fichier de configuration de la ",(0,r.jsx)(n.code,{children:"prison"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Lors d\u2019une mise \xe0 jour du logiciel ",(0,r.jsx)(n.strong,{children:"Fail2Ban"}),", le fichier d\u2019origine ",(0,r.jsx)(n.code,{children:"/etc/fail2ban/jail.conf"})," est \xe9cras\xe9. C\u2019est donc dans un nouveau fichier que nous allons stocker les modifications. Elles seront ainsi conserv\xe9es dans le temps."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Commencez par cr\xe9er le nouveau fichier de configuration des prisons qui s\u2019appelera ",(0,r.jsx)(n.code,{children:"yunohost-whitelist.conf"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo touch /etc/fail2ban/jail.d/yunohost-whitelist.conf\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\xc9ditez ce nouveau fichier avec votre \xe9diteur pr\xe9f\xe9r\xe9 :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/fail2ban/jail.d/yunohost-whitelist.conf\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Coller le contenu suivant dans le fichier et adapter l\u2019adresse IP ",(0,r.jsx)(n.code,{children:"XXX.XXX.XXX.XXX"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[DEFAULT]\n\nignoreip = 127.0.0.1/8 XXX.XXX.XXX.XXX #<= l'adresse IP (on peut en mettre plusieurs, s\xe9par\xe9es par un espace) que vous voulez passer en liste blanche / whitelist\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Sauvegardez le fichier et rechargez la configuration de Fail2Ban :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo fail2ban-client reload\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"F\xe9licitations, plus de risques de se bannir de son propre serveur YunoHost !"})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},4429:function(e,n,s){s.d(n,{R:()=>l,x:()=>t});var i=s(6540);let r={},a=i.createContext(r);function l(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);