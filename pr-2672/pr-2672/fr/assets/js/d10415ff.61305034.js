"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["2777"],{3550:function(e,s,n){n.r(s),n.d(s,{frontMatter:()=>o,toc:()=>l,default:()=>u,metadata:()=>r,assets:()=>a,contentTitle:()=>t});var r=JSON.parse('{"id":"admin/tutorials/external_storage","title":"Ajouter un stockage externe \xe0 son serveur","description":"Introduction","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/45.tutorials/25.external_storage.mdx","sourceDirName":"admin/45.tutorials","slug":"/admin/tutorials/external_storage","permalink":"/pr-2672/fr/admin/tutorials/external_storage","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/45.tutorials/25.external_storage.mdx","tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"sidebar_label":"Add external storage","title":"Ajouter un stockage externe \xe0 son serveur"},"sidebar":"admin","previous":{"title":"Transf\xe9rer des fichiers","permalink":"/pr-2672/fr/admin/tutorials/filezilla"},"next":{"title":"Configurer un relais SMTP","permalink":"/pr-2672/fr/admin/tutorials/email_configure_relay"}}'),i=n(4848),d=n(4429);let o={sidebar_label:"Add external storage",title:"Ajouter un stockage externe \xe0 son serveur"},t,a={},l=[{value:"Introduction",id:"introduction",level:2},{value:"<FAIcon></FAIcon> Pr\xe9-requis",id:"-pr\xe9-requis",level:2},{value:"1. Identifier les dossiers \xe0 d\xe9placer",id:"1-identifier-les-dossiers-\xe0-d\xe9placer",level:2},{value:"2. Connecter et identifier le disque",id:"2-connecter-et-identifier-le-disque",level:2},{value:"3. (Optionnel) Formater le disque",id:"3-optionnel-formater-le-disque",level:2},{value:"4. Monter le disque",id:"4-monter-le-disque",level:2},{value:"5. Monter un dossier de <code>/mnt/hdd</code> sur un des dossiers dont on veut d\xe9placer les donn\xe9es",id:"5-monter-un-dossier-de-mnthdd-sur-un-des-dossiers-dont-on-veut-d\xe9placer-les-donn\xe9es",level:2},{value:"5.1 Cr\xe9ation des sous-dossiers sur le disque",id:"51-cr\xe9ation-des-sous-dossiers-sur-le-disque",level:3},{value:"5.2 Passage en mode maintenance",id:"52-passage-en-mode-maintenance",level:3},{value:"5.3 Cr\xe9ation des points de montages",id:"53-cr\xe9ation-des-points-de-montages",level:3},{value:"5.4 Copie des donn\xe9es",id:"54-copie-des-donn\xe9es",level:3},{value:"5.5 Sortir du mode maintenance",id:"55-sortir-du-mode-maintenance",level:3},{value:"6. Monter automatiquement au d\xe9marrage",id:"6-monter-automatiquement-au-d\xe9marrage",level:2},{value:"7. Nettoyer les anciennes donn\xe9es",id:"7-nettoyer-les-anciennes-donn\xe9es",level:2},{value:"\u{1F389} F\xe9licitations !",id:"-f\xe9licitations-",level:2}];function c(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components},{FAIcon:n}=s;return n||function(e,s){throw Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("FAIcon",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(s.p,{children:"En dehors du syst\xe8me de monitoring qui s'assure que les partitions de votre syst\xe8me ne sont pas trop petites, YunoHost ne s'occupe pour l'instant pas de l'organisation de vos partitions et de vos disques."}),"\n",(0,i.jsx)(s.p,{children:"Si vous vous h\xe9bergez sur une carte ARM avec une carte SD ou sur un serveur avec un petit disque SSD, vous pourriez, pour des raisons de fiabilit\xe9 ou de manque de place, vouloir ajouter un ou des disques \xe0 votre serveur."}),"\n",(0,i.jsx)(s.admonition,{type:"warning",children:(0,i.jsxs)(s.p,{children:["Si vous n'avez plus du tout de place sur votre serveur, vous pouvez d\xe8s \xe0 pr\xe9sent taper ",(0,i.jsx)(s.code,{children:"apt clean"})," pour essayer d'en gagner un peu le temps de faire le m\xe9nage ou suivre les op\xe9rations qui vont suivre."]})}),"\n",(0,i.jsx)(s.p,{children:"Ci-dessous, vous trouverez des explications pour parvenir \xe0 d\xe9placer vos donn\xe9es sur un disque dur de fa\xe7on correcte avec un minimum d'impact vis-\xe0-vis du fonctionnement de YunoHost. Cette op\xe9ration peut se faire lors de l'installation ou, a posteriori, lorsque vos besoins de stockage ont augment\xe9 ou lorsque vous n'avez plus confiance dans votre carte SD."}),"\n",(0,i.jsx)(s.admonition,{type:"tip",children:(0,i.jsx)(s.p,{children:"La m\xe9thode pr\xe9sent\xe9e ici va d'abord monter l'unique partition du disque dur, puis utiliser un ou des sous-dossiers de ce disque pour cr\xe9er diff\xe9rents points de montage sur l'arborescence de votre syst\xe8me. Cette m\xe9thode est pr\xe9f\xe9rable \xe0 l'usage de liens symboliques, car ces derniers peuvent perturber certaines applications dont le syst\xe8me de sauvegarde de YunoHost. On pourrait aussi choisir de monter des partitions plut\xf4t que des sous-dossiers, mais il est parfois difficile d'estimer \xe0 l'avance l'\xe9volution du poids d'un dossier \xe0 l'avance."})}),"\n",(0,i.jsxs)(s.h2,{id:"-pr\xe9-requis",children:[(0,i.jsx)(n,{icon:"fa-list-alt"})," Pr\xe9-requis"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Avoir un peu de temps \xe0 un moment o\xf9 les utilisateurs de votre serveur peuvent accepter un arr\xeat des services. Les \xe9tapes \xe0 r\xe9aliser, m\xeame si elles sont relativement simples, peuvent parfois para\xeetre techniques et n\xe9cessitent dans tous les cas ",(0,i.jsx)(s.strong,{children:"de prendre son temps"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Savoir se connecter en root sur votre syst\xe8me, par exemple via ",(0,i.jsx)(s.a,{href:"/admin/command_line",children:"SSH"}),". (Note : en \xe9tant connect\xe9 en tant qu'utilisateur ",(0,i.jsx)(s.code,{children:"admin"}),", vous pouvez passer root avec ",(0,i.jsx)(s.code,{children:"sudo su"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Conna\xeetre les commandes basiques ",(0,i.jsx)(s.code,{children:"cd"}),", ",(0,i.jsx)(s.code,{children:"ls"}),", ",(0,i.jsx)(s.code,{children:"mkdir"}),", ",(0,i.jsx)(s.code,{children:"rm"})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Avoir une sauvegarde au cas o\xf9 \xe7a ne se passe pas comme pr\xe9vu"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Disposer d'un stockage suppl\xe9mentaire (disque SSD, disque dur, cl\xe9 USB) branch\xe9 \xe0 votre serveur en USB ou en SATA"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"1-identifier-les-dossiers-\xe0-d\xe9placer",children:"1. Identifier les dossiers \xe0 d\xe9placer"}),"\n",(0,i.jsxs)(s.p,{children:["La commande ",(0,i.jsx)(s.code,{children:"ncdu /"})," vous permet de naviguer dans les dossiers de votre serveur afin de constater leurs tailles."]}),"\n",(0,i.jsx)(s.p,{children:"Ci-dessous, une explication de certains chemins qui peuvent prendre du poids avec quelques commentaires pour vous aider \xe0 r\xe9duire leur poids ou \xe0 choisir de les d\xe9placer."}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Chemin"}),(0,i.jsx)(s.th,{children:"Contenu"}),(0,i.jsx)(s.th,{children:"Conseils"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/home"})}),(0,i.jsx)(s.td,{children:"Dossiers utilisateurs accessibles via SFTP"}),(0,i.jsx)(s.td,{children:"D\xe9pla\xe7able sur un disque dur"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/home/yunohost.backup"})}),(0,i.jsx)(s.td,{children:"Sauvegardes YunoHost"}),(0,i.jsx)(s.td,{children:"Selon votre strat\xe9gie de sauvegarde, il peut \xeatre pr\xe9f\xe9rable de placer ce dossier sur un disque distinct de celui o\xf9 se trouvent vos donn\xe9es ou vos bases de donn\xe9es"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/home/yunohost.app"})}),(0,i.jsx)(s.td,{children:"Donn\xe9es lourdes des applications YunoHost (nextcloud, matrix...)"}),(0,i.jsx)(s.td,{children:"D\xe9pla\xe7able sur un disque dur"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/home/yunohost.multimedia"})}),(0,i.jsx)(s.td,{children:"Donn\xe9es lourdes partag\xe9es entre plusieurs applications"}),(0,i.jsx)(s.td,{children:"D\xe9pla\xe7able sur un disque dur"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/var/lib/mysql"})}),(0,i.jsx)(s.td,{children:"Base de donn\xe9es utilis\xe9es par les applications"}),(0,i.jsx)(s.td,{children:"A laisser id\xe9alement sur le SSD pour des raisons de performances"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/var/lib/postgresql"})}),(0,i.jsx)(s.td,{children:"Base de donn\xe9es utilis\xe9es par les applications"}),(0,i.jsx)(s.td,{children:"A laisser id\xe9alement sur le SSD pour des raisons de performances"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/var/mail"})}),(0,i.jsx)(s.td,{children:"Mails des usagers"}),(0,i.jsx)(s.td,{children:"D\xe9pla\xe7able sur un disque dur"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/var/www"})}),(0,i.jsx)(s.td,{children:"Programme des applications web install\xe9es"}),(0,i.jsx)(s.td,{children:"A laisser id\xe9alement sur le SSD pour des raisons de performances"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/var/log"})}),(0,i.jsx)(s.td,{children:"Journaux des \xe9v\xe8nements (pages consult\xe9es, tentative de connexion, erreurs mat\xe9riels...)."}),(0,i.jsx)(s.td,{children:"Ce dossier ne devrait pas prendre trop de place, si il gonfle rapidement, il peut s'agir d'une erreur inscrite en boucle qu'il est pr\xe9f\xe9rable de r\xe9soudre"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/opt"})}),(0,i.jsx)(s.td,{children:"Programme et d\xe9pendance de certaines applications YunoHost."}),(0,i.jsx)(s.td,{children:"A laisser id\xe9alement sur le SSD pour des raisons de performances. Pour les applications nodejs il est possible de faire un peu de nettoyage des versions non utilis\xe9es."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"/boot"})}),(0,i.jsx)(s.td,{children:"Noyaux et fichiers de d\xe9marrage"}),(0,i.jsx)(s.td,{children:"Ne pas d\xe9placer sauf si vous savez ce que vous faites. Il peut arriver que trop de noyaux soient conserv\xe9s, il est possible de faire du nettoyage."})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"2-connecter-et-identifier-le-disque",children:"2. Connecter et identifier le disque"}),"\n",(0,i.jsx)(s.p,{children:"Commencez par brancher votre disque \xe0 votre syst\xe8me. Il faut ensuite identifier sous quel nom est d\xe9sign\xe9 le disque par le syst\xe8me."}),"\n",(0,i.jsx)(s.p,{children:"Pour cela, utilisez la commande :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"lsblk\n"})}),"\n",(0,i.jsx)(s.p,{children:"Elle peut renvoyer quelque chose comme :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT\nsda           8:0    0 931.5G  0 disk\n\u2514\u2500sda1        8:1    0 931.5G  0 part\nmmcblk0     179:0    0  14.9G  0 disk\n\u251C\u2500mmcblk0p1 179:1    0  47.7M  0 part /boot\n\u2514\u2500mmcblk0p2 179:2    0  14.8G  0 part /\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Ici, ",(0,i.jsx)(s.code,{children:"mmcblk0"})," correspond \xe0 une carte SD de 16Go (on voit que les partitions ",(0,i.jsx)(s.code,{children:"mmcblk0p1"})," et ",(0,i.jsx)(s.code,{children:"mmcblk0p2"})," correspondent \xe0 la partition de d\xe9marrage ",(0,i.jsx)(s.code,{children:"/boot"})," et \xe0 la partition syst\xe8me ",(0,i.jsx)(s.code,{children:"/"}),"). Le disque dur branch\xe9 correspond \xe0 ",(0,i.jsx)(s.code,{children:"sda"})," qui fait environ 1To, et contient une seule partition ",(0,i.jsx)(s.code,{children:"sda1"}),' qui n\'est pas mont\xe9 (pas de "MOUNTPOINT").']}),"\n",(0,i.jsx)(s.admonition,{type:"warning",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)(n,{icon:"fa-exclamation-triangle"}),"  Sur un autre syst\xe8me, il se peut que votre syst\xe8me soit install\xe9 sur ",(0,i.jsx)(s.code,{children:"sda"})," et que votre disque soit alors ",(0,i.jsx)(s.code,{children:"sdb"})," par exemple."]})}),"\n",(0,i.jsx)(s.admonition,{type:"tip",children:(0,i.jsxs)(s.p,{children:["Astuce: si la taille du disque ne vous suffit pas pour le reconna\xeetre, vous pouvez d\xe9brancher le disque lancer la commande ",(0,i.jsx)(s.code,{children:"lsblk"}),", puis rebrancher le disque, lancer ",(0,i.jsx)(s.code,{children:"lsblk"})," et en d\xe9duire les diff\xe9rences."]})}),"\n",(0,i.jsx)(s.h2,{id:"3-optionnel-formater-le-disque",children:"3. (Optionnel) Formater le disque"}),"\n",(0,i.jsx)(s.p,{children:"Cette op\xe9ration est optionnelle si votre disque est d\xe9j\xe0 format\xe9 avec un syst\xe8me de fichiers support\xe9s par linux (donc pas NTFS ou FAT32)."}),"\n",(0,i.jsx)(s.p,{children:"Cr\xe9ons une partition sur le disque :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"fdisk /dev/VOTRE_DISQUE\n"})}),"\n",(0,i.jsxs)(s.p,{children:["puis entrez successivement ",(0,i.jsx)(s.code,{children:"n"}),", ",(0,i.jsx)(s.code,{children:"p"}),", ",(0,i.jsx)(s.code,{children:"1"}),", ",(0,i.jsx)(s.code,{children:"Entr\xe9e"}),", ",(0,i.jsx)(s.code,{children:"Entr\xe9e"}),", et ",(0,i.jsx)(s.code,{children:"w"})," pour cr\xe9er une nouvelle partition."]}),"\n",(0,i.jsxs)(s.p,{children:["V\xe9rifiez avec ",(0,i.jsx)(s.code,{children:"lsblk"})," que vous avez bien votre disque contenant une seule partition."]}),"\n",(0,i.jsx)(s.p,{children:"Avant de pouvoir utiliser votre disque, il doit \xeatre format\xe9."}),"\n",(0,i.jsx)(s.admonition,{type:"warning",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)(n,{icon:"fa-exclamation-triangle"}),"  ",(0,i.jsx)(s.strong,{children:"Formater un disque implique de supprimer toutes les donn\xe9es inscrites dessus !"}),". Attention \xe0 ne pas vous tromper de nom, car cela peut avoir pour cons\xe9quence de formater un autre disque que celui voulu ! Dans l'exemple donn\xe9 pr\xe9c\xe9demment, il s'agissait de ",(0,i.jsx)(s.code,{children:"/dev/sda"}),'. Si votre disque est d\xe9j\xe0 "propre", vous pouvez passer cette \xe9tape.']})}),"\n",(0,i.jsx)(s.p,{children:"Pour formater la partition :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mkfs.ext4 /dev/VOTRE_DISQUE1\n# puis 'y' pour valider\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Remplacez ",(0,i.jsx)(s.code,{children:"VOTRE_DISQUE1"})," par le nom de la premi\xe8re partition sur le disque par exemple ",(0,i.jsx)(s.code,{children:"sda1"}),"."]}),"\n",(0,i.jsx)(s.admonition,{type:"tip",children:(0,i.jsx)(s.p,{children:"Il est possible d'adapter cette \xe9tape, pour par exemple cr\xe9er un volume raid 1 (disques en miroir) ou chiffrer le dossier."})}),"\n",(0,i.jsx)(s.h2,{id:"4-monter-le-disque",children:"4. Monter le disque"}),"\n",(0,i.jsxs)(s.p,{children:["Contrairement \xe0 Windows o\xf9 les disques sont accessibles avec des lettres (C:/), sous linux, les disques sont rendus accessibles via l'arborescence. \"Monter\" un disque signifie le rendre effectivement accessible dans l'arborescence des fichiers. Nous allons choisir arbitrairement de monter le disque dans ",(0,i.jsx)(s.code,{children:"/mnt/hdd"})," mais vous pouvez le nommer diff\xe9remment (par exemple ",(0,i.jsx)(s.code,{children:"/mnt/disque"})," ...)."]}),"\n",(0,i.jsx)(s.p,{children:"Commen\xe7ons par cr\xe9er le r\xe9pertoire :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mkdir /mnt/hdd\n"})}),"\n",(0,i.jsx)(s.p,{children:"Puis nous pouvons monter le disque manuellement avec :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mount /dev/VOTRE_DISQUE1 /mnt/hdd\n"})}),"\n",(0,i.jsxs)(s.p,{children:["(Ici, ",(0,i.jsx)(s.code,{children:"/dev/VOTRE_DISQUE1"})," correspond \xe0 la premi\xe8re partition sur le disque)"]}),"\n",(0,i.jsxs)(s.h2,{id:"5-monter-un-dossier-de-mnthdd-sur-un-des-dossiers-dont-on-veut-d\xe9placer-les-donn\xe9es",children:["5. Monter un dossier de ",(0,i.jsx)(s.code,{children:"/mnt/hdd"})," sur un des dossiers dont on veut d\xe9placer les donn\xe9es"]}),"\n",(0,i.jsxs)(s.p,{children:["Ici on va consid\xe9rer que vous souhaitez d\xe9placer les grosses donn\xe9es des applications qui se trouvent dans ",(0,i.jsx)(s.code,{children:"/home/yunohost.app"})," ainsi que les mails sur votre disque dur."]}),"\n",(0,i.jsx)(s.h3,{id:"51-cr\xe9ation-des-sous-dossiers-sur-le-disque",children:"5.1 Cr\xe9ation des sous-dossiers sur le disque"}),"\n",(0,i.jsx)(s.p,{children:"Pour commencer, on cr\xe9e un dossier dans le disque dur"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mkdir -p /mnt/hdd/home/yunohost.app\nmkdir -p /mnt/hdd/var/mail\n"})}),"\n",(0,i.jsx)(s.h3,{id:"52-passage-en-mode-maintenance",children:"5.2 Passage en mode maintenance"}),"\n",(0,i.jsx)(s.p,{children:"Puis, id\xe9alement on passe en maintenance les applications qui pourraient \xeatre en train d'\xe9crire des donn\xe9es."}),"\n",(0,i.jsx)(s.p,{children:"Exemple, pour nextcloud:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo -u nextcloud /var/www/nextcloud/occ maintenance:mode --on\n"})}),"\n",(0,i.jsx)(s.p,{children:"Exemple, pour le mail:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"systemctl stop postfix\nsystemctl stop dovecot\n"})}),"\n",(0,i.jsx)(s.admonition,{type:"warning",children:(0,i.jsx)(s.p,{children:"Si vous souhaitez d\xe9placer les base de donn\xe9es comme mariadb (mysql), il est imp\xe9ratif de stopper les services de ces bases de donn\xe9es sans quoi il est presque s\xfbr que vos donn\xe9es seront corrompues."})}),"\n",(0,i.jsx)(s.h3,{id:"53-cr\xe9ation-des-points-de-montages",children:"5.3 Cr\xe9ation des points de montages"}),"\n",(0,i.jsx)(s.p,{children:"Ensuite, on va renommer le dossier d'origine et cr\xe9er un dossier vide \xe9ponyme."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mv /home/yunohost.app /home/yunohost.app.bkp\nmkdir /home/yunohost.app\nmv /var/mail /var/mail.bkp\nmkdir /var/mail\n"})}),"\n",(0,i.jsxs)(s.p,{children:["On peut alors gr\xe2ce \xe0 la commande ",(0,i.jsx)(s.code,{children:"mount --bind"})," monter le dossier de notre disque dur sur le nouvel emplacement vide de l'arborescence."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mount --bind /mnt/hdd/home/yunohost.app /home/yunohost.app\nmount --bind /mnt/hdd/var/mail /var/mail\n"})}),"\n",(0,i.jsx)(s.h3,{id:"54-copie-des-donn\xe9es",children:"5.4 Copie des donn\xe9es"}),"\n",(0,i.jsxs)(s.p,{children:["Puis, on copie les donn\xe9es en conservant toutes les propri\xe9t\xe9s des dossiers et des fichiers. Cette op\xe9ration peut prendre un peu de temps, avec un autre terminal, vous pourrez controler l'\xe9volution en observant le poids associ\xe9 au point de montage avec ",(0,i.jsx)(s.code,{children:"df -h"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cp -a /home/yunohost.app.bkp/. /home/yunohost.app/\ncp -a /var/mail.bkp/. /var/mail/\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Une fois que c'est fini, v\xe9rifiez avec ",(0,i.jsx)(s.code,{children:"ls"})," que le contenu est bien l\xe0:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ls -la /home/yunohost.app/\nls -la /var/mail/\n"})}),"\n",(0,i.jsx)(s.h3,{id:"55-sortir-du-mode-maintenance",children:"5.5 Sortir du mode maintenance"}),"\n",(0,i.jsx)(s.p,{children:"A partir de l\xe0 vous pouvez arr\xe9ter le mode maintenance, la commande ci-dessous est \xe0 adapter selon les services que vous avez arr\xe9t\xe9s."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo -u nextcloud /var/www/nextcloud/occ maintenance:mode --off\nsystemctl start postfix\nsystemctl start dovecot\n"})}),"\n",(0,i.jsx)(s.p,{children:"A partir de cette \xe9tape, vos services tournent avec leurs donn\xe9es sur le disque, il est donc temps de tester pour voir dans quelle mesure il y a un impact sur les performances (notamment si vus utilisez de l'USB 2.0)."}),"\n",(0,i.jsx)(s.h2,{id:"6-monter-automatiquement-au-d\xe9marrage",children:"6. Monter automatiquement au d\xe9marrage"}),"\n",(0,i.jsx)(s.p,{children:"Jusqu'ici, nous avons mont\xe9 manuellement le disque et les sous-dossiers. Cependant, il est n\xe9cessaire de configurer le syst\xe8me pour qu'il monte automatiquement le disque apr\xe8s un d\xe9marrage."}),"\n",(0,i.jsx)(s.p,{children:"Si vos tests sont concluants, il faut p\xe9renniser les points de montages, sinon d\xe9p\xeachez-vous de faire machine arri\xe8re en commen\xe7ant par remettre en maintenance."}),"\n",(0,i.jsx)(s.p,{children:"Pour commencer, trouvons l'UUID (identifiant universel) de notre disque avec :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'blkid | grep "/dev/VOTRE_DISQUE1:"\n# Retourne quelque chose comme :\n# /dev/sda1:UUID="cea0b7ae-2fbc-4f01-8884-3cb5884c8bb7" TYPE="ext4" PARTUUID="34e4b02c-02"\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Ajoutons alors une ligne au fichier ",(0,i.jsx)(s.code,{children:"/etc/fstab"})," qui g\xe8re le montage des disques au d\xe9marrage. On ouvre donc le fichier avec ",(0,i.jsx)(s.code,{children:"nano"})," :"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"nano /etc/fstab\n"})}),"\n",(0,i.jsx)(s.p,{children:"Puis on ajoute ces lignes \xe0 la fin du fichier :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'UUID="cea0b7ae-2fbc-4f01-8884-3cb5884c8bb7" /mnt/hdd ext4 defaults,nofail 0 0\n/mnt/hdd/home/yunohost.app /home/yunohost.app none defaults,bind 0 0\n/mnt/hdd/var/mail /var/mail none defaults,bind 0 0\n'})}),"\n",(0,i.jsx)(s.p,{children:"(il faut adapter cette ligne en fonction des informations et choix pr\xe9c\xe9dents)"}),"\n",(0,i.jsxs)(s.p,{children:["Utiliser Ctrl+X puis ",(0,i.jsx)(s.code,{children:"o"})," pour sauvegarder."]}),"\n",(0,i.jsx)(s.p,{children:"Vous pouvez ensuite tester de red\xe9marrer le syst\xe8me pour v\xe9rifier si le disque et les sous-dossiers sont mont\xe9s automatiquement."}),"\n",(0,i.jsx)(s.h2,{id:"7-nettoyer-les-anciennes-donn\xe9es",children:"7. Nettoyer les anciennes donn\xe9es"}),"\n",(0,i.jsx)(s.p,{children:"D\xe8s que votre nouveau setup est valid\xe9, vous pouvez proc\xe9der \xe0 la suppression des anciennes donn\xe9es issues de l'\xe9tape 6.3:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"rm -Rf /home/yunohost.app.bkp\nrm -Rf /var/mail.bkp\n"})}),"\n",(0,i.jsx)(s.h2,{id:"-f\xe9licitations-",children:"\u{1F389} F\xe9licitations !"}),"\n",(0,i.jsx)(s.p,{children:"Si vous \xeates arriv\xe9 jusqu'ici sans dommage, vous avez d\xe9sormais un serveur qui tire parti d'un ou de plusieurs disques de stockage."})]})}function u(e={}){let{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},4429:function(e,s,n){n.d(s,{R:()=>o,x:()=>t});var r=n(6540);let i={},d=r.createContext(i);function o(e){let s=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(d.Provider,{value:s},e.children)}}}]);