"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["5639"],{296:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>d,default:()=>u,metadata:()=>i,assets:()=>a,contentTitle:()=>o});var i=JSON.parse('{"id":"packaging/index","title":"Empaquetage d\u2019applications","description":"Cette documentation a pour but de fournir tous les concepts de base et le vocabulaire n\xe9cessaire pour comprendre le packaging d\'applications.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/packaging/index.mdx","sourceDirName":"packaging","slug":"/packaging/","permalink":"/pr-2672/fr/packaging/","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/packaging/index.mdx","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"Empaquetage d\u2019applications","sidebar_position":0},"sidebar":"devpackaging","previous":{"title":"How is used the main domain","permalink":"/pr-2672/fr/dev/core/maindomain"},"next":{"title":"Empaquetage d\u2019applications","permalink":"/pr-2672/fr/packaging/"}}'),t=s(4848),r=s(4429);let l={title:"Empaquetage d\u2019applications",sidebar_position:0},o,a={},d=[{value:"1. La Philosophie du Packaging",id:"1-la-philosophie-du-packaging",level:2},{value:"2. Pr\xe9requis",id:"2-pr\xe9requis",level:2},{value:"3. Notes sur l&#39;histoire du packaging des applications de YunoHost",id:"3-notes-sur-lhistoire-du-packaging-des-applications-de-yunohost",level:2},{value:"4. Aper\xe7u g\xe9n\xe9ral de la structure d&#39;une application YunoHost",id:"4-aper\xe7u-g\xe9n\xe9ral-de-la-structure-dune-application-yunohost",level:2},{value:"5. Cr\xe9er votre tout premier paquet YunoHost",id:"5-cr\xe9er-votre-tout-premier-paquet-yunohost",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Cette documentation a pour but de fournir tous les concepts de base et le vocabulaire n\xe9cessaire pour comprendre le packaging d'applications."}),"\n",(0,t.jsx)(n.p,{children:"Nous d\xe9taillerons ce qu'est un paquet d'applications YunoHost, comment il fonctionne, comment cr\xe9er votre propre paquet et comment trouver de l'aide si vous en avez besoin."}),"\n",(0,t.jsx)(n.h2,{id:"1-la-philosophie-du-packaging",children:"1. La Philosophie du Packaging"}),"\n",(0,t.jsx)(n.p,{children:"La possibilit\xe9 d'installer facilement des applications \xe0 partir d'un catalogue est une caract\xe9ristique cl\xe9 de YunoHost. Alors que vous vous plongez dans le processus de packaging d'applications de YunoHost, vous devez vous souvenir de ces principes cl\xe9s :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"L'administrateur ne doit pas avoir un doctorat en informatique pour pouvoir installer, configurer et utiliser votre application"})," : partez du principe que l'administrateur ne conna\xeet pas les concepts informatiques avanc\xe9s;"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Less is more"}),", ",(0,t.jsx)(n.strong,{children:"Keep it simple!"}),": ne surchargez pas l'administrateur avec une douzaine de questions techniques ;"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Les choses doivent \xeatre op\xe9rationnelles d\xe8s le d\xe9part"})," : par exemple, l'administrateur ne doit pas avoir \xe0 terminer manuellement le processus d'installation en remplissant manuellement les informations d'identification de la base de donn\xe9es;"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Le packaging d'une application YunoHost ",(0,t.jsx)(n.strong,{children:"ne se limite pas \xe0 l'installation"})," des sources et des d\xe9pendances : il concerne \xe9galement la maintenance (mise \xe0 jour, sauvegarde...) et l'int\xe9gration de l'application dans l'\xe9cosyst\xe8me YunoHost (NGINX, SSO/LDAP, Fail2Ban, catalogue d'applications, UI/UX...)."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"2-pr\xe9requis",children:"2. Pr\xe9requis"}),"\n",(0,t.jsx)(n.p,{children:"Avant d'entrer dans le vif du sujet, cette documentation part du principe que :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Vous \xeates d\xe9j\xe0 administrateur YunoHost et vous savez d\xe9j\xe0 \xe0 quoi ressemble le processus d'installation ;)"}),"\n",(0,t.jsx)(n.li,{children:"Vous \xeates familiaris\xe9 avec l'administration syst\xe8me et la programmation bash (ou vous \xeates pr\xeat \xe0 les apprendre) ;"}),"\n",(0,t.jsx)(n.li,{children:"Vous \xeates familier avec Git (ou vous \xeates pr\xeat \xe0 l'apprendre) ;"}),"\n",(0,t.jsx)(n.li,{children:"Vous \xeates \xe0 l'aise avec le bricolage et le d\xe9bogage de mat\xe9riel informatique en g\xe9n\xe9ral."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Nous vous encourageons \xe9galement \xe0 rejoindre le ",(0,t.jsx)(n.a,{href:"/community/chat_rooms",children:"salon de discussion sur le packaging"})," pour poser toutes les questions que vous pourriez avoir !"]}),"\n",(0,t.jsxs)(n.p,{children:["\xc0 un moment donn\xe9, vous voudrez aussi avoir un environnement de d\xe9veloppement/test, soit en utilisant ",(0,t.jsx)(n.a,{href:"/packaging/resources/packaging_apps_virtualbox",children:"VirtualBox"})," ou ",(0,t.jsx)(n.a,{href:"https://github.com/yunohost/ynh-dev",children:"LXC/ynh-dev"})," qui est destin\xe9 au noyau mais peut tout \xe0 fait \xeatre utilis\xe9 pour le d\xe9veloppement d'applications. Vous pouvez \xe9galement mettre en place un VPS de d\xe9veloppement/test sur votre h\xe9bergeur pr\xe9f\xe9r\xe9, ou m\xeame d\xe9velopper sur votre prod si vous aimez vivre dangereusement ;)."]}),"\n",(0,t.jsx)(n.h2,{id:"3-notes-sur-lhistoire-du-packaging-des-applications-de-yunohost",children:"3. Notes sur l'histoire du packaging des applications de YunoHost"}),"\n",(0,t.jsx)(n.p,{children:"Beaucoup de choses dans YunoHost, et dans le format d'emballage de l'application YunoHost, sont historiques ou ont \xe9t\xe9 con\xe7ues de mani\xe8re organique. Certains aspects peuvent donc l\xe9gitimement sembler anciens."}),"\n",(0,t.jsxs)(n.p,{children:["La ",(0,t.jsx)(n.strong,{children:'"v0" du packaging d\'applications'})," consistait \xe0 \xe9crire des scripts bash bruts sans r\xe9elle standardisation/contrainte."]}),"\n",(0,t.jsxs)(n.p,{children:['Au fil du temps, les \xe9tapes r\xe9currentes (comme l\'installation des d\xe9pendances avec apt, ou la configuration de NGINX) ont \xe9t\xe9 formalis\xe9es dans des fonctions bash standardis\xe9es, appel\xe9es "helpers". Cela a marqu\xe9 ',(0,t.jsx)(n.strong,{children:'le d\xe9but de l\'\xe8re de la "v1" packaging'}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Divers outils ont \xe9t\xe9 mis en place pour tester l'application et normaliser son comportement."}),"\n",(0,t.jsxs)(n.p,{children:["Apr\xe8s un certain temps, un ensemble de pratiques et de conventions communes a \xe9merg\xe9 et est en quelque sorte refl\xe9t\xe9 et maintenu dans l'application mod\xe8le ",(0,t.jsx)(n.code,{children:"example_ynh"}),". Bien qu'il soit tentant pour les d\xe9veloppeurs de changer les sch\xe9mas de nommage des variables ou de refactoriser la structure des scripts, il s'av\xe8re qu'il est encore plus important de s'en tenir \xe0 l'ensemble des pratiques communes (m\xeame si elles sont arbitraires et peu \xe9l\xe9gantes) pour faciliter la maintenance de toutes les applications par n'importe quel membre de la communaut\xe9 du packaging \xe0 travers tous les d\xe9p\xf4ts !"]}),"\n",(0,t.jsxs)(n.p,{children:["N\xe9anmoins, m\xeame si les aides existaient, la structure inh\xe9rente des applications \xe9tait difficile et ennuyeuse \xe0 maintenir avec trop de morceaux de code redondants ou remplis de conventions historiques bizarres. ",(0,t.jsx)(n.strong,{children:"Un nouveau format v2"})," ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/pull/1289",children:"a \xe9t\xe9 con\xe7u et ajout\xe9 \xe0 YunoHost 11.1 d\xe9but 2023"})," dans l'espoir de moderniser et de simplifier l'emballage des applications et d'am\xe9liorer l'UI/UX de YunoHost."]}),"\n",(0,t.jsxs)(n.p,{children:["Cependant, ",(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost/issues/issues/2136",children:[(0,t.jsx)(n.strong,{children:"un futur format v3"})," est encore \xe0 venir"]})," pour simplifier davantage l'empaquetage des applications (comme la prise en charge des configurations NGINX/systemd/..., l'\xe9limination du besoin d'\xe9crire manuellement des scripts de suppression/sauvegarde/restauration, etc.)"]}),"\n",(0,t.jsx)(n.h2,{id:"4-aper\xe7u-g\xe9n\xe9ral-de-la-structure-dune-application-yunohost",children:"4. Aper\xe7u g\xe9n\xe9ral de la structure d'une application YunoHost"}),"\n",(0,t.jsx)(n.p,{children:"Une application YunoHost est construite dans un d\xe9p\xf4t Git. Nous vous encourageons \xe0 jeter un coup d'oeil \xe0 ces d\xe9p\xf4ts de code pour vous familiariser avec les structures des d\xe9p\xf4ts d'applications :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost-Apps/helloworld_ynh",children:["l'application ",(0,t.jsx)(n.code,{children:"helloworld_ynh"})]})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost/example_ynh",children:["l'application ",(0,t.jsx)(n.code,{children:"example_ynh"})]})," qui contient toutes les fonctionnalit\xe9s g\xe9n\xe9rales et le formattage recommand\xe9"]}),"\n",(0,t.jsxs)(n.li,{children:['votre application "r\xe9elle" pr\xe9f\xe9r\xe9e dans la liste des d\xe9pots ',(0,t.jsx)(n.a,{href:"https://github.com/orgs/YunoHost-Apps/repositories",children:"YunoHost-Apps"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Parmi les fichiers contenus dans un paquet, les plus importants sont les suivants :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["le ",(0,t.jsx)(n.strong,{children:"manifeste de l'application"})," ",(0,t.jsx)(n.code,{children:"manifest.toml"})," ",(0,t.jsxs)("small",{children:["(ou ",(0,t.jsx)(n.code,{children:".json"})," dans le pass\xe9)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Il peut \xeatre consid\xe9r\xe9 comme la carte d'identit\xe9 de l'application, contenant diverses m\xe9tadonn\xe9es."}),"\n",(0,t.jsx)(n.li,{children:"Il contient \xe9galement les questions pos\xe9es lors de l'installation de l'application."}),"\n",(0,t.jsx)(n.li,{children:"ainsi qu'un ensemble de \"ressource\" \xe0 initialiser, telles que les sources de l'app \xe0 t\xe9l\xe9charger ou les d\xe9pendances apt \xe0 installer"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"scripts/"})," contient un ensemble de scripts bash correspondant aux actions expos\xe9es dans YunoHost","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"_common.sh"}),": variables communes ou fonctions sp\xe9cifiques incluses dans d'autres scripts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"install"}),"/",(0,t.jsx)(n.code,{children:"remove"})," : la proc\xe9dure d'installation et de suppression"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"upgrade"})," : la proc\xe9dure de mise \xe0 niveau"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backup"}),"/",(0,t.jsx)(n.code,{children:"restore"})," : les proc\xe9dures de sauvegarde/restauration"]}),"\n",(0,t.jsxs)(n.li,{children:["(",(0,t.jsx)(n.code,{children:"change_url"}),") : changer l'endroit o\xf9 l'application est install\xe9e en termes de son url d'acc\xe8s web"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"conf/"})," contient un ensemble de mod\xe8les de configuration utilis\xe9s lors de l'installation de l'application. Voici quelques exemples de fichiers couramment trouv\xe9s :","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nginx.conf"})," : le mod\xe8le de configuration de NGINX (=serveur web) pour cette application"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"systemd.service"})," : le mod\xe8le de configuration du service systemd pour cette application"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"config.json/yaml/???"})," : le mod\xe8le de configuration de l'application"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Grosso modo, l'installation proprement dite se compose g\xe9n\xe9ralement des op\xe9rations suivantes (qui peuvent toutefois varier en fonction de la complexit\xe9 et des technologies utilis\xe9es par l'application) - pas n\xe9cessairement dans cet ordre exact :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"YunoHost r\xe9cup\xe8re le d\xe9p\xf4t Git du paquet."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["YunoHost pose \xe0 l'administrateur les questions d'installation d\xe9finies dans ",(0,t.jsx)(n.code,{children:"manifest.toml"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"L'administrateur remplit le formulaire et d\xe9marre l'installation."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"YunoHost fournit un ensemble de pr\xe9-requis techniques (appel\xe9s 'ressources') tels que :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["initialise le magasin de cl\xe9s/valeurs de l'application ",(0,t.jsx)(n.code,{children:"settings.yml"})," avec les r\xe9ponses de l'administrateur au formulaire d'installation"]}),"\n",(0,t.jsx)(n.li,{children:"cr\xe9e un utilisateur UNIX pour cette application"}),"\n",(0,t.jsx)(n.li,{children:"installe les d\xe9pendances apt n\xe9cessaires \xe0 cette application"}),"\n",(0,t.jsx)(n.li,{children:"choisit un port pour le reverse-proxying interne"}),"\n",(0,t.jsx)(n.li,{children:"initialise une base de donn\xe9es SQL vide"}),"\n",(0,t.jsx)(n.li,{children:"configure les permissions SSOwat"}),"\n",(0,t.jsx)(n.li,{children:"..."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Le script ",(0,t.jsx)(n.code,{children:"install"})," de l'application est ex\xe9cut\xe9 et ses fonctions typiques sont de :"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"r\xe9cup\xe9rer et d\xe9ployer les sources de l'application"}),"\n",(0,t.jsx)(n.li,{children:"configurer l'application (typiquement les identifiants de la base de donn\xe9es, le port interne du reverse-proxy...)"}),"\n",(0,t.jsx)(n.li,{children:"ajouter la configuration de NGINX"}),"\n",(0,t.jsx)(n.li,{children:"ajoute la configuration systemd du daemon de l'application"}),"\n",(0,t.jsx)(n.li,{children:"d\xe9marre le daemon de l'application"}),"\n",(0,t.jsx)(n.li,{children:"divers r\xe9glages de finalisation"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"???"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"L'application est pr\xeate \xe0 l'emploi !"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"5-cr\xe9er-votre-tout-premier-paquet-yunohost",children:"5. Cr\xe9er votre tout premier paquet YunoHost"}),"\n",(0,t.jsxs)(n.p,{children:["A moins que vous ne souhaitiez vraiment partir de z\xe9ro ou de ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/example_ynh",children:(0,t.jsx)(n.code,{children:"example_ynh"})}),", une pratique courante consiste \xe0 identifier une application similaire \xe0 celle que vous essayez d'empaqueter - typiquement parce qu'elle repose sur les m\xeames technologies - \xe0 cloner le d\xe9p\xf4t de code correspondant, et \xe0 adapter les diff\xe9rents fichiers."]}),"\n",(0,t.jsx)(n.p,{children:"TODO/FIXME : here we should list a bunch of well-knowh apps for classic technologies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Applications PHP :"}),"\n",(0,t.jsx)(n.li,{children:"Applications NodeJS :"}),"\n",(0,t.jsx)(n.li,{children:"Applications Python :"}),"\n",(0,t.jsx)(n.li,{children:"???"}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},4429:function(e,n,s){s.d(n,{R:()=>l,x:()=>o});var i=s(6540);let t={},r=i.createContext(t);function l(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);