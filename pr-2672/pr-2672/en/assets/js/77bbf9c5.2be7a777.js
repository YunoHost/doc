"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["2651"],{8551:function(e,t,n){n.r(t),n.d(t,{frontMatter:()=>r,toc:()=>d,default:()=>h,metadata:()=>s,assets:()=>o,contentTitle:()=>c});var s=JSON.parse('{"id":"admin/tutorials/certificate_custom","title":"Custom certificates","description":"Since version 2.5, YunoHost integrates Let\'s Encrypt certificates automated management. You can easily and freely install a Let\'s Encrypt certificate. The following document describes the steps for installing a paid certificate from a certification authority (Gandi, RapidSSL, StartSSL, Cacert).","source":"@site/docs/admin/45.tutorials/45.certificate_custom.mdx","sourceDirName":"admin/45.tutorials","slug":"/admin/tutorials/certificate_custom","permalink":"/pr-2672/en/admin/tutorials/certificate_custom","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/admin/45.tutorials/45.certificate_custom.mdx","tags":[],"version":"current","sidebarPosition":45,"frontMatter":{"title":"Custom certificates"},"sidebar":"admin","previous":{"title":"Configure Tor Hidden Service","permalink":"/pr-2672/en/admin/tutorials/torhiddenservice"},"next":{"title":"Move apps storage","permalink":"/pr-2672/en/admin/tutorials/moving_app_folder"}}'),i=n(4848),a=n(4429);let r={title:"Custom certificates"},c,o={},d=[{value:"Adding a signed certificate by an authority (other than Let&#39;s Encrypt)",id:"adding-a-signed-certificate-by-an-authority-other-than-lets-encrypt",level:3},{value:"StartSSL",id:"startssl",level:4},{value:"Gandi",id:"gandi",level:4},{value:"RapidSSL",id:"rapidssl",level:4},{value:"Cacert",id:"cacert",level:4}];function l(e){let t={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["Since version 2.5, YunoHost integrates Let's Encrypt certificates automated management. You can easily and freely ",(0,i.jsx)(t.a,{href:"/admin/domains/certificate",children:"install a Let's Encrypt certificate"}),". The following document describes the steps for installing a paid certificate from a certification authority (",(0,i.jsx)(t.strong,{children:"Gandi"}),", ",(0,i.jsx)(t.strong,{children:"RapidSSL"}),", ",(0,i.jsx)(t.strong,{children:"StartSSL"}),", ",(0,i.jsx)(t.strong,{children:"Cacert"}),")."]})}),"\n",(0,i.jsx)(t.p,{children:"Some changes have taken place which impact the procedures indicated below:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Metronome group is no longer used directly but ssl-cert."}),"\n",(0,i.jsxs)(t.li,{children:["A ",(0,i.jsx)(t.code,{children:"/etc/yunohost/certs/DOMAIN.LTD-history/stamp"})," directory is used to keep each configuration created and a symlink is created."]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"adding-a-signed-certificate-by-an-authority-other-than-lets-encrypt",children:"Adding a signed certificate by an authority (other than Let's Encrypt)"}),"\n",(0,i.jsx)(t.p,{children:"After the certificate creation with your registration authority, you must have a private key, the key file, and a public certificate, the crt file."}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"Note that the key file is very sensitive, it is strictly personal and must be very well secured."})}),"\n",(0,i.jsx)(t.p,{children:"These two files should be copied to the server, if they are not already there."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"scp CERTIFICATE.crt admin@DOMAIN.TLD:ssl.crt\nscp KEY.key admin@DOMAIN.TLD:ssl.key\n"})}),"\n",(0,i.jsxs)(t.p,{children:["From Windows, scp can be used with Putty, by downloading the tool ",(0,i.jsx)(t.a,{href:"http://the.earth.li/~sgtatham/putty/latest/x86/pscp.exe",children:"pscp"})]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"pscp -P 22 CERTIFICATE.crt admin@DOMAIN.TLD:ssl.crt\npscp -P 22 KEY.key admin@DOMAIN.TLD:ssl.key\n"})}),"\n",(0,i.jsxs)(t.p,{children:["As soon as the files are on the server, the rest of the work will be done on it. In ",(0,i.jsx)(t.a,{href:"/admin/command_line",children:"ssh"})," or locally.\nFirst, create a folder to store the obtained certificates."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo mkdir /etc/yunohost/certs/DOMAIN.TLD/ae_certs\nsudo mv ssl.key ssl.crt /etc/yunohost/certs/DOMAIN.TLD/ae_certs/\n"})}),"\n",(0,i.jsx)(t.p,{children:"Then, go to the parent folder to continue."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"cd /etc/yunohost/certs/DOMAIN.TLD/\n"})}),"\n",(0,i.jsx)(t.p,{children:"As a caution, back up the certificates of origin from YunoHost."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo mkdir yunohost_self_signed\nsudo mv *.pem *.cnf yunohost_self_signed/\n"})}),"\n",(0,i.jsx)(t.p,{children:"Depending on the registration authority, intermediate and root certificates must be obtained."}),"\n",(0,i.jsx)(t.h4,{id:"startssl",children:"StartSSL"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo wget http://www.startssl.com/certs/ca.pem -O ae_certs/ca.pem\nsudo wget http://www.startssl.com/certs/sub.class1.server.ca.pem -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,i.jsx)(t.h4,{id:"gandi",children:"Gandi"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo wget https://www.gandi.net/static/CAs/GandiStandardSSLCA2.pem -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,i.jsx)(t.h4,{id:"rapidssl",children:"RapidSSL"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo wget https://knowledge.rapidssl.com/library/VERISIGN/INTERNATIONAL_AFFILIATES/RapidSSL/AR1548/RapidSSLCABundle.txt -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,i.jsx)(t.h4,{id:"cacert",children:"Cacert"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo wget http://www.cacert.org/certs/root.crt -O ae_certs/ca.pem\nsudo wget http://www.cacert.org/certs/class3.crt -O ae_certs/intermediate_ca.pem\n"})}),"\n",(0,i.jsx)(t.p,{children:"Intermediate and root certificates must be combined with the obtained certificate to create a unified certificate chain."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"cat ae_certs/ssl.crt ae_certs/intermediate_ca.pem ae_certs/ca.pem | sudo tee crt.pem\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The private key must be converted to ",(0,i.jsx)(t.code,{children:".pem"})," format."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo openssl rsa -in ae_certs/ssl.key -out key.pem -outform PEM\n"})}),"\n",(0,i.jsx)(t.p,{children:"To ensure the certificates syntax, check the files contents."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"cat crt.pem key.pem\n"})}),"\n",(0,i.jsx)(t.p,{children:"The certificates and private key should look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"-----BEGIN CERTIFICATE-----\nMIICVDCCAb0CAQEwDQYJKoZIhvcNAQEEBQAwdDELMAkGA1UEBhMCRlIxFTATBgNV\nBAgTDENvcnNlIGR1IFN1ZDEQMA4GA1UEBxMHQWphY2NpbzEMMAoGA1UEChMDTExC\nMREwDwYDVQQLEwhCVFMgSU5GTzEbMBkGA1UEAxMSc2VydmV1ci5idHNpbmZvLmZy\nMB4XDTA0MDIwODE2MjQyNloXDTA0MDMwOTE2MjQyNlowcTELMAkGA1UEBhMCRlIx\nFTATBgNVBAgTDENvcnNlIGR1IFN1ZDEQMA4GA1UEBxMHQWphY2NpbzEMMAoGA1UE\nChMDTExCMREwDwYDVQQLEwhCVFMgSU5GTzEYMBYGA1UEAxMPcHJvZi5idHNpbmZv\nLmZyMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSUagxPSv3LtgDV5sygt12\nkSbN/NWP0QUiPlksOkF2NkPfwW/mf55dD1hSndlOM/5kLbSBo5ieE3TgikF0Iktj\nBWm5xSqewM5QDYzXFt031DrPX63Fvo+tCKTQoVItdEuJPMahVsXnDyYHeUURRWLW\nwc0BzEgFZGGw7wiMF6wt5QIDAQABMA0GCSqGSIb3DQEBBAUAA4GBALD640iwKPMf\npqdYtfvmLnA7CiEuao60i/pzVJE2LIXXXbwYjNAM+7Lov+dFT+b5FcOUGqLymSG3\nkSK6OOauBHItgiGI7C87u4EJaHDvGIUxHxQQGsUM0SCIIVGK7Lwm+8e9I2X0G2GP\n9t/rrbdGzXXOCl3up99naL5XAzCIp6r5\n-----END CERTIFICATE-----\n"})}),"\n",(0,i.jsx)(t.p,{children:"Finally, secure your certificate files."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo chown root:ssl-cert crt.pem key.pem\nsudo chmod 640 crt.pem key.pem\nsudo chown root:root -R ae_certs\nsudo chmod 600 -R ae_certs\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Now the certificates (two files with the extension ",(0,i.jsx)(t.code,{children:".pem"}),") must be copied in ",(0,i.jsx)(t.code,{children:"/etc/yunohost/certs/DOMAIN.TLD"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"cp ae_certs/*.pem ./\n"})}),"\n",(0,i.jsx)(t.p,{children:"Reload NGINX configuration to take into account the new certificate."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo service nginx reload\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Your certificate is ready. However, you can ensure that it is in place by testing the certificate using the ",(0,i.jsx)(t.a,{href:"https://www.geocerts.com/ssl_checker",children:"geocerts"}),"."]})]})}function h(e={}){let{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},4429:function(e,t,n){n.d(t,{R:()=>r,x:()=>c});var s=n(6540);let i={},a=s.createContext(i);function r(e){let t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);