"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["5791"],{9773:function(e,n,o){o.r(n),o.d(n,{frontMatter:()=>d,toc:()=>l,default:()=>h,metadata:()=>t,assets:()=>c,contentTitle:()=>r});var t=JSON.parse('{"id":"dev/core/ynh_core","title":"Working on the API and CLI","description":"When using ynh-dev, run in the container:","source":"@site/docs/dev/80.core/20.ynh_core.mdx","sourceDirName":"dev/80.core","slug":"/dev/core/ynh_core","permalink":"/doc/pr-2704/en/dev/core/ynh_core","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/dev/80.core/20.ynh_core.mdx","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Working on the API and CLI"},"sidebar":"devpackaging","previous":{"title":"Development environment","permalink":"/doc/pr-2704/en/dev/core/devenv"},"next":{"title":"Working on the YunoHost web admin","permalink":"/doc/pr-2704/en/dev/core/ynh_admin"}}'),i=o(4848),s=o(4429);let d={title:"Working on the API and CLI"},r,c={},l=[{value:"The actionsmap",id:"the-actionsmap",level:2},{value:"Coding style",id:"coding-style",level:2},{value:"YunoHost specific rules",id:"yunohost-specific-rules",level:3}];function a(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["When using ",(0,i.jsx)(n.code,{children:"ynh-dev"}),", run in the container:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"./ynh-dev use-git yunohost\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you work on Moulinette too:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"./ynh-dev use-git moulinette\n"})}),"\n",(0,i.jsx)(n.h2,{id:"the-actionsmap",children:"The actionsmap"}),"\n",(0,i.jsxs)(n.p,{children:["The actionsmap file (",(0,i.jsx)(n.code,{children:"data/actionsmap/yunohost.yml"}),") defines the command line ",(0,i.jsx)(n.em,{children:"and"}),'\nthe API structure. It is structured as "categories", "actions", and "arguments".']}),"\n",(0,i.jsxs)(n.p,{children:["For example for the command line ",(0,i.jsx)(n.code,{children:"yunohost domain add some.domain.tld"}),", the\ncategory is ",(0,i.jsx)(n.code,{children:"domain"}),", the action is ",(0,i.jsx)(n.code,{children:"add"}),", and ",(0,i.jsx)(n.code,{children:"some.domain.tld"})," is an argument."]}),"\n",(0,i.jsxs)(n.p,{children:["Moulinette will automatically map commands in the actionsmap to Python functions\n(and their arguments) located in ",(0,i.jsx)(n.code,{children:"src/yunohost/"}),". For example, typing\n",(0,i.jsx)(n.code,{children:"yunohost domain add some.domain.tld"})," will call the function ",(0,i.jsx)(n.code,{children:"domain_add(domainName)"}),"\nin ",(0,i.jsx)(n.code,{children:"domain.py"}),", with the argument ",(0,i.jsx)(n.code,{children:"domainName"})," equal to ",(0,i.jsx)(n.code,{children:'"some.domain.tld"'}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsx)(n.p,{children:"Each time you edit the actionsmap or the Python code, you should restart the YunoHost\napi with:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"systemctl restart yunohost-api\n"})}),(0,i.jsx)(n.p,{children:"You'll need to retype your admin and password in the web interface."})]}),"\n",(0,i.jsx)(n.h2,{id:"coding-style",children:"Coding style"}),"\n",(0,i.jsxs)(n.p,{children:["Please follow the standard PEP8 rules, add ",(0,i.jsx)(n.a,{href:"https://docs.python.org/3/library/typing.html",children:"Python typing"}),",\nand run the usual linting tools for Python and Bash."]}),"\n",(0,i.jsx)(n.p,{children:"Github Actions will run the linting tools and report errors."}),"\n",(0,i.jsx)(n.h3,{id:"yunohost-specific-rules",children:"YunoHost specific rules"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To handle exceptions, you should raise some ",(0,i.jsx)(n.code,{children:"YunohostError()"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To help with internationalizing the messages, use ",(0,i.jsx)(n.code,{children:"m18n.n('some-message-id')"}),"\nand put your string in ",(0,i.jsx)(n.code,{children:"locales/en.json"}),". You can also put arguments and use\nthem in the string with ",(0,i.jsx)(n.code,{children:"{{some-argument:s}}"}),". Don't edit other locales files,\nthis will be done using ",(0,i.jsx)(n.a,{href:"https://translate.yunohost.org/",children:"weblate"})," !"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:['Name of "private" functions should start with a ',(0,i.jsx)(n.code,{children:"_"})]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},4429:function(e,n,o){o.d(n,{R:()=>d,x:()=>r});var t=o(6540);let i={},s=t.createContext(i);function d(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);