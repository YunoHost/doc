"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["8124"],{9556:function(e,a,s){s.r(a),s.d(a,{frontMatter:()=>t,toc:()=>u,default:()=>h,metadata:()=>n,assets:()=>d,contentTitle:()=>c});var n=JSON.parse('{"id":"admin/backups/clone_filesystem","title":"Snapshotting the entire filesystem","description":"Lo strumento di backup di YunoHost salva solamente i files utili e si basa su degli script di ripristino per reinstallare le dipendenze dei vostri programmi installati. In altre parole, il ripristino di YunoHost prevede in un primo tempo la reinstallazione del sistema e in seguito il ripristino dei dati.","source":"@site/i18n/it/docusaurus-plugin-content-docs/current/admin/40.backups/15.clone_filesystem.mdx","sourceDirName":"admin/40.backups","slug":"/admin/backups/clone_filesystem","permalink":"/doc/pr-2704/it/admin/backups/clone_filesystem","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/it/docusaurus-plugin-content-docs/current/admin/40.backups/15.clone_filesystem.mdx","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"title":"Snapshotting the entire filesystem"},"sidebar":"admin","previous":{"title":"Backup methods","permalink":"/doc/pr-2704/it/admin/backups/backup_methods"},"next":{"title":"Evitare i problemi hardware","permalink":"/doc/pr-2704/it/admin/backups/avoid_hardware_failure"}}'),i=s(4848),r=s(4429),o=s(4109),l=s(3703);let t={title:"Snapshotting the entire filesystem"},c,d={},u=[{value:"Eseguire uno snapshot",id:"eseguire-uno-snapshot",level:2},{value:"Creare una immagine a freddo del server",id:"creare-una-immagine-a-freddo-del-server",level:2}];function p(e){let a={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.p,{children:"Lo strumento di backup di YunoHost salva solamente i files utili e si basa su degli script di ripristino per reinstallare le dipendenze dei vostri programmi installati. In altre parole, il ripristino di YunoHost prevede in un primo tempo la reinstallazione del sistema e in seguito il ripristino dei dati."}),"\n",(0,i.jsx)(a.p,{children:"Realizzare un'immagine completa pu\xf2 essere un metodo, complementare o alternativo, per un backup del vostro server. Il vantaggio sta nel fatto che il vostro server pu\xf2 essere ripristinato nella stessa configurazione presente al momento del backup."}),"\n",(0,i.jsx)(a.p,{children:"In base a quale tipo di installazione avete, potrete creare uno snapshot oppure clonare il supporto che ospita il sistema (mentre \xe8 spento)."}),"\n",(0,i.jsx)(a.h2,{id:"eseguire-uno-snapshot",children:"Eseguire uno snapshot"}),"\n",(0,i.jsx)(a.p,{children:"Lo snapshot permette di congelare l'immagine del file system. Gli snapshot sono molto comodi in caso di aggiornamenti frequenti o di prove, perch\xe9 vi permettono di tornare facilmente sui vostri passi in caso di problemi. Purtroppo, a meno di non avere un cluster ad altissima affidabilit\xe0, gli snapshot non vi proteggono efficacemente contro i guasti hardware o catastrofi (come l'incendio di OVH a Strasburgo nel 2021)."}),"\n",(0,i.jsx)(a.p,{children:"Generalmente gli snapshot non occupano molto spazio sull'hard disk, si basano sul principio del backup differenziale, salvano cio\xe8 solo le variazioni dei file avvenute dopo la creazione del primo snapshot. Di conseguenza solo le modifiche prendono spazio."}),"\n",(0,i.jsx)(a.admonition,{type:"info",children:(0,i.jsx)(a.p,{children:"Ricordatevi di cancellare i vecchi snapshot, eviterete di consumare inutilmente spazio con backup differenziali troppo datati!"})}),"\n",(0,i.jsx)(a.p,{children:"Potete usare questo sistema con la maggior parte dei fornitori VPS (quasi sempre a pagamento), nei programmi di gestione di macchine virtuali oppure, se avete installato YunoHost con un filesystem avanzato quale btrfs, ceph o ZFS potrete creare gli snapshot da riga di comando."}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsxs)(l.A,{value:"vps",label:"VPS",children:[(0,i.jsx)(a.p,{children:"Sotto la documentazione per i provider pi\xf9 conosciuti:"}),(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.a,{href:"https://docs.digitalocean.com/products/images/snapshots/",children:"DigitalOcean (EN)"})}),"\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.a,{href:"https://docs.gandi.net/fr/simple_hosting/operations_courantes/snapshots.html",children:"Gandi"})}),"\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.a,{href:"https://docs.ovh.com/fr/vps/snapshot-vps/",children:"OVH"})}),"\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.a,{href:"https://www.scaleway.com/en/docs/backup-your-data-with-snapshots/",children:"Scaleway (EN)"})}),"\n"]})]}),(0,i.jsxs)(l.A,{value:"virtualbox",label:"VirtualBox",children:[(0,i.jsxs)(a.p,{children:["Seleziona la macchina virtuale e clicca su ",(0,i.jsx)(a.code,{children:"Snapshot"}),", poi indica il nome dello snapshot e clicca ",(0,i.jsx)(a.code,{children:"OK"}),".\n",(0,i.jsx)(a.img,{alt:"Il bottone per gli snapshot button si trova in alto a destra",src:s(9361).A+"",width:"720",height:"381"})]}),(0,i.jsxs)(a.p,{children:["Per ripristinare, selezionate la macchina virtuale, cliccate su",(0,i.jsx)(a.code,{children:"Snapshots"})," poi scegliete ",(0,i.jsx)(a.code,{children:"Restore Snapshot option"}),".\n",(0,i.jsx)(a.img,{src:s(486).A+"",width:"719",height:"366"})]}),(0,i.jsxs)(a.p,{children:["Infine cliccate su ",(0,i.jsx)(a.code,{children:"Restore Snapshot"}),".\n",(0,i.jsx)(a.img,{src:s(7883).A+"",width:"720",height:"381"})]})]}),(0,i.jsx)(l.A,{value:"proxmox",label:"Proxmox",children:(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Select the virtual machine"}),"\n",(0,i.jsxs)(a.li,{children:["Go to the ",(0,i.jsx)(a.code,{children:"Backup"})," tab"]}),"\n",(0,i.jsxs)(a.li,{children:["Click on ",(0,i.jsx)(a.code,{children:"Backup now"}),"."]}),"\n",(0,i.jsxs)(a.li,{children:["Choose ",(0,i.jsx)(a.code,{children:"Snapshot"})," mode"]}),"\n",(0,i.jsx)(a.li,{children:"Validate"}),"\n"]})}),(0,i.jsxs)(l.A,{value:"btrfs",label:"BTRFS",children:[(0,i.jsxs)(a.p,{children:["Nell'esempio seguente ",(0,i.jsx)(a.code,{children:"/pool/volume"})," \xe8 il volume da salvare."]}),(0,i.jsx)(a.p,{children:"Creare uno snapshot in sola lettura"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:'btrfs subvolume snapshot /pool/volume /pool/volume/$(date +"%Y-%m-%d_%H:%M")\n'})}),(0,i.jsx)(a.p,{children:"Elencare gli snapshots"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"btrfs subvolume show /pool/volume\n"})}),(0,i.jsx)(a.p,{children:"Ripristinare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"btrfs sub del /pool/volume\nbtrfs sub snap /pool/volume/2021-07-22_16:12 /pool/volume\nbtrfs sub del /pool/volume/2021-07-22_16:12\n"})}),(0,i.jsx)(a.p,{children:"Cancellare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"btrfs subvolume delete /pool/volume/2021-07-22_16:12\n"})}),(0,i.jsx)(a.admonition,{type:"caution",children:(0,i.jsx)(a.p,{children:"Attenzione a non cancellate il volume originale"})}),(0,i.jsx)(a.admonition,{type:"tip",children:(0,i.jsxs)(a.p,{children:["Seguite ",(0,i.jsx)(a.a,{href:"https://www.linux.com/training-tutorials/how-create-and-manage-btrfs-snapshots-and-rollbacks-linux-part-2/",children:"questo tutorial"})," per maggiori informazioni"]})})]}),(0,i.jsxs)(l.A,{value:"ceph",label:"CEPH",children:[(0,i.jsxs)(a.p,{children:["Nell'esempio seguente ",(0,i.jsx)(a.code,{children:"pool/volume"})," \xe8 il volume che vogliamo salvare"]}),(0,i.jsx)(a.p,{children:"Creare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:'rbd snap create pool/volume@$(date +"%Y-%m-%d_%H:%M")\n'})}),(0,i.jsx)(a.p,{children:"Elencare gli snapshots"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"rbd snap ls pool/volume\n"})}),(0,i.jsx)(a.p,{children:"Ripristinare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"rbd snap rollback pool/volume@2021-07-22_16:22\n"})}),(0,i.jsx)(a.p,{children:"Cancellare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"rbd snap rm pool/volume@2021-07-22_16:12\n"})})]}),(0,i.jsxs)(l.A,{value:"zfs",label:"ZFS",children:[(0,i.jsxs)(a.p,{children:["Nell'esempio seguente ",(0,i.jsx)(a.code,{children:"pool/volume"})," \xe8 il volume che vogliamo salvare"]}),(0,i.jsx)(a.p,{children:"Creare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:'zfs snapshot pool/volume@$(date +"%Y-%m-%d_%H:%M")\n'})}),(0,i.jsx)(a.p,{children:"Elencare gli snapshots"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"zfs list -t snapshot -o name,creation\n"})}),(0,i.jsx)(a.p,{children:"Ripristinare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"zfs rollback pool/volume@2021-07-22_16:22\n"})}),(0,i.jsx)(a.p,{children:"Cancellare uno snapshot"}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"zfs destroy pool/volume@2021-07-22_16:12\n"})})]})]}),"\n",(0,i.jsx)(a.h2,{id:"creare-una-immagine-a-freddo-del-server",children:"Creare una immagine a freddo del server"}),"\n",(0,i.jsx)(a.p,{children:"Potete clonare il supporto del vostro server (scheda SD, disco SSD, volume di un VPS...) al fine di creare una immagine del disco. L'immagine creata, prima che venga compressa, sar\xe0 della stessa dimensione del vostro supporto e di conseguenza questa procedura \xe8 consigliata per supporti di capacit\xe0 inferiore a 64GB."}),"\n",(0,i.jsx)(a.p,{children:"Questo metodo comporta lo spegnimento del server per il tempo necessario alla creazione dell'immagine, eccetto nel caso che possiate usare uno snapshot come origine. Se il server YunoHost \xe8 ospitato su un VPS dovrete riavviarlo in modalit\xe0 rescue dall'interfaccia del vostro provider."}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsxs)(l.A,{value:"usbimage",label:"With USBimager",children:[(0,i.jsxs)(a.p,{children:["Questo pu\xf2 essere fatto con il programma ",(0,i.jsx)(a.a,{href:"https://bztsrc.gitlab.io/usbimager/",children:"USBimager"})," (N.B.: assicuratevi di scaricare la versione  'Read-write'! Non la versione 'Write-only'!). Il processo poi prosegue \"all'opposto\" della copia sulla scheda SD:"]}),(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Turn off your server"}),"\n",(0,i.jsx)(a.li,{children:"Retrieve the SD card and plug it into your computer"}),"\n",(0,i.jsx)(a.li,{children:'In USBimager, click on "Read" to create an image ("photograph") of the SD card. You can use the resulting file to restore the whole system later.'}),"\n"]}),(0,i.jsxs)(a.p,{children:["Maggiori informazioni ",(0,i.jsx)(a.a,{href:"https://gitlab.com/bztsrc/usbimager/#creating-backup-image-file-from-device",children:"nella documentazione di USBimager"})]})]}),(0,i.jsxs)(l.A,{value:"dd",label:"In command line with dd",children:[(0,i.jsxs)(a.p,{children:["Se siete avezzi al terminale potete ottenere lo stesso risultato con il comando ",(0,i.jsx)(a.code,{children:"dd"})]}),(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-bash",children:"dd if=/dev/mmcblk0 | gzip > ./my_snapshot.gz\n"})}),(0,i.jsxs)(a.p,{children:["dove ",(0,i.jsx)(a.code,{children:"/dev/mmcblk0"})," sar\xe0 il vostro supporto (scheda SD o disco)."]})]})]})]})}function h(e={}){let{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},9361:function(e,a,s){s.d(a,{A:()=>n});let n=s.p+"assets/images/virtualbox-snapshot2-8b23f84615e0a99e43d2636c70d33a5d.webp"},486:function(e,a,s){s.d(a,{A:()=>n});let n=s.p+"assets/images/virtualbox-snapshot3-08a179ce073e3326be3cbd1880a89b44.webp"},7883:function(e,a,s){s.d(a,{A:()=>n});let n=s.p+"assets/images/virtualbox-snapshot4-5153c257e34ee578c19f1e044bd0ab85.webp"},3703:function(e,a,s){s.d(a,{A:()=>r});var n=s(4848);s(6540);var i=s(9836);function r({children:e,hidden:a,className:s}){return(0,n.jsx)("div",{role:"tabpanel",className:(0,i.A)("tabItem_Ymn6",s),hidden:a,children:e})}},4109:function(e,a,s){s.d(a,{A:()=>b});var n=s(4848),i=s(6540),r=s(9836),o=s(6364),l=s(8251),t=s(6347),c=s(8004),d=s(5580),u=s(2213),p=s(5734);function h(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){let{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:a}){return a.some(a=>a.value===e)}var v=s(8864);function g({className:e,block:a,selectedValue:s,selectValue:i,tabValues:o}){let t=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),d=e=>{let a=e.currentTarget,n=o[t.indexOf(a)].value;n!==s&&(c(a),i(n))},u=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let s=t.indexOf(e.currentTarget)+1;a=t[s]??t[0];break}case"ArrowLeft":{let s=t.indexOf(e.currentTarget)-1;a=t[s]??t[t.length-1]}}a?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":a},e),children:o.map(({value:e,label:a,attributes:i})=>(0,n.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{t.push(e)},onKeyDown:u,onClick:d,...i,className:(0,r.A)("tabs__item","tabItem_LNqP",i?.className,{"tabs__item--active":s===e}),children:a??e},e))})}function f({lazy:e,children:a,selectedValue:s}){let o=(Array.isArray(a)?a:[a]).filter(Boolean);if(e){let e=o.find(e=>e.props.value===s);return e?(0,i.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:o.map((e,a)=>(0,i.cloneElement)(e,{key:a,hidden:e.props.value!==s}))})}function x(e){let a=function(e){let a,{defaultValue:s,queryString:n=!1,groupId:r}=e,o=function(e){let{values:a,children:s}=e;return(0,i.useMemo)(()=>{let e=a??h(s).map(({props:{value:e,label:a,attributes:s,default:n}})=>({value:e,label:a,attributes:s,default:n})),n=(0,u.XI)(e,(e,a)=>e.value===a.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[a,s])}(e),[l,v]=(0,i.useState)(()=>(function({defaultValue:e,tabValues:a}){if(0===a.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:a}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${a.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let s=a.find(e=>e.default)??a[0];if(!s)throw Error("Unexpected error: 0 tabValues");return s.value})({defaultValue:s,tabValues:o})),[g,f]=function({queryString:e=!1,groupId:a}){let s=(0,t.W6)(),n=function({queryString:e=!1,groupId:a}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!a)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:e,groupId:a});return[(0,d.aZ)(n),(0,i.useCallback)(e=>{if(!n)return;let a=new URLSearchParams(s.location.search);a.set(n,e),s.replace({...s.location,search:a.toString()})},[n,s])]}({queryString:n,groupId:r}),[x,b]=function({groupId:e}){let a=e?`docusaurus.tab.${e}`:null,[s,n]=(0,p.Dv)(a);return[s,(0,i.useCallback)(e=>{a&&n.set(e)},[a,n])]}({groupId:r}),j=m({value:a=g??x,tabValues:o})?a:null;return(0,c.A)(()=>{j&&v(j)},[j]),{selectedValue:l,selectValue:(0,i.useCallback)(e=>{if(!m({value:e,tabValues:o}))throw Error(`Can't select invalid tab value=${e}`);v(e),f(e),b(e)},[f,b,o]),tabValues:o}}(e);return(0,n.jsxs)("div",{className:(0,r.A)(o.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,n.jsx)(g,{...a,...e}),(0,n.jsx)(f,{...a,...e})]})}function b(e){let a=(0,v.A)();return(0,n.jsx)(x,{...e,children:h(e.children)},String(a))}},4429:function(e,a,s){s.d(a,{R:()=>o,x:()=>l});var n=s(6540);let i={},r=n.createContext(i);function o(e){let a=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);