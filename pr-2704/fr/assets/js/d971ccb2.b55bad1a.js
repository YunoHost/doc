"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["9121"],{5767:function(e,r,s){s.r(r),s.d(r,{frontMatter:()=>l,toc:()=>d,default:()=>p,metadata:()=>n,assets:()=>c,contentTitle:()=>u});var n=JSON.parse('{"id":"admin/tutorials/email_configure_relay","title":"Configurer un relais SMTP","description":"Si votre fournisseur d\'acc\xe8s \xe0 Internet bloque le port 25, ou si vous rencontrez un probl\xe8me d\u2019utilisation du serveur SMTP natif de YunoHost, vous pouvez configurer votre serveur YunoHost pour utiliser un relais SMTP.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/admin/45.tutorials/35.email_configure_relay.mdx","sourceDirName":"admin/45.tutorials","slug":"/admin/tutorials/email_configure_relay","permalink":"/doc/pr-2704/fr/admin/tutorials/email_configure_relay","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/i18n/fr/docusaurus-plugin-content-docs/current/admin/45.tutorials/35.email_configure_relay.mdx","tags":[],"version":"current","sidebarPosition":35,"frontMatter":{"title":"Configurer un relais SMTP"},"sidebar":"admin","previous":{"title":"Ajouter un stockage externe","permalink":"/doc/pr-2704/fr/admin/tutorials/external_storage"},"next":{"title":"D\xe9placer un dossier d\'application vers un autre espace de stockage","permalink":"/doc/pr-2704/fr/admin/tutorials/moving_app_folder"}}'),t=s(4848),i=s(4429),a=s(4109),o=s(3703);let l={title:"Configurer un relais SMTP"},u,c={},d=[{value:"Qu&#39;est-ce qu&#39;un relais SMTP\u202F?",id:"quest-ce-quun-relais-smtp",level:2},{value:"<FAIcon></FAIcon> Inconv\xe9nients des relais SMTP",id:"-inconv\xe9nients-des-relais-smtp",level:2},{value:"Comment utiliser un relais SMTP avec YunoHost ?",id:"comment-utiliser-un-relais-smtp-avec-yunohost-",level:2},{value:"\xc9tape 1 : S&#39;inscrire chez un fournisseur de relais SMTP",id:"\xe9tape-1--sinscrire-chez-un-fournisseur-de-relais-smtp",level:3},{value:"\xc9tape 2 : Param\xe9trer sa zone DNS correctement",id:"\xe9tape-2--param\xe9trer-sa-zone-dns-correctement",level:3},{value:"\xc9tape 3 : Configurer YunoHost correctement",id:"\xe9tape-3--configurer-yunohost-correctement",level:3},{value:"Relayer tous les emails m\xeame ceux des noms de domaines g\xe9r\xe9s par YunoHost",id:"relayer-tous-les-emails-m\xeame-ceux-des-noms-de-domaines-g\xe9r\xe9s-par-yunohost",level:4},{value:"\xc9tape 4 : V\xe9rifier la configuration",id:"\xe9tape-4--v\xe9rifier-la-configuration",level:3}];function m(e){let r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{FAIcon:n}=r;return n||function(e,r){throw Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("FAIcon",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"Si votre fournisseur d'acc\xe8s \xe0 Internet bloque le port 25, ou si vous rencontrez un probl\xe8me d\u2019utilisation du serveur SMTP natif de YunoHost, vous pouvez configurer votre serveur YunoHost pour utiliser un relais SMTP."}),"\n",(0,t.jsx)(r.h2,{id:"quest-ce-quun-relais-smtp",children:"Qu'est-ce qu'un relais SMTP\u202F?"}),"\n",(0,t.jsx)(r.p,{children:"C'est un serveur SMTP tiers qui va envoyer les e-mails aux destinataires \xe0 la place de votre propre serveur SMTP.\nUne fois correctement install\xe9, le fonctionnement est transparent pour l\u2019utilisateur. Vos correspondants verront vos e-mails comme s\u2019ils venaient de votre propre serveur, mais ils seront pass\xe9s par le relais SMTP que vous aurez choisis et configur\xe9s."}),"\n",(0,t.jsxs)(r.h2,{id:"-inconv\xe9nients-des-relais-smtp",children:[(0,t.jsx)(n,{icon:"fa-exclamation-triangle"})," Inconv\xe9nients des relais SMTP"]}),"\n",(0,t.jsx)(r.p,{children:"Il est important de noter que dans le monde de l'auto-h\xe9bergement, utiliser un relais SMTP est un \xe9norme compromis ! En effet, le relais SMTP sera non seulement capable d'envoyer les e-mails de votre part, mais il a \xe9galement acc\xe8s au contenu int\xe9gral de vos e-mails et peut \xe9ventuellement les modifier (Par exemple, par d\xe9faut, MailJet r\xe9\xe9crit les hyperliens html contenus dans vos mails, afin de traquer l'activit\xe9 de vos correspondants). Il faut \xe9galement savoir qu'une fois mis en place, tout le trafic e-mail sortant de votre serveur passera par ce relais ; il n'est pas possible de choisir de l'utiliser ou pas selon l'exp\xe9diteur ou la destination."}),"\n",(0,t.jsxs)(r.p,{children:["Au-del\xe0 des consid\xe9rations de confidentialit\xe9 ci-dessus, un relais SMTP peut imposer des limitations techniques que l'on n'aurait pas si le port 25 \xe9tait ouvert. Par exemple, avec la plupart des relais, si un utilisateur de votre serveur YunoHost d\xe9clare ",(0,t.jsx)(r.strong,{children:'une "adresse de transfert" ext\xe9rieure'})," dans le but de transf\xe9rer automatiquement les messages re\xe7us sur votre serveur YunoHost vers une autre bo\xeete mail, ",(0,t.jsx)(r.strong,{children:"ce transfert ne fonctionnera pas"})," pour les courriels venant de l'ext\xe9rieur de votre serveur, sans qu'il soit en averti. En effet, les relais exigent g\xe9n\xe9ralement que les messages qu'ils transmettent aient une adresse d'exp\xe9diteur de votre domaine (pour lutter contre le spam et pr\xe9server la r\xe9putation de leurs services), ce qui n'est pas le cas pour un \"forward automatique\" o\xf9 l'exp\xe9diteur originel du mail est conserv\xe9 ; le message est alors bloqu\xe9 par le relais (qui, normalement, pr\xe9vient votre admin YunoHost, mais seulement apr\xe8s coup)."]}),"\n",(0,t.jsx)(r.h2,{id:"comment-utiliser-un-relais-smtp-avec-yunohost-",children:"Comment utiliser un relais SMTP avec YunoHost ?"}),"\n",(0,t.jsx)(r.p,{children:"YunoHost supporte depuis la version 4.1 la configuration d'un relais SMTP. Pour le moment cette fonctionnalit\xe9 n'est pas accessible depuis l'interface d'administration : le param\xe9trage doit \xeatre fait en ligne de commande."}),"\n",(0,t.jsx)(r.h3,{id:"\xe9tape-1--sinscrire-chez-un-fournisseur-de-relais-smtp",children:"\xc9tape 1 : S'inscrire chez un fournisseur de relais SMTP"}),"\n",(0,t.jsx)(r.p,{children:"Beaucoup de fournisseurs existent dans ce domaine. Certains sont gratuits et d'autres proposent des services payants contre diff\xe9rentes options. Comme \xe9crit plus haut, vous devez \xeatre s\xfbr de pouvoir lui faire confiance, mais cela reste \xe0 votre entier \xe9gard."}),"\n",(0,t.jsx)(r.h3,{id:"\xe9tape-2--param\xe9trer-sa-zone-dns-correctement",children:"\xc9tape 2 : Param\xe9trer sa zone DNS correctement"}),"\n",(0,t.jsx)(r.p,{children:"Une fois inscrit, le fournisseur de relais SMTP vous demandera g\xe9n\xe9ralement de modifier votre DNS.\nLa proc\xe9dure standard consiste \xe0 ajouter une cl\xe9 DKIM et une cl\xe9 SPF \xe0 vos enregistrements DNS.\nLa mani\xe8re de modifier ces enregistrements et la valeur des cl\xe9s que vous devrez ajouter d\xe9pendent \xe0 la fois de votre fournisseur de nom de domaine et de votre fournisseur de relais SMTP."}),"\n",(0,t.jsx)(r.p,{children:"En g\xe9n\xe9ral, le fournisseur de relais SMTP vous fournira un guide expliquant comment modifier ces enregistrements, ainsi qu'un outil de v\xe9rification automatique qui vous indiquera lorsque votre DNS aura \xe9t\xe9 correctement configur\xe9. Cette \xe9tape est obligatoire pour prouver \xab au monde entier \xbb que vous, propri\xe9taire de votre nom de domaine, avez explicitement autoris\xe9 votre fournisseur de relais SMTP \xe0 envoyer des e-mails en votre nom."}),"\n",(0,t.jsx)(r.p,{children:"Veuillez noter que la modification de vos enregistrements DNS peut parfois prendre plus de 24 heures pour prendre effet, alors soyez patient\u202F!"}),"\n",(0,t.jsx)(r.admonition,{type:"warning",children:(0,t.jsxs)(r.p,{children:[(0,t.jsx)(n,{icon:"fa-exclamation-triangle"})," Attention une fois la zone DNS enregistr\xe9e, le relais SMTP peut envoyer des e-mails \xe0 votre nom sans que vous ne le sachiez"]})}),"\n",(0,t.jsx)(r.h3,{id:"\xe9tape-3--configurer-yunohost-correctement",children:"\xc9tape 3 : Configurer YunoHost correctement"}),"\n",(0,t.jsx)(r.p,{children:"Il est possible de configurer soit via la webadmin ou en ligne de commande."}),"\n",(0,t.jsxs)(a.A,{groupId:"admin-commands",children:[(0,t.jsxs)(o.A,{value:"web",label:"Depuis la webadmin",children:[(0,t.jsxs)(r.p,{children:["Depuis l'interface d'administration, dans la section ",(0,t.jsx)(r.code,{children:"Outils"})," > ",(0,t.jsx)(r.code,{children:"Param\xe8tres de YunoHost"}),", et l'onglet ",(0,t.jsx)(r.code,{children:"Email"}),".\nIl suffit d'activer l'option, et de renseigner les champs n\xe9cessaires :"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Adresse du relais SMTP"}),"\xa0: URL du serveur SMTP."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Port relais SMTP"}),"\xa0: Port utilis\xe9 avec le serveur distant."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Compte du relais SMTP"}),"\xa0: Identifiant ou nom d'utilisateur du serveur de messagerie."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Mot de passe relais SMTP"}),"\xa0: Votre mot de passe relais SMTP."]}),"\n"]}),(0,t.jsx)(r.admonition,{type:"warning",children:(0,t.jsxs)(r.p,{children:[(0,t.jsx)(n,{icon:"fa-exclamation-triangle"})," Les mots de passe avec le caract\xe8re ",(0,t.jsx)(r.code,{children:"#"})," ne fonctionneront pas proprement \xe0 cause d'une limitation de postfix (d'autres caract\xe8res sont peut-\xeatre interdit, n'h\xe9sitez pas \xe0 rapporter ce genre de cas pour la mise \xe0 jour de cette doc)."]})}),(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{src:s(7346).A+"",width:"1722",height:"1246"})})]}),(0,t.jsxs)(o.A,{value:"cli",label:"Depuis la ligne de commande",children:[(0,t.jsx)(r.p,{children:"Pour que YunoHost soit capable d'utiliser le relais, il faut param\xe9trer 4 choses."}),(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["L'URL de votre relais SMTP (pour ce tutoriel, nous utiliserons ",(0,t.jsx)(r.code,{children:"smtprelay.tld"}),")"]}),"\n",(0,t.jsx)(r.li,{children:"Le port sur lequel vous acc\xe9dez au relais (pour ce tutoriel, nous utiliserons le port 2525 ci-dessous)"}),"\n",(0,t.jsxs)(r.li,{children:["Votre nom d'utilisateur pour le relais SMTP (pour ce tutoriel, nous utiliserons ",(0,t.jsx)(r.code,{children:"username"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["Votre mot de passe pour le relais SMTP (pour ce tutoriel, nous utiliserons ",(0,t.jsx)(r.code,{children:"password"}),")"]}),"\n"]}),(0,t.jsx)(r.admonition,{type:"warning",children:(0,t.jsxs)(r.p,{children:[(0,t.jsx)(n,{icon:"fa-exclamation-triangle"})," Les mots de passe avec le caract\xe8re ",(0,t.jsx)(r.code,{children:"#"})," ne fonctionneront pas proprement \xe0 cause d'une limitation de postfix (d'autres caract\xe8res sont peut-\xeatre interdit, n'h\xe9sitez pas \xe0 rapporter ce genre de cas pour la mise \xe0 jour de cette doc)."]})}),(0,t.jsx)(r.p,{children:"Le fournisseur SMTP vous fournit ces trois informations."}),(0,t.jsx)(r.p,{children:"Premi\xe8rement se connecter sur son serveur en SSH avec la commande :"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ssh admin@yourdomain.tld\n"})}),(0,t.jsx)(r.p,{children:"Ensuite, mettre \xe0 jour les informations suivantes :"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo yunohost settings set email.smtp.smtp_relay_enabled -v yes\nsudo yunohost settings set email.smtp.smtp_relay_host -v smtprelay.tld\nsudo yunohost settings set email.smtp.smtp_relay_port -v 2525\nsudo yunohost settings set email.smtp.smtp_relay_user -v username\nsudo yunohost settings set email.smtp.smtp_relay_password -v password\n"})}),(0,t.jsx)(r.p,{children:"C'est une bonne id\xe9e de confirmer les informations en faisant\u202F:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo yunohost settings list\n"})})]})]}),"\n",(0,t.jsx)(r.p,{children:"Votre relais SMTP est maintenant configur\xe9 !"}),"\n",(0,t.jsx)(r.admonition,{type:"warning",children:(0,t.jsxs)(r.p,{children:[(0,t.jsx)(n,{icon:"fa-exclamation-triangle"})," Maintenant le relais SMTP est capable de lire et d'utiliser toutes les informations contenues dans les emails que vous envoyez sans votre accord. Mais il ne sera pas capable de lire les informations des emails que vous recevez."]})}),"\n",(0,t.jsx)(r.h4,{id:"relayer-tous-les-emails-m\xeame-ceux-des-noms-de-domaines-g\xe9r\xe9s-par-yunohost",children:"Relayer tous les emails m\xeame ceux des noms de domaines g\xe9r\xe9s par YunoHost"}),"\n",(0,t.jsxs)(r.p,{children:["Si vous avez une grande confiance dans votre relais SMTP, que vous avez un second serveur IMAP que vous souhaitez ou \xeates contraint d'utiliser en lieu et place de celui de YunoHost, vous pouvez choisir de relayer tous les emails m\xeame ceux des noms de domaines g\xe9r\xe9s par YunoHost en commentant les deux ligne suivantes dans ",(0,t.jsx)(r.code,{children:"/etc/postfix/main.cf"})," :"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"#virtual_mailbox_domains = ldap:/etc/postfix/ldap-domains.cf\n#virtual_alias_maps = ldap:/etc/postfix/ldap-aliases.cf,ldap:/etc/postfix/ldap-groups.cf\n"})}),"\n",(0,t.jsx)(r.h3,{id:"\xe9tape-4--v\xe9rifier-la-configuration",children:"\xc9tape 4 : V\xe9rifier la configuration"}),"\n",(0,t.jsxs)(r.p,{children:["Vous pouvez v\xe9rifier votre configuration en envoyant des e-mails et en testant si tout fonctionne correctement.\nCertains relais SMTP vous fournissent des informations sur les e-mails que vous envoyez, ce qui peut \xe9galement \xeatre un bon moyen de v\xe9rifier que tout fonctionne comme pr\xe9vu.\nBien s\xfbr, vous pouvez toujours essayer ",(0,t.jsx)(r.a,{href:"https://www.mail-tester.com/",children:"mail-tester.com"})," pour v\xe9rifier s'il y a des probl\xe8mes ou des anomalies."]})]})}function p(e={}){let{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},7346:function(e,r,s){s.d(r,{A:()=>n});let n=s.p+"assets/images/relay_smtp_option_webadmin_en-c0d1765ad827013b6b5273b72f3e4750.png"},3703:function(e,r,s){s.d(r,{A:()=>i});var n=s(4848);s(6540);var t=s(9836);function i({children:e,hidden:r,className:s}){return(0,n.jsx)("div",{role:"tabpanel",className:(0,t.A)("tabItem_Ymn6",s),hidden:r,children:e})}},4109:function(e,r,s){s.d(r,{A:()=>j});var n=s(4848),t=s(6540),i=s(9836),a=s(6364),o=s(8251),l=s(6347),u=s(8004),c=s(5580),d=s(2213),m=s(5734);function p(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){let{props:r}=e;return!!r&&"object"==typeof r&&"value"in r}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function v({value:e,tabValues:r}){return r.some(r=>r.value===e)}var f=s(8864);function h({className:e,block:r,selectedValue:s,selectValue:t,tabValues:a}){let l=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.a_)(),c=e=>{let r=e.currentTarget,n=a[l.indexOf(r)].value;n!==s&&(u(r),t(n))},d=e=>{let r=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{let s=l.indexOf(e.currentTarget)+1;r=l[s]??l[0];break}case"ArrowLeft":{let s=l.indexOf(e.currentTarget)-1;r=l[s]??l[l.length-1]}}r?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":r},e),children:a.map(({value:e,label:r,attributes:t})=>(0,n.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...t,className:(0,i.A)("tabs__item","tabItem_LNqP",t?.className,{"tabs__item--active":s===e}),children:r??e},e))})}function x({lazy:e,children:r,selectedValue:s}){let a=(Array.isArray(r)?r:[r]).filter(Boolean);if(e){let e=a.find(e=>e.props.value===s);return e?(0,t.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:a.map((e,r)=>(0,t.cloneElement)(e,{key:r,hidden:e.props.value!==s}))})}function g(e){let r=function(e){let r,{defaultValue:s,queryString:n=!1,groupId:i}=e,a=function(e){let{values:r,children:s}=e;return(0,t.useMemo)(()=>{let e=r??p(s).map(({props:{value:e,label:r,attributes:s,default:n}})=>({value:e,label:r,attributes:s,default:n})),n=(0,d.XI)(e,(e,r)=>e.value===r.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[r,s])}(e),[o,f]=(0,t.useState)(()=>(function({defaultValue:e,tabValues:r}){if(0===r.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!v({value:e,tabValues:r}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${r.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let s=r.find(e=>e.default)??r[0];if(!s)throw Error("Unexpected error: 0 tabValues");return s.value})({defaultValue:s,tabValues:a})),[h,x]=function({queryString:e=!1,groupId:r}){let s=(0,l.W6)(),n=function({queryString:e=!1,groupId:r}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!r)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:e,groupId:r});return[(0,c.aZ)(n),(0,t.useCallback)(e=>{if(!n)return;let r=new URLSearchParams(s.location.search);r.set(n,e),s.replace({...s.location,search:r.toString()})},[n,s])]}({queryString:n,groupId:i}),[g,j]=function({groupId:e}){let r=e?`docusaurus.tab.${e}`:null,[s,n]=(0,m.Dv)(r);return[s,(0,t.useCallback)(e=>{r&&n.set(e)},[r,n])]}({groupId:i}),b=v({value:r=h??g,tabValues:a})?r:null;return(0,u.A)(()=>{b&&f(b)},[b]),{selectedValue:o,selectValue:(0,t.useCallback)(e=>{if(!v({value:e,tabValues:a}))throw Error(`Can't select invalid tab value=${e}`);f(e),x(e),j(e)},[x,j,a]),tabValues:a}}(e);return(0,n.jsxs)("div",{className:(0,i.A)(a.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,n.jsx)(h,{...r,...e}),(0,n.jsx)(x,{...r,...e})]})}function j(e){let r=(0,f.A)();return(0,n.jsx)(g,{...e,children:p(e.children)},String(r))}},4429:function(e,r,s){s.d(r,{R:()=>a,x:()=>o});var n=s(6540);let t={},i=n.createContext(t);function a(e){let r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);