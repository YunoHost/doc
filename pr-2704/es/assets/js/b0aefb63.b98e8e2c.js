"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([["1635"],{2994:function(e,s,n){n.r(s),n.d(s,{frontMatter:()=>r,toc:()=>l,default:()=>h,metadata:()=>i,assets:()=>c,contentTitle:()=>a});var i=JSON.parse('{"id":"admin/security","title":"\u{1F512} Security","description":"When thinking and discussing security \u2014 whether in the context of YunoHost or any other system \u2014, please keep in mind that security is not a binary state, but an ongoing practice. The term \\"security\\" is essentially meaningless without specifying what exactly we are securing against. The \'threats\' to consider depend on your context, and can range from automated attacks from bots roaming the Internet, to sophisticated state actors like the NSA, or supply chain vulnerabilities (e.g., compromised software dependencies), or basic risks such as your own users employing overly simple passwords, or your worst enemy from elementary school 20 years ago trying to hack into your server...","source":"@site/docs/admin/42.security.mdx","sourceDirName":"admin","slug":"/admin/security","permalink":"/doc/pr-2704/es/admin/security","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/main/docs/admin/42.security.mdx","tags":[],"version":"current","sidebarPosition":42,"frontMatter":{"title":"\u{1F512} Security"},"sidebar":"admin","previous":{"title":"Migrate or merge servers","permalink":"/doc/pr-2704/es/admin/backups/migrate_or_merge_servers"},"next":{"title":"\u2728 Upgrades","permalink":"/doc/pr-2704/es/admin/upgrade/"}}'),t=n(4848),o=n(4429);let r={title:"\u{1F512} Security"},a,c={},l=[{value:"Basic security advices",id:"basic-security-advices",level:2},{value:"SSH authentication via key",id:"ssh-authentication-via-key",level:2},{value:"Using a custom port for SSH",id:"using-a-custom-port-for-ssh",level:2},{value:"Hardening cipher used by NGINX, SSH, Dovecot, Postfix",id:"hardening-cipher-used-by-nginx-ssh-dovecot-postfix",level:2},{value:"Disabling the YunoHost API",id:"disabling-the-yunohost-api",level:2}];function d(e){let s={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{FAIcon:n}=s;return n||function(e,s){throw Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("FAIcon",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"When thinking and discussing security \u2014 whether in the context of YunoHost or any other system \u2014, please keep in mind that security is not a binary state, but an ongoing practice. The term \"security\" is essentially meaningless without specifying what exactly we are securing against. The 'threats' to consider depend on your context, and can range from automated attacks from bots roaming the Internet, to sophisticated state actors like the NSA, or supply chain vulnerabilities (e.g., compromised software dependencies), or basic risks such as your own users employing overly simple passwords, or your worst enemy from elementary school 20 years ago trying to hack into your server..."})}),"\n",(0,t.jsx)(s.p,{children:"YunoHost is developped with security in mind, and designing good tradeoff between security and usability. Here's a non-exhaustive list of security aspects that the project is implementing:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["a firewall based on ",(0,t.jsx)(s.code,{children:"nftables"})," to restrict incoming traffic to relevant ports ;"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"fail2ban"}),", a software that automatically rejects traffic from malicious IPs trying to brute force SSH and other services ;"]}),"\n",(0,t.jsxs)(s.li,{children:["using ",(0,t.jsx)(s.a,{href:"https://wiki.mozilla.org/Security/Server_Side_TLS",children:"Mozilla's recommendations for NGINX, Postfix, Dovecot, SSH ciphers etc."})," ;"]}),"\n",(0,t.jsx)(s.li,{children:"checking that user password/passphrase are not too simple when definining them ;"}),"\n",(0,t.jsx)(s.li,{children:"hashing user passwords (salted SHA512 in LDAP for example) ;"}),"\n",(0,t.jsx)(s.li,{children:"being vigilant on UNIX file/dir permissions accross the whole system ;"}),"\n",(0,t.jsxs)(s.li,{children:["apps are typically ran using a dedicated user, and with ",(0,t.jsx)(s.a,{href:"https://man7.org/linux/man-pages/man7/capabilities.7.html",children:"restricted capabilities"})," ;"]}),"\n",(0,t.jsx)(s.li,{children:"auto-redacting sensitive informations from YunoHost operation logs and when sharing them with Yunopaste ;"}),"\n",(0,t.jsx)(s.li,{children:"..."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"In addition, the project has mid-term goals to implement:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/YunoHost/issues/issues/878",children:"password self-reset for users"})," ;"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/YunoHost/yunohost/pull/2077",children:"automatic warnings about vulnerabilities"})," ",(0,t.jsx)("small",{children:"(via the Diagnosis, not via the forum or social media)"})," ;"]}),"\n",(0,t.jsxs)(s.li,{children:["supporting ",(0,t.jsx)(s.a,{href:"https://github.com/YunoHost/yunohost/pull/2149",children:"OIDC"})," and ",(0,t.jsx)(s.a,{href:"https://github.com/YunoHost/issues/issues/238",children:"2FA"})," ;"]}),"\n",(0,t.jsxs)(s.li,{children:["better support for SSH keys, in particular ",(0,t.jsx)(s.a,{href:"https://github.com/YunoHost/issues/issues/175",children:"making them configurable from the webadmin"})," ;"]}),"\n",(0,t.jsx)(s.li,{children:"further constrain and limit application capabilities to only what they need (cf. packaging v3) ;"}),"\n",(0,t.jsx)(s.li,{children:"..."}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:[(0,t.jsx)(n,{icon:"fa-shield"})," To discuss security flaws in YunoHost, contact the ",(0,t.jsx)(s.a,{href:"/community/security_team",children:"project's security team"}),"."]})}),"\n",(0,t.jsx)(s.h2,{id:"basic-security-advices",children:"Basic security advices"}),"\n",(0,t.jsx)(s.p,{children:"Security is not a one-time setup, it's an active, ongoing practice. Here are some basic practice that you should implement:"}),"\n",(0,t.jsx)(s.admonition,{type:"warning",children:(0,t.jsx)(s.p,{children:'Using stupidly simple passwords is arguably the number one reason why servers get "hacked". You and your users using reasonably complex passwords/passphrases is the basis of any good security.'})}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["as an admin, forget traditional passwords. ",(0,t.jsx)(s.em,{children:(0,t.jsxs)(s.a,{href:"https://imgs.xkcd.com/comics/password_strength_2x.png",children:["Use reasonably complex ",(0,t.jsx)(s.strong,{children:"passphases"})]})}),". Learn about password managers."]}),"\n",(0,t.jsxs)(s.li,{children:["keep your server and apps ",(0,t.jsx)(s.strong,{children:"reasonably up to date"}),". Consider using the ",(0,t.jsx)(s.a,{href:"https://apps.yunohost.org/app/unattended_upgrades",children:"unattended upgrades"})," app for automatic upgrades ;"]}),"\n",(0,t.jsxs)(s.li,{children:["be aware that ",(0,t.jsx)(s.strong,{children:'each app you install is an additional "attack surface"'}),". Ideally, check the security reputation of every app you install. ",(0,t.jsx)(s.strong,{children:"Do not"})," just install random apps and then forget about them. Uninstall apps that you no longer use ;"]}),"\n",(0,t.jsxs)(s.li,{children:["only create accounts for people that you have some amount of trust into, in particular that they will use ",(0,t.jsx)(s.strong,{children:"decent passwords/passphrases"})," and decent security hygiene in general ;"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"regularly check the forum and social media"})," (e.g. ",(0,t.jsx)(s.a,{href:"https://toot.aquilenet.fr/@yunohost",children:"YunoHost's Mastodon account"}),") to stay informed when vulnerabilities are discovered or important fixes are released."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:"The following sections describe possible ways to further harden the security of your server."}),"\n",(0,t.jsx)(s.h2,{id:"ssh-authentication-via-key",children:"SSH authentication via key"}),"\n",(0,t.jsx)(s.p,{children:"By default, the SSH authentication uses the administration password. Deactivating this kind of authentication and replacing it by a key mechanism is advised."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"On your client"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ssh-keygen\nssh-copy-id -i ~/.ssh/id_rsa.pub <username@your_yunohost_server>\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["If you run into permissions issues, set ",(0,t.jsx)(s.code,{children:"username"})," as owner of the dir ",(0,t.jsx)(s.code,{children:"~/.ssh"})," with ",(0,t.jsx)(s.code,{children:"chown"}),". Be careful, for security reasons this directory should be in mode ",(0,t.jsx)(s.code,{children:"700"}),".",(0,t.jsx)(s.br,{}),"\n","If you are on Ubuntu 16.04 you should run ",(0,t.jsx)(s.code,{children:"ssh-add"})," to initialize the SSH agent."]})}),"\n",(0,t.jsx)(s.p,{children:"Type your admnistration password and your key will be copied onto your server."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"On your server"}),", editing the SSH configuration file to deactivate password authentication is handled by a system setting:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo yunohost settings set security.ssh.ssh_password_authentication -v no\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"danger",children:(0,t.jsx)(s.p,{children:"Never close your current SSH connection before checking that your alterations work. Test your new configuration by opening a new terminal or window. That way, you can undo your alterations if anything goes wrong."})}),"\n",(0,t.jsx)(s.h2,{id:"using-a-custom-port-for-ssh",children:"Using a custom port for SSH"}),"\n",(0,t.jsx)(s.p,{children:"To prevent SSH connection attempts by robots that scan the internet for any server with SSH enabled, you can change the SSH port.\nThis is handled by a system setting, which takes care of updating the SSH and Fail2Ban configuration."}),"\n",(0,t.jsx)(s.p,{children:"Note that changing the port is still useful even if you've disabled password authentication, because that significantly reduces noise from brute force attempts in SSH logs."}),"\n",(0,t.jsx)(s.admonition,{type:"warning",children:(0,t.jsxs)(s.p,{children:["If you manually modify anything in the SSH server configuration (",(0,t.jsx)(s.code,{children:"/etc/ssh/sshd_config"}),"), YunoHost's regen-conf mechanism will no longer automatically update this file. For this reason, always use the YunoHost admin tools to make changes to the systems configuration files!"]})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo yunohost settings set security.ssh.ssh_port -v <new_ssh_port_number>\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"For subsequent SSH connections"}),", you need to add the ",(0,t.jsx)(s.code,{children:"-p"})," option followed by the SSH port number."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ssh -p <new_ssh_port_number> admin@<your_yunohost_server>\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"danger",children:(0,t.jsx)(s.p,{children:"Never close your current SSH connection before checking that your alterations work. Test your new configuration by opening a new terminal or window. That way, you can undo your alterations if anything goes wrong."})}),"\n",(0,t.jsx)(s.h2,{id:"hardening-cipher-used-by-nginx-ssh-dovecot-postfix",children:"Hardening cipher used by NGINX, SSH, Dovecot, Postfix"}),"\n",(0,t.jsxs)(s.p,{children:["The default TLS configuration for services tends to offer good compatibility to support old devices. You can tune this policy for specific services like SSH and NGINX. By default, the NGINX configuration follows the ",(0,t.jsx)(s.a,{href:"https://wiki.mozilla.org/Security/Server_Side_TLS#Intermediate_compatibility_.28default.29",children:"intermediate compatibility recommendation"})," from Mozilla. You can choose to switch to the 'modern' configuration which uses more recent security recommendations, ",(0,t.jsx)(s.strong,{children:"at the cost of decreasing compatibility"}),", which may be an issue for your users and visitors using older devices. More details about compatibility can be found on ",(0,t.jsx)(s.a,{href:"https://wiki.mozilla.org/Security/Server_Side_TLS#Modern_compatibility",children:"this page"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"Changing the compatibility level is not definitive and can be reverted if it doesn't fit with your environment."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"On your server"}),", change the policy for NGINX"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo yunohost settings set security.nginx.nginx_compatibility -v modern\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"On your server"}),", change the policy for SSH"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo yunohost settings set security.ssh.ssh_compatibility -v modern\n"})}),"\n",(0,t.jsx)(s.h2,{id:"disabling-the-yunohost-api",children:"Disabling the YunoHost API"}),"\n",(0,t.jsxs)(s.p,{children:["YunoHost administration is accessible through an ",(0,t.jsx)(s.strong,{children:"HTTP API"}),", which is the API used by the webadmin. This may be an additional, unecessary attack surface if you are not planning to use it. In this case, you can disable the corresponding service entirely via command line:"]}),"\n",(0,t.jsx)(s.admonition,{type:"warning",children:(0,t.jsx)(s.p,{children:"This will completely disable both YunoHost's API and the web administration panel that relies on it.\nProceed only if you are comfortable with exclusively using the command line from now on."})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo systemctl disable yunohost-api\nsudo systemctl stop yunohost-api\n"})}),"\n",(0,t.jsxs)(s.p,{children:["As ",(0,t.jsx)(s.code,{children:"yunohost-api"})," is now disabled and not running, Diagnosis will report an error. This error can be ignored using:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo yunohost diagnosis ignore --filter services service=yunohost-api\n"})})]})}function h(e={}){let{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},4429:function(e,s,n){n.d(s,{R:()=>r,x:()=>a});var i=n(6540);let t={},o=i.createContext(t);function r(e){let s=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);